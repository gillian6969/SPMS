(function(){var e={4043:function(e,a,t){"use strict";var s=t(5130),l=t(6768);const o={class:"app"};function n(e,a,t,s,n,r){const c=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(c)])}var r=t(1387),c={name:"App",setup(){const e=(0,r.lq)(),a=(0,l.EW)((()=>"Login"===e.name));return{isLoginPage:a}}},i=t(1241);const d=(0,i.A)(c,[["render",n]]);var u=d,v=(t(8111),t(3579),t(782)),p=t(4373);const m={token:localStorage.getItem("token")||null,user:JSON.parse(localStorage.getItem("user"))||null},b={isLoggedIn:e=>!!e.token,currentUser:e=>e.user,isCITHead:e=>"citHead"===e.user?.role,isTeacher:e=>"teacher"===e.user?.role,isSSP:e=>"ssp"===e.user?.role},f={async login({commit:e},a){try{console.log("Making login request with:",{...a,password:"****"});const t=await p.A.post("http://localhost:8000/api/auth/login",a);console.log("Login response:",t.data);const{token:s,user:l}=t.data;return localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(l)),e("SET_TOKEN",s),e("SET_USER",l),p.A.defaults.headers.common["Authorization"]=`Bearer ${s}`,t}catch(t){throw console.error("Login error in store:",t.response||t),e("SET_TOKEN",null),e("SET_USER",null),t}},logout({commit:e}){localStorage.removeItem("token"),localStorage.removeItem("user"),e("SET_TOKEN",null),e("SET_USER",null),delete p.A.defaults.headers.common["Authorization"]},async updateProfile({commit:e},a){try{const t=await p.A.put("http://localhost:8000/api/users/profile",a),s=t.data;return localStorage.setItem("user",JSON.stringify(s)),e("SET_USER",s),t}catch(t){throw t}}},h={SET_TOKEN(e,a){e.token=a},SET_USER(e,a){e.user=a}};var g={state:m,getters:b,actions:f,mutations:h},k=(0,v.y$)({modules:{auth:g}}),y=t(4232),L=t.p+"img/logo1.646e971a.png",S=t.p+"img/logo2.c8e31ca0.png";const w={class:"login-container"},C=["data-login-type"],A={class:"left-section"},D={class:"content-wrapper"},E={class:"logo-container"},j=["data-login-type"],I={class:"form-title"},Y={class:"login-type-selector"},F=["data-login-type"],x=["data-login-type"],T={class:"form-group"},N=["disabled"],P={class:"form-group"},R=["disabled"],M=["data-login-type","disabled"],_={key:0,class:"spinner"},$={key:1},K={key:0,class:"error-message"};function z(e,a,t,o,n,r){return(0,l.uX)(),(0,l.CE)("div",w,[(0,l.Lk)("div",{class:"login-card","data-login-type":o.loginType},[(0,l.Lk)("div",A,[(0,l.Lk)("div",D,[(0,l.Lk)("div",E,[(0,l.Lk)("img",{src:L,alt:"School Logo",class:(0,y.C4)(["logo logo1",{active:"citHead"===o.loginType}])},null,2),(0,l.Lk)("img",{src:S,alt:"School Logo",class:(0,y.C4)(["logo logo2",{active:"user"===o.loginType}])},null,2)]),a[5]||(a[5]=(0,l.Lk)("h1",{class:"school-name"},"PHINMA ARAULLO UNIVERSITY",-1)),a[6]||(a[6]=(0,l.Lk)("p",{class:"system-name"},"Student Performance Monitoring System",-1))])]),(0,l.Lk)("div",{class:"right-section","data-login-type":o.loginType},[(0,l.Lk)("h2",I,(0,y.v_)("citHead"===o.loginType?"CIT HEAD LOGIN":"TEACHER & SSP LOGIN"),1),(0,l.Lk)("div",Y,[(0,l.Lk)("button",{class:(0,y.C4)(["type-btn",{active:"citHead"===o.loginType}]),"data-login-type":o.loginType,onClick:a[0]||(a[0]=e=>o.loginType="citHead")}," CIT Head ",10,F),(0,l.Lk)("button",{class:(0,y.C4)(["type-btn",{active:"user"===o.loginType}]),"data-login-type":o.loginType,onClick:a[1]||(a[1]=e=>o.loginType="user")}," TEACHER & SSP ADVISERS LOGIN ",10,x)]),(0,l.Lk)("form",{onSubmit:a[4]||(a[4]=(0,s.D$)(((...e)=>o.handleLogin&&o.handleLogin(...e)),["prevent"])),class:"login-form"},[(0,l.Lk)("div",T,[a[7]||(a[7]=(0,l.Lk)("label",{class:"form-label"},"Username",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>o.email=e),placeholder:"Enter your email here",required:"",disabled:o.isLoading},null,8,N),[[s.Jo,o.email]])]),(0,l.Lk)("div",P,[a[8]||(a[8]=(0,l.Lk)("label",{class:"form-label"},"Password",-1)),(0,l.bo)((0,l.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>o.password=e),placeholder:"Enter your password here",required:"",disabled:o.isLoading},null,8,R),[[s.Jo,o.password]])]),a[10]||(a[10]=(0,l.Lk)("div",{class:"form-group recaptcha-container"},[(0,l.Lk)("div",{id:"g-recaptcha"})],-1)),(0,l.Lk)("button",{type:"submit",class:"btn-login","data-login-type":o.loginType,disabled:o.isLoading||!o.recaptchaToken},[o.isLoading?((0,l.uX)(),(0,l.CE)("span",_,a[9]||(a[9]=[(0,l.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):((0,l.uX)(),(0,l.CE)("span",$,"Login"))],8,M),o.error?((0,l.uX)(),(0,l.CE)("p",K,(0,y.v_)(o.error),1)):(0,l.Q3)("",!0)],32)],8,j)],8,C)])}t(4114);var W=t(144),X={name:"Login",setup(){const e=(0,v.Pj)(),a=(0,r.rd)(),t=(0,W.KR)("user"),s=(0,W.KR)(""),o=(0,W.KR)(""),n=(0,W.KR)(""),c=(0,W.KR)(!1),i=(0,W.KR)(""),d="6LcsLNkqAAAAAH5OO5HjmocsPxA_y80LzVold7rW";(0,l.sV)((()=>{const e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js",e.async=!0,e.defer=!0,document.head.appendChild(e),e.onload=()=>{window.grecaptcha.ready((()=>{window.grecaptcha.render("g-recaptcha",{sitekey:d,callback:e=>{i.value=e},"expired-callback":()=>{i.value=""}})}))}}));const u=async()=>{try{if(!i.value)return void(n.value="Please complete the reCAPTCHA verification");n.value="",c.value=!0;const l={email:s.value,password:o.value,loginType:t.value,recaptchaToken:i.value};console.log("Attempting login with:",{email:l.email,loginType:l.loginType,timestamp:(new Date).toISOString()});const r=await e.dispatch("login",l);console.log("Login response received:",{userRole:r.data.user?.role,loginType:t.value,timestamp:(new Date).toISOString()});const d=r.data.user;if("citHead"===t.value&&"citHead"!==d.role)return console.log("Access denied: Non-CIT Head using CIT Head login"),n.value="Access denied. Please use the Teacher/Student login.",void await e.dispatch("logout");if("user"===t.value&&"citHead"===d.role)return console.log("Access denied: CIT Head using regular login"),n.value="Access denied. Please use the CIT Head login.",void await e.dispatch("logout");a.push("/dashboard")}catch(l){console.error("Login error:",{error:l,response:l.response?.data,status:l.response?.status,timestamp:(new Date).toISOString()}),403===l.response?.status?n.value=l.response.data.message||"Access denied. Please check your login type.":400===l.response?.status?n.value=l.response.data.message||"Invalid credentials. Please try again.":n.value="Login failed. Please try again.",window.grecaptcha&&window.grecaptcha.reset(),i.value=""}finally{c.value=!1}};return{loginType:t,email:s,password:o,error:n,isLoading:c,handleLogin:u,recaptchaSiteKey:d,recaptchaToken:i}}};const B=(0,i.A)(X,[["render",z],["__scopeId","data-v-bc9b6f4e"]]);var U=B;const H={class:"register-container"},O={class:"register-box"},Q={class:"mb-3"},V={class:"mb-3"},q={class:"mb-3"},J={class:"mb-3"},G={class:"mb-3"},Z={class:"mb-3"},ee={class:"mb-3"},ae={class:"subject-selection"},te=["id","value"],se=["for"],le={class:"mt-3"},oe={class:"input-group"},ne=["disabled"],re=["disabled"],ce={class:"mb-3"},ie={key:0,class:"alert alert-danger mt-3"},de={key:1,class:"alert alert-success mt-3"};function ue(e,a,t,o,n,r){return(0,l.uX)(),(0,l.CE)("div",H,[(0,l.Lk)("div",O,[a[24]||(a[24]=(0,l.Lk)("h2",{class:"text-center mb-4"},"Create New Account",-1)),a[25]||(a[25]=(0,l.Lk)("p",{class:"text-center text-muted mb-4"},"Register new teachers and SSP advisers",-1)),(0,l.Lk)("form",{onSubmit:a[11]||(a[11]=(0,s.D$)(((...e)=>o.handleRegister&&o.handleRegister(...e)),["prevent"]))},[(0,l.Lk)("div",Q,[a[12]||(a[12]=(0,l.Lk)("label",{class:"form-label"},"First Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>o.firstName=e),required:""},null,512),[[s.Jo,o.firstName]])]),(0,l.Lk)("div",V,[a[13]||(a[13]=(0,l.Lk)("label",{class:"form-label"},"Last Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>o.lastName=e),required:""},null,512),[[s.Jo,o.lastName]])]),(0,l.Lk)("div",q,[a[14]||(a[14]=(0,l.Lk)("label",{class:"form-label"},"Email",-1)),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>o.email=e),required:""},null,512),[[s.Jo,o.email]])]),(0,l.Lk)("div",J,[a[15]||(a[15]=(0,l.Lk)("label",{class:"form-label"},"Password",-1)),(0,l.bo)((0,l.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>o.password=e),required:""},null,512),[[s.Jo,o.password]])]),(0,l.Lk)("div",G,[a[16]||(a[16]=(0,l.Lk)("label",{class:"form-label"},"Confirm Password",-1)),(0,l.bo)((0,l.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":a[4]||(a[4]=e=>o.confirmPassword=e),required:""},null,512),[[s.Jo,o.confirmPassword]])]),(0,l.Lk)("div",Z,[a[18]||(a[18]=(0,l.Lk)("label",{class:"form-label"},"Teaching Year",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[5]||(a[5]=e=>o.teachingYear=e),required:"",onChange:a[6]||(a[6]=(...e)=>o.handleYearChange&&o.handleYearChange(...e))},a[17]||(a[17]=[(0,l.Fv)('<option value="" data-v-0fc3f21a>Select Year</option><option value="1st" data-v-0fc3f21a>1st Year</option><option value="2nd" data-v-0fc3f21a>2nd Year</option><option value="3rd" data-v-0fc3f21a>3rd Year</option><option value="4th" data-v-0fc3f21a>4th Year</option>',5)]),544),[[s.u1,o.teachingYear]])]),(0,l.Lk)("div",ee,[a[20]||(a[20]=(0,l.Lk)("label",{class:"form-label"},"Subjects",-1)),(0,l.Lk)("div",ae,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableSubjects,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e,class:"form-check"},[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"form-check-input",id:e,value:e,"onUpdate:modelValue":a[7]||(a[7]=e=>o.selectedSubjects=e)},null,8,te),[[s.lH,o.selectedSubjects]]),(0,l.Lk)("label",{class:"form-check-label",for:e},(0,y.v_)(e),9,se)])))),128))]),(0,l.Lk)("div",le,[(0,l.Lk)("div",oe,[(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[8]||(a[8]=e=>o.customSubject=e),placeholder:"Add custom subject",disabled:!o.teachingYear},null,8,ne),[[s.Jo,o.customSubject]]),(0,l.Lk)("button",{class:"btn btn-outline-primary",type:"button",onClick:a[9]||(a[9]=(...e)=>o.addCustomSubject&&o.addCustomSubject(...e)),disabled:!o.customSubject||!o.teachingYear}," Add ",8,re)]),a[19]||(a[19]=(0,l.Lk)("small",{class:"text-muted"},"Enter a custom subject code (e.g., ITE 105)",-1))])]),(0,l.Lk)("div",ce,[a[22]||(a[22]=(0,l.Lk)("label",{class:"form-label"},"Role",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[10]||(a[10]=e=>o.role=e),required:""},a[21]||(a[21]=[(0,l.Lk)("option",{value:""},"Select Role",-1),(0,l.Lk)("option",{value:"teacher"},"Teacher",-1),(0,l.Lk)("option",{value:"ssp"},"SSP Adviser",-1)]),512),[[s.u1,o.role]])]),a[23]||(a[23]=(0,l.Lk)("button",{type:"submit",class:"btn btn-primary w-100"},"Create Account",-1))],32),o.error?((0,l.uX)(),(0,l.CE)("div",ie,(0,y.v_)(o.error),1)):(0,l.Q3)("",!0),o.success?((0,l.uX)(),(0,l.CE)("div",de,(0,y.v_)(o.success),1)):(0,l.Q3)("",!0)])])}var ve={name:"Register",setup(){const e=(0,v.Pj)(),a=((0,r.rd)(),(0,W.KR)("")),t=(0,W.KR)(""),s=(0,W.KR)(""),o=(0,W.KR)(""),n=(0,W.KR)(""),c=(0,W.KR)(""),i=(0,W.KR)(""),d=(0,W.KR)(""),u=(0,W.KR)(""),m=(0,W.KR)([]),b=(0,W.KR)(""),f=(0,W.KR)([]),h={"1st":["ITE 101","ITE 102","ITE 103","ITE 104"],"2nd":["ITE 201","ITE 202","ITE 203","ITE 204"],"3rd":["ITE 301","ITE 302","ITE 303","ITE 304"],"4th":["ITE 401","ITE 402","ITE 403","ITE 404"]},g=()=>{m.value=[],f.value=c.value?h[c.value]:[]},k=()=>{if(b.value&&c.value){const e=b.value.trim().toUpperCase();f.value.includes(e)||(f.value.push(e),m.value.push(e),b.value="")}},y=async()=>{try{if(d.value="",u.value="",o.value!==n.value)return void(d.value="Passwords do not match");const l={firstName:a.value,lastName:t.value,email:s.value,password:o.value,confirmPassword:n.value,teachingYear:c.value,role:i.value,subjects:m.value},r=await p.A.post("http://localhost:8000/api/auth/register",l,{headers:{Authorization:`Bearer ${e.state.auth.token}`}});r.data.success&&(u.value="Account created successfully!",a.value="",t.value="",s.value="",o.value="",n.value="",c.value="",i.value="",m.value=[],f.value=[],b.value="")}catch(l){d.value=l.response?.data?.message||"Registration failed. Please try again."}};return(0,l.wB)(c,g),{firstName:a,lastName:t,email:s,password:o,confirmPassword:n,teachingYear:c,role:i,error:d,success:u,handleRegister:y,selectedSubjects:m,availableSubjects:f,customSubject:b,addCustomSubject:k,handleYearChange:g}}};const pe=(0,i.A)(ve,[["render",ue],["__scopeId","data-v-0fc3f21a"]]);var me=pe;const be={class:"dashboard",ref:"dashboardContainer"},fe={class:"filter-section mb-4"},he={key:0,class:"d-flex gap-3 align-items-center"},ge={class:"filter-group"},ke={id:"analytics",class:"analytics-grid mb-4"},ye={class:"stat-card"},Le={class:"stat-content"},Se={class:"stat-value"},we={class:"stat-card"},Ce={class:"stat-content"},Ae={class:"stat-value"},De={class:"stat-card"},Ee={class:"stat-content"},je={class:"stat-value"},Ie={class:"stat-card"},Ye={class:"stat-content"},Fe={class:"stat-value"},xe={class:"performance-grid mb-4"},Te={class:"stat-card"},Ne={class:"stat-content"},Pe={key:0,class:"stat-value"},Re={key:1,class:"no-data"},Me={class:"stat-card"},_e={class:"stat-content"},$e={key:0,class:"stat-value"},Ke={key:1,class:"no-data"},ze={class:"charts-grid mb-4"},We={class:"chart-card"},Xe={class:"chart-container"},Be={ref:"performanceChart"},Ue={key:0,class:"no-data-message"},He={class:"chart-card"},Oe={class:"chart-container"},Qe={ref:"assessmentTypeChart"},Ve={key:0,class:"no-data-message"},qe={class:"chart-card mb-4"},Je={class:"chart-container"},Ge={ref:"attendanceChart"},Ze={key:0,class:"no-data-message"},ea={class:"chart-card"},aa={class:"chart-container"},ta={ref:"sectionChart"},sa={key:0,class:"no-data-message"};function la(e,a,t,o,n,r){return(0,l.uX)(),(0,l.CE)("div",be,[(0,l.Lk)("div",fe,[o.isCITHead?((0,l.uX)(),(0,l.CE)("div",he,[(0,l.Lk)("div",ge,[(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[0]||(a[0]=e=>o.selectedYear=e),onChange:a[1]||(a[1]=(...e)=>o.handleYearChange&&o.handleYearChange(...e))},a[3]||(a[3]=[(0,l.Fv)('<option value="" data-v-2cd178e7>All Academic Years</option><option value="1st" data-v-2cd178e7>1st Year</option><option value="2nd" data-v-2cd178e7>2nd Year</option><option value="3rd" data-v-2cd178e7>3rd Year</option><option value="4th" data-v-2cd178e7>4th Year</option>',5)]),544),[[s.u1,o.selectedYear]])]),(0,l.Lk)("button",{class:"btn btn-refresh",onClick:a[2]||(a[2]=(...e)=>o.refreshDashboard&&o.refreshDashboard(...e))},a[4]||(a[4]=[(0,l.Lk)("i",{class:"fas fa-sync-alt"},null,-1)]))])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",ke,[(0,l.Lk)("div",ye,[a[6]||(a[6]=(0,l.Lk)("div",{class:"stat-icon"},[(0,l.Lk)("i",{class:"fas fa-user-graduate"})],-1)),(0,l.Lk)("div",Le,[(0,l.Lk)("h3",Se,(0,y.v_)(o.totalStudents),1),a[5]||(a[5]=(0,l.Lk)("p",{class:"stat-label"},"Total Students",-1))])]),(0,l.Lk)("div",we,[a[8]||(a[8]=(0,l.Lk)("div",{class:"stat-icon"},[(0,l.Lk)("i",{class:"fas fa-chalkboard-teacher"})],-1)),(0,l.Lk)("div",Ce,[(0,l.Lk)("h3",Ae,(0,y.v_)(o.totalTeachers),1),a[7]||(a[7]=(0,l.Lk)("p",{class:"stat-label"},"Total Teachers",-1))])]),(0,l.Lk)("div",De,[a[10]||(a[10]=(0,l.Lk)("div",{class:"stat-icon"},[(0,l.Lk)("i",{class:"fas fa-user-tie"})],-1)),(0,l.Lk)("div",Ee,[(0,l.Lk)("h3",je,(0,y.v_)(o.totalAdvisers),1),a[9]||(a[9]=(0,l.Lk)("p",{class:"stat-label"},"SSP Advisers",-1))])]),(0,l.Lk)("div",Ie,[a[12]||(a[12]=(0,l.Lk)("div",{class:"stat-icon"},[(0,l.Lk)("i",{class:"fas fa-users"})],-1)),(0,l.Lk)("div",Ye,[(0,l.Lk)("h3",Fe,(0,y.v_)(o.activeSections),1),a[11]||(a[11]=(0,l.Lk)("p",{class:"stat-label"},"Active Sections",-1))])])]),(0,l.Lk)("div",xe,[(0,l.Lk)("div",Te,[a[14]||(a[14]=(0,l.Lk)("div",{class:"stat-icon"},[(0,l.Lk)("i",{class:"fas fa-clock"})],-1)),(0,l.Lk)("div",Ne,[o.hasAttendanceData?((0,l.uX)(),(0,l.CE)("h3",Pe,(0,y.v_)(o.averageAttendance)+"%",1)):(0,l.Q3)("",!0),a[13]||(a[13]=(0,l.Lk)("p",{class:"stat-label"},"Average Attendance",-1)),o.hasAttendanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Re,"No data available"))])]),(0,l.Lk)("div",Me,[a[16]||(a[16]=(0,l.Lk)("div",{class:"stat-icon"},[(0,l.Lk)("i",{class:"fas fa-chart-line"})],-1)),(0,l.Lk)("div",_e,[o.hasScoreData?((0,l.uX)(),(0,l.CE)("h3",$e,(0,y.v_)(o.averageScore)+"%",1)):(0,l.Q3)("",!0),a[15]||(a[15]=(0,l.Lk)("p",{class:"stat-label"},"Average Score",-1)),o.hasScoreData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Ke,"No data available"))])])]),(0,l.Lk)("div",ze,[(0,l.Lk)("div",We,[a[17]||(a[17]=(0,l.Lk)("h5",{class:"chart-title"},"Performance Distribution",-1)),(0,l.Lk)("div",Xe,[(0,l.Lk)("canvas",Be,null,512),o.hasPerformanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Ue,"No data available"))])]),(0,l.Lk)("div",He,[a[18]||(a[18]=(0,l.Lk)("h5",{class:"chart-title"},"Assessment Types",-1)),(0,l.Lk)("div",Oe,[(0,l.Lk)("canvas",Qe,null,512),e.data?.assessmentTypeDistribution?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Ve,"No data available"))])])]),(0,l.Lk)("div",qe,[a[19]||(a[19]=(0,l.Lk)("h5",{class:"chart-title"},"Attendance Trends",-1)),(0,l.Lk)("div",Je,[(0,l.Lk)("canvas",Ge,null,512),o.hasAttendanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Ze,"No data available"))])]),(0,l.Lk)("div",ea,[a[20]||(a[20]=(0,l.Lk)("h5",{class:"chart-title"},"Section Performance",-1)),(0,l.Lk)("div",aa,[(0,l.Lk)("canvas",ta,null,512),o.hasSectionData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",sa,"No data available"))])])],512)}t(1701),t(8237);var oa=t(6591);const na=p.A.create({baseURL:"http://localhost:8000/api"});var ra={name:"Dashboard",setup(){const e=(0,v.Pj)(),a=(0,W.KR)(null),t=(0,W.KR)(null),s=(0,W.KR)(null),o=(0,W.KR)(null),n=(0,W.KR)(""),r=(0,l.EW)((()=>e.getters.isCITHead)),c=(0,l.EW)((()=>e.state.auth.token));(0,l.wB)(c,(e=>{e&&(na.defaults.headers.common["Authorization"]=`Bearer ${e}`)}),{immediate:!0});const i=(0,W.KR)(0),d=(0,W.KR)(0),u=(0,W.KR)(0),p=(0,W.KR)(0),m=(0,W.KR)(0),b=(0,W.KR)(0),f=(0,l.EW)((()=>y.value?.attendanceTrends?.length>0)),h=(0,l.EW)((()=>y.value?.averageScore>0)),g=(0,l.EW)((()=>y.value?.performanceDistribution&&Array.isArray(y.value.performanceDistribution)&&y.value.performanceDistribution.some((e=>e>=0)))),k=(0,l.EW)((()=>y.value?.sections?.length>0)),y=(0,W.KR)(null),L=async()=>{try{const e=await na.get("/dashboard/stats",{params:{year:n.value}});y.value=e.data,console.log("Raw Dashboard Data:",{performanceDistribution:{data:y.value.performanceDistribution,isArray:Array.isArray(y.value.performanceDistribution),length:y.value.performanceDistribution?.length},assessmentTypeDistribution:{data:y.value.assessmentTypeDistribution,hasDatasets:Boolean(y.value.assessmentTypeDistribution?.datasets),datasetsLength:y.value.assessmentTypeDistribution?.datasets?.length,labels:y.value.assessmentTypeDistribution?.labels}}),i.value=y.value.totalStudents||0,d.value=y.value.totalTeachers||0,u.value=y.value.totalAdvisers||0,p.value=y.value.averageAttendance||0,m.value=y.value.averageScore||0,b.value=y.value.activeSections||0,y.value&&S(y.value)}catch(e){console.error("Failed to fetch dashboard data:",e),e.response&&console.error("Error response:",e.response.data)}},S=e=>{if(a.value){const e=oa.Ay.getChart(a.value);e&&e.destroy()}if(t.value){const e=oa.Ay.getChart(t.value);e&&e.destroy()}if(s.value){const e=oa.Ay.getChart(s.value);e&&e.destroy()}if(o.value){const e=oa.Ay.getChart(o.value);e&&e.destroy()}if(e.performanceDistribution&&Array.isArray(e.performanceDistribution)){console.log("Creating performance chart with data:",e.performanceDistribution);const t=e.performanceDistribution.map((e=>Number(e)||0));new oa.Ay(a.value,{type:"pie",data:{labels:["90-100","80-89","70-79","60-69","Below 60"],datasets:[{data:t,backgroundColor:["#4CAF50","#2196F3","#FFC107","#FF9800","#F44336"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10}},plugins:{legend:{display:!0,position:"right",labels:{padding:20,usePointStyle:!0,pointStyle:"circle"}},tooltip:{callbacks:{label:function(e){const a=e.raw,t=e.dataset.data.reduce(((e,a)=>e+a),0),s=(a/t*100).toFixed(1);return`${e.label}: ${a} students (${s}%)`}}},title:{display:!0,text:"Student Grade Distribution",font:{size:16}}}}})}if(e.assessmentTypeDistribution){console.log("Creating assessment type chart with data:",e.assessmentTypeDistribution);const a={Quiz:"rgba(76, 175, 80, 0.7)",Activity:"rgba(33, 150, 243, 0.7)","Performance Task":"rgba(255, 193, 7, 0.7)"},t={Quiz:"#4CAF50",Activity:"#2196F3","Performance Task":"#FFC107"},s=e.assessmentTypeDistribution.datasets.map((e=>({label:e.type,data:e.data.map((e=>Number(e)||0)),backgroundColor:a[e.type],borderColor:t[e.type],borderWidth:2,tension:.4,fill:!0,pointBackgroundColor:t[e.type],pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6})));new oa.Ay(o.value,{type:"line",data:{labels:e.assessmentTypeDistribution.labels||[],datasets:s},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10}},interaction:{mode:"index",intersect:!1},scales:{x:{title:{display:!0,text:"Month/Year"},grid:{display:!1}},y:{beginAtZero:!0,title:{display:!0,text:"Number of Assessments"},ticks:{stepSize:1,precision:0},grid:{color:"rgba(0,0,0,0.05)"}}},plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(255,255,255,0.9)",titleColor:"#000",bodyColor:"#000",borderColor:"rgba(0,0,0,0.1)",borderWidth:1,padding:10,displayColors:!0,callbacks:{label:function(e){return`${e.dataset.label}: ${e.parsed.y} assessments`}}}}}})}e.attendanceTrends&&e.attendanceTrends.length>0&&new oa.Ay(t.value,{type:"line",data:{labels:e.attendanceTrends.map((e=>{const a=new Date(e.date);return`${a.toLocaleString("default",{month:"short"})} ${a.getFullYear()}`})),datasets:[{label:"Attendance Rate",data:e.attendanceTrends.map((e=>e.rate)),borderColor:"#2196F3",tension:.1,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(e){return e+"%"}}}},plugins:{tooltip:{callbacks:{label:function(e){return`Attendance: ${e.parsed.y.toFixed(1)}%`}}},title:{display:!0,text:"Monthly Attendance Trends",font:{size:16}}}}}),e.sections&&e.sections.length>0&&new oa.Ay(s.value,{type:"bar",data:{labels:e.sections.map((e=>`${e.year} - ${e.name}`)),datasets:[{label:"Average Performance",data:e.sections.map((e=>e.performance)),backgroundColor:e.sections.map((e=>{switch(e.year){case"1st":return"#4CAF50";case"2nd":return"#2196F3";case"3rd":return"#FFC107";case"4th":return"#FF5722";default:return"#9E9E9E"}})),borderColor:"#fff",borderWidth:2}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:10,left:10,right:10}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0,0,0,0.8)",titleFont:{size:14},bodyFont:{size:12},padding:10,cornerRadius:5,callbacks:{label:function(a){const t=e.sections[a.dataIndex];return[`Performance: ${a.parsed.x.toFixed(1)}%`,`Students: ${t.studentCount}`]}}},title:{display:!0,text:"Section Performance by Year Level",font:{size:16}}},scales:{x:{grid:{display:!1},ticks:{color:"#666",callback:function(e){return e+"%"}},title:{display:!0,text:"Performance (%)"}},y:{grid:{display:!1},ticks:{color:"#666"}}}}})},w=(0,W.KR)(null),C=(0,W.KR)(!1),A=(0,W.KR)(null),D=(0,W.KR)(null),E=e=>{const a=document.getElementById(e);a&&a.scrollIntoView({behavior:"smooth",block:"start"})},j=async()=>{C.value=!0;try{await L(),n.value?localStorage.setItem("selectedYear",n.value):localStorage.removeItem("selectedYear")}catch(e){console.error("Error updating dashboard:",e)}finally{C.value=!1}},I=async()=>{C.value=!0;try{await L(),A.value=new Date}catch(e){console.error("Error refreshing dashboard:",e)}finally{C.value=!1}},Y=()=>{D.value&&clearInterval(D.value),D.value=setInterval(I,3e5)};return(0,l.sV)((()=>{const e=localStorage.getItem("selectedYear");e&&(n.value=e),L(),Y(),A.value=new Date})),(0,l.hi)((()=>{D.value&&clearInterval(D.value)})),{performanceChart:a,attendanceChart:t,sectionChart:s,assessmentTypeChart:o,selectedYear:n,isCITHead:r,totalStudents:i,totalTeachers:d,totalAdvisers:u,averageAttendance:p,averageScore:m,activeSections:b,hasAttendanceData:f,hasScoreData:h,hasPerformanceData:g,hasSectionData:k,dashboardContainer:w,isLoading:C,lastUpdate:A,scrollToSection:E,handleYearChange:j,refreshDashboard:I}}};const ca=(0,i.A)(ra,[["render",la],["__scopeId","data-v-2cd178e7"]]);var ia=ca;const da={class:"dashboard"},ua={class:"d-flex justify-content-between align-items-center mb-4"},va={class:"dropdown"},pa={class:"btn btn-filter dropdown-toggle",type:"button",id:"filterDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},ma={class:"dropdown-menu filter-menu p-3","aria-labelledby":"filterDropdown"},ba={class:"mb-3"},fa={class:"mb-3"},ha=["disabled"],ga=["value"],ka={class:"mb-3"},ya=["disabled"],La=["value"],Sa={class:"mb-3"},wa={class:"d-flex gap-2"},Ca={class:"flex-grow-1"},Aa=["max"],Da={class:"flex-grow-1"},Ea=["max"],ja={class:"row g-4"},Ia={class:"col-md-3"},Ya={class:"dashboard-card"},Fa={class:"card-info"},xa={class:"stat-value"},Ta={class:"col-md-3"},Na={class:"dashboard-card"},Pa={class:"card-info"},Ra={class:"stat-value"},Ma={class:"col-md-3"},_a={class:"dashboard-card"},$a={class:"card-info"},Ka={class:"stat-value"},za={class:"col-md-3"},Wa={class:"dashboard-card"},Xa={class:"card-info"},Ba={key:0,class:"stat-value"},Ua={key:1,class:"no-data"},Ha={class:"row mt-4"},Oa={class:"col-md-6"},Qa={class:"dashboard-card h-100"},Va={class:"card-info"},qa={key:0,class:"stat-value"},Ja={key:1,class:"no-data"},Ga={class:"col-md-6"},Za={class:"dashboard-card h-100"},et={class:"card-info"},at={key:0,class:"stat-value"},tt={key:1,class:"no-data"},st={class:"row mb-4"},lt={class:"col-md-6 mb-4"},ot={class:"chart-card"},nt={class:"card-body"},rt={class:"chart-container"},ct={ref:"performanceChart"},it={key:0,class:"no-data-message"},dt={class:"col-md-6 mb-4"},ut={class:"chart-card"},vt={class:"card-body"},pt={class:"chart-container"},mt={ref:"assessmentTypeChart"},bt={key:0,class:"no-data-message"},ft={class:"col-md-6 mb-4"},ht={class:"chart-card"},gt={class:"card-body"},kt={class:"chart-container"},yt={ref:"performanceTrendChart"},Lt={key:0,class:"no-data-message"},St={class:"col-md-6 mb-4"},wt={class:"chart-card"},Ct={class:"card-body"},At={class:"chart-container"},Dt={ref:"assessmentTypePerformanceChart"},Et={key:0,class:"no-data-message"},jt={class:"card mb-4"},It={class:"card-body"},Yt={class:"table-responsive"},Ft={class:"table"},xt={key:0};function Tt(e,a,t,o,n,r){return(0,l.uX)(),(0,l.CE)("div",da,[(0,l.Lk)("div",ua,[a[19]||(a[19]=(0,l.Lk)("h2",{class:"dashboard-title"},null,-1)),(0,l.Lk)("div",va,[(0,l.Lk)("button",pa,[a[7]||(a[7]=(0,l.Lk)("i",{class:"fas fa-filter me-2"},null,-1)),(0,l.eW)(" "+(0,y.v_)(o.getFilterDisplay()),1)]),(0,l.Lk)("div",ma,[a[17]||(a[17]=(0,l.Lk)("h6",{class:"dropdown-header"},"Filter Options",-1)),(0,l.Lk)("div",ba,[a[9]||(a[9]=(0,l.Lk)("label",{class:"form-label"},"Academic Year",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select mb-2","onUpdate:modelValue":a[0]||(a[0]=e=>o.selectedYear=e),onChange:a[1]||(a[1]=(...e)=>o.handleYearChange&&o.handleYearChange(...e))},a[8]||(a[8]=[(0,l.Fv)('<option value="" data-v-65209e94>All Years</option><option value="1st" data-v-65209e94>1st Year</option><option value="2nd" data-v-65209e94>2nd Year</option><option value="3rd" data-v-65209e94>3rd Year</option><option value="4th" data-v-65209e94>4th Year</option>',5)]),544),[[s.u1,o.selectedYear]])]),(0,l.Lk)("div",fa,[a[11]||(a[11]=(0,l.Lk)("label",{class:"form-label"},"Section",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select mb-2","onUpdate:modelValue":a[2]||(a[2]=e=>o.selectedSection=e),disabled:!o.selectedYear},[a[10]||(a[10]=(0,l.Lk)("option",{value:""},"All Sections",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.sections,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,ga)))),128))],8,ha),[[s.u1,o.selectedSection]])]),(0,l.Lk)("div",ka,[a[13]||(a[13]=(0,l.Lk)("label",{class:"form-label"},"Subject",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select mb-2","onUpdate:modelValue":a[3]||(a[3]=e=>o.selectedSubject=e),disabled:!o.selectedYear},[a[12]||(a[12]=(0,l.Lk)("option",{value:""},"All Subjects",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.subjects,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,La)))),128))],8,ya),[[s.u1,o.selectedSubject]])]),(0,l.Lk)("div",Sa,[a[16]||(a[16]=(0,l.Lk)("label",{class:"form-label"},"Date Range",-1)),(0,l.Lk)("div",wa,[(0,l.Lk)("div",Ca,[a[14]||(a[14]=(0,l.Lk)("label",{class:"small text-muted"},"From",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control form-control-sm","onUpdate:modelValue":a[4]||(a[4]=e=>o.selectedStartDate=e),max:o.today},null,8,Aa),[[s.Jo,o.selectedStartDate]])]),(0,l.Lk)("div",Da,[a[15]||(a[15]=(0,l.Lk)("label",{class:"small text-muted"},"To",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control form-control-sm","onUpdate:modelValue":a[5]||(a[5]=e=>o.selectedEndDate=e),max:o.today},null,8,Ea),[[s.Jo,o.selectedEndDate]])])])]),a[18]||(a[18]=(0,l.Lk)("div",{class:"dropdown-divider"},null,-1)),(0,l.Lk)("button",{class:"btn btn-primary w-100",onClick:a[6]||(a[6]=(...e)=>o.applyFilters&&o.applyFilters(...e))},"Apply Filters")])])]),(0,l.Lk)("div",ja,[(0,l.Lk)("div",Ia,[(0,l.Lk)("div",Ya,[a[21]||(a[21]=(0,l.Lk)("div",{class:"icon-container"},[(0,l.Lk)("i",{class:"fas fa-user-graduate"})],-1)),(0,l.Lk)("div",Fa,[a[20]||(a[20]=(0,l.Lk)("h3",{class:"stat-title"},"Total Students",-1)),(0,l.Lk)("div",xa,(0,y.v_)(o.totalStudents),1)])])]),(0,l.Lk)("div",Ta,[(0,l.Lk)("div",Na,[a[23]||(a[23]=(0,l.Lk)("div",{class:"icon-container"},[(0,l.Lk)("i",{class:"fas fa-chalkboard"})],-1)),(0,l.Lk)("div",Pa,[a[22]||(a[22]=(0,l.Lk)("h3",{class:"stat-title"},"Active Sections",-1)),(0,l.Lk)("div",Ra,(0,y.v_)(o.totalSections),1)])])]),(0,l.Lk)("div",Ma,[(0,l.Lk)("div",_a,[a[25]||(a[25]=(0,l.Lk)("div",{class:"icon-container"},[(0,l.Lk)("i",{class:"fas fa-book"})],-1)),(0,l.Lk)("div",$a,[a[24]||(a[24]=(0,l.Lk)("h3",{class:"stat-title"},"My Subjects",-1)),(0,l.Lk)("div",Ka,(0,y.v_)(o.totalSubjects),1)])])]),(0,l.Lk)("div",za,[(0,l.Lk)("div",Wa,[a[27]||(a[27]=(0,l.Lk)("div",{class:"icon-container"},[(0,l.Lk)("i",{class:"fas fa-chart-line"})],-1)),(0,l.Lk)("div",Xa,[a[26]||(a[26]=(0,l.Lk)("h3",{class:"stat-title"},"Class Average",-1)),o.hasPerformanceData?((0,l.uX)(),(0,l.CE)("div",Ba,(0,y.v_)(o.averageScore)+"%",1)):((0,l.uX)(),(0,l.CE)("div",Ua,"No data available"))])])])]),(0,l.Lk)("div",Ha,[(0,l.Lk)("div",Oa,[(0,l.Lk)("div",Qa,[a[29]||(a[29]=(0,l.Lk)("div",{class:"icon-container"},[(0,l.Lk)("i",{class:"fas fa-clock"})],-1)),(0,l.Lk)("div",Va,[a[28]||(a[28]=(0,l.Lk)("h3",{class:"stat-title"},"Average Attendance",-1)),o.hasAttendanceData?((0,l.uX)(),(0,l.CE)("div",qa,(0,y.v_)(o.averageAttendance)+"%",1)):((0,l.uX)(),(0,l.CE)("div",Ja,"No attendance data available"))])])]),(0,l.Lk)("div",Ga,[(0,l.Lk)("div",Za,[a[31]||(a[31]=(0,l.Lk)("div",{class:"icon-container"},[(0,l.Lk)("i",{class:"fas fa-tasks"})],-1)),(0,l.Lk)("div",et,[a[30]||(a[30]=(0,l.Lk)("h3",{class:"stat-title"},"Assessment Completion",-1)),o.hasAssessmentData?((0,l.uX)(),(0,l.CE)("div",at,(0,y.v_)(o.assessmentCompletion)+"%",1)):((0,l.uX)(),(0,l.CE)("div",tt,"No assessment data available"))])])])]),(0,l.Lk)("div",st,[(0,l.Lk)("div",lt,[(0,l.Lk)("div",ot,[(0,l.Lk)("div",nt,[a[32]||(a[32]=(0,l.Lk)("h5",{class:"card-title"},"Grade Distribution",-1)),(0,l.Lk)("div",rt,[(0,l.Lk)("canvas",ct,null,512),o.hasPerformanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",it,"No performance data available"))])])])]),(0,l.Lk)("div",dt,[(0,l.Lk)("div",ut,[(0,l.Lk)("div",vt,[a[33]||(a[33]=(0,l.Lk)("h5",{class:"card-title"},"Assessment Type Distribution",-1)),(0,l.Lk)("div",pt,[(0,l.Lk)("canvas",mt,null,512),o.hasPerformanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",bt,"No assessment data available"))])])])]),(0,l.Lk)("div",ft,[(0,l.Lk)("div",ht,[(0,l.Lk)("div",gt,[a[34]||(a[34]=(0,l.Lk)("h5",{class:"card-title"},"Performance Trends",-1)),(0,l.Lk)("div",kt,[(0,l.Lk)("canvas",yt,null,512),o.hasPerformanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Lt,"No performance data available"))])])])]),(0,l.Lk)("div",St,[(0,l.Lk)("div",wt,[(0,l.Lk)("div",Ct,[a[35]||(a[35]=(0,l.Lk)("h5",{class:"card-title"},"Performance by Assessment Type",-1)),(0,l.Lk)("div",At,[(0,l.Lk)("canvas",Dt,null,512),o.hasPerformanceData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Et,"No performance data available"))])])])])]),(0,l.Lk)("div",jt,[(0,l.Lk)("div",It,[a[38]||(a[38]=(0,l.Lk)("h5",{class:"card-title"},"Recent Activity",-1)),(0,l.Lk)("div",Yt,[(0,l.Lk)("table",Ft,[a[37]||(a[37]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Date"),(0,l.Lk)("th",null,"Activity"),(0,l.Lk)("th",null,"Details")])],-1)),(0,l.Lk)("tbody",null,[o.hasActivity?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",xt,a[36]||(a[36]=[(0,l.Lk)("td",{colspan:"3",class:"text-center"},"No recent activity",-1)]))),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.recentActivities,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,y.v_)(o.formatDate(e.date)),1),(0,l.Lk)("td",null,(0,y.v_)(e.type),1),(0,l.Lk)("td",null,(0,y.v_)(e.details),1)])))),128))])])])])])])}t(116),t(7588),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);var Nt=t(9148),Pt=t.n(Nt),Rt={name:"TeacherDashboard",setup(){const e=(0,v.Pj)(),a=(0,W.KR)(null),t=(0,W.KR)(null),s=(0,W.KR)(null),o=(0,W.KR)(null),n=(0,W.KR)(null),r=(0,W.KR)(0),c=(0,W.KR)(0),i=(0,W.KR)(0),d=(0,W.KR)(0),u=(0,W.KR)(0),m=(0,W.KR)(0),b=(0,W.KR)([]),f=(0,W.KR)([]),h=(0,W.KR)([]),g=(0,W.KR)(localStorage.getItem("selectedYear")||""),k=(0,W.KR)(localStorage.getItem("selectedSection")||""),y=(0,W.KR)(localStorage.getItem("selectedSubject")||""),L=(0,W.KR)(""),S=(0,W.KR)(""),w=(0,l.EW)((()=>Pt()().format("YYYY-MM-DD"))),C=()=>{const a=e.state.auth.user;return a&&a._id?a._id:(console.error("No teacher ID found in store"),null)},A=(0,l.EW)((()=>d.value>0)),D=(0,l.EW)((()=>u.value>0)),E=(0,l.EW)((()=>m.value>0)),j=(0,l.EW)((()=>b.value.length>0)),I=async(a="")=>{try{const t=C();if(!t)return;const s=e.state.auth.token;console.log("Fetching sections and subjects for:",{teacherId:t,year:a});const l=await p.A.get("http://localhost:8000/api/teacher-class-records",{params:{teacherId:t,year:a},headers:{Authorization:`Bearer ${s}`}});if(l.data){const e=[...new Set(l.data.map((e=>e.section)))],a=[...new Set(l.data.map((e=>e.subject)))];f.value=e.sort(),h.value=a.sort(),console.log("Loaded sections and subjects:",{sections:f.value,subjects:h.value})}}catch(t){console.error("Error fetching teacher sections and subjects:",t),f.value=[],h.value=[]}},Y=async()=>{k.value="",y.value="",g.value?await I(g.value):(f.value=[],h.value=[]),await x()},F=()=>{const e=[];return g.value&&e.push(g.value+" Year"),k.value&&e.push(k.value),y.value&&e.push(y.value),e.length>0?e.join(" - "):"Filter View"},x=async()=>{try{const a=C();if(!a)return void console.error("No teacher ID found");const t=e.state.auth.token;if(!t)return void console.error("No auth token found");console.log("Fetching dashboard data with params:",{teacherId:a,year:g.value,section:k.value,subject:y.value,startDate:L.value,endDate:S.value});const s=await p.A.get(`http://localhost:8000/api/dashboard/teacher/${a}/stats`,{params:{year:g.value,section:k.value,subject:y.value,startDate:L.value,endDate:S.value},headers:{Authorization:`Bearer ${t}`}});console.log("Dashboard data received:",s.data),s.data&&(r.value=s.data.totalStudents||0,c.value=s.data.totalSections||0,i.value=s.data.totalSubjects||0,d.value=s.data.averageAttendance||0,u.value=s.data.averageScore||0,m.value=s.data.assessmentCompletion?.overall||0,b.value=s.data.recentActivities||[],console.log("Performance Distribution:",s.data.performanceDistribution),console.log("Assessment Type Distribution:",s.data.assessmentTypeDistribution),console.log("Performance Trends:",s.data.performanceTrends),console.log("Assessment Completion by Type:",s.data.assessmentCompletion?.byType),Array.isArray(s.data.performanceDistribution)?T(s.data):(console.warn("Invalid performance distribution data:",s.data.performanceDistribution),T({performanceDistribution:[0,0,0,0,0]})),Array.isArray(s.data.assessmentTypeDistribution)?N(s.data.assessmentTypeDistribution):(console.warn("Invalid assessment type distribution data:",s.data.assessmentTypeDistribution),N([{type:"Quiz",percentage:0},{type:"Activity",percentage:0},{type:"Performance Task",percentage:0}])),Array.isArray(s.data.performanceTrends)?P(s.data.performanceTrends):(console.warn("Invalid performance trends data:",s.data.performanceTrends),P([])),s.data.assessmentCompletion?.byType?R(s.data):(console.warn("Invalid assessment completion data:",s.data.assessmentCompletion),R({assessmentCompletion:{byType:{quiz:0,activity:0,performancetask:0}}})))}catch(a){console.error("Error fetching dashboard data:",a),a.response&&console.error("Error response:",a.response.data),r.value=0,c.value=0,i.value=0,d.value=0,u.value=0,m.value=0,b.value=[],T({performanceDistribution:[0,0,0,0,0]}),N([{type:"Quiz",percentage:0},{type:"Activity",percentage:0},{type:"Performance Task",percentage:0}]),P([]),R({assessmentCompletion:{byType:{quiz:0,activity:0,performancetask:0}}})}},T=e=>{if(!a.value)return;const t=a.value.getContext("2d");if(!t)return;const s=oa.Ay.getChart(t);s&&s.destroy();const l=Array.isArray(e.performanceDistribution)?e.performanceDistribution:[0,0,0,0,0];console.log("Performance distribution data:",l),new oa.Ay(t,{type:"bar",data:{labels:["90-100","80-89","70-79","60-69","Below 60"],datasets:[{label:"Number of Students",data:l,backgroundColor:["rgba(52, 211, 153, 0.8)","rgba(59, 130, 246, 0.8)","rgba(251, 191, 36, 0.8)","rgba(251, 146, 60, 0.8)","rgba(239, 68, 68, 0.8)"],borderWidth:1,borderRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>{const a=e.raw||0,t=l.reduce(((e,a)=>e+(a||0)),0),s=t>0?(a/t*100).toFixed(1):0;return`${a} students (${s}%)`}}}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1},title:{display:!0,text:"Number of Students"}}}}})},N=e=>{if(!s.value)return;const a=s.value.getContext("2d");if(!a)return;const t=oa.Ay.getChart(a);t&&t.destroy();const l=e.labels||[],o=e.datasets||[];new oa.Ay(a,{type:"bar",data:{labels:l,datasets:o.map(((e,a)=>({label:e.type,data:e.data,backgroundColor:["rgba(52, 211, 153, 0.8)","rgba(59, 130, 246, 0.8)","rgba(251, 191, 36, 0.8)"][a],borderWidth:1})))},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,ticks:{maxRotation:45,minRotation:45}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Number of Assessments"}}},plugins:{legend:{position:"top"},tooltip:{callbacks:{label:e=>`${e.dataset.label}: ${e.raw||0} assessments`}}}}})},P=e=>{if(!o.value)return void console.warn("Performance trend chart reference not found");const a=o.value.getContext("2d");if(!a)return void console.warn("Could not get 2d context for performance trend chart");const t=oa.Ay.getChart(a);t&&t.destroy();const s=Array.isArray(e)?e:[];console.log("Creating performance trend chart with data:",s),new oa.Ay(a,{type:"line",data:{labels:s.map((e=>Pt()(e.date).format("MMM D, YYYY"))),datasets:[{label:"Average Score",data:s.map((e=>Number(e.score)||0)),borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>{const a=s[e.dataIndex];return`${a.name}: ${(e.raw||0).toFixed(1)}%`}}}},scales:{y:{beginAtZero:!0,max:100,ticks:{stepSize:20,font:{size:12}},title:{display:!0,text:"Average Score (%)",font:{size:14,weight:"bold"}}},x:{ticks:{font:{size:12},maxRotation:45,minRotation:45}}}}})},R=e=>{if(!n.value)return;const a=n.value.getContext("2d");if(!a)return;const t=oa.Ay.getChart(a);t&&t.destroy();const s={Quiz:[],Activity:[],"Performance Task":[]};Array.isArray(e.performanceTrends)&&e.performanceTrends.forEach((e=>{const a=e.type||e.name;a in s&&s[a].push({date:new Date(e.date),score:parseFloat(e.score)||0})})),Object.keys(s).forEach((e=>{s[e].sort(((e,a)=>e.date-a.date))}));const l=[...new Set(Object.values(s).flat().map((e=>e.date)))].sort(((e,a)=>e-a)),o=Object.entries(s).map((([e,a],t)=>{const s=["rgb(52, 211, 153)","rgb(59, 130, 246)","rgb(251, 191, 36)"],o=s[t];return{label:e,data:l.map((e=>{const t=a.find((a=>a.date.getTime()===e.getTime()));return t?t.score:null})),borderColor:o,backgroundColor:o.replace("rgb","rgba").replace(")",", 0.1)"),fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6,spanGaps:!0}}));new oa.Ay(a,{type:"line",data:{labels:l.map((e=>Pt()(e).format("MMM D, YYYY"))),datasets:o},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top"},tooltip:{callbacks:{label:e=>{const a=null!==e.raw?e.raw.toFixed(1):"N/A";return`${e.dataset.label}: ${a}%`}}}},scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Score (%)"}},x:{ticks:{maxRotation:45,minRotation:45}}}}})},M=e=>Pt()(e).format("MMM D, YYYY"),_=async()=>{g.value?localStorage.setItem("selectedYear",g.value):localStorage.removeItem("selectedYear"),k.value?localStorage.setItem("selectedSection",k.value):localStorage.removeItem("selectedSection"),y.value?localStorage.setItem("selectedSubject",y.value):localStorage.removeItem("selectedSubject"),await x()};return(0,l.wB)(g,Y),(0,l.wB)([k,y],_),(0,l.wB)([L,S],(()=>{if(L.value&&S.value){const e=Pt()(L.value),a=Pt()(S.value);a.isBefore(e)&&(S.value=L.value),x()}})),(0,l.sV)((async()=>{if(e.state.auth.user?._id&&e.state.auth.token){console.log("Component mounted, initializing..."),await(0,l.dY)();try{console.log("Initializing empty charts..."),T({performanceDistribution:[0,0,0,0,0]}),N([{type:"Quiz",percentage:0},{type:"Activity",percentage:0},{type:"Performance Task",percentage:0}]),P([]),R({assessmentCompletion:{byType:{quiz:0,activity:0,performancetask:0}}}),console.log("Empty charts initialized"),await I(g.value),console.log("Sections and subjects fetched"),await x(),console.log("Initial data fetch completed")}catch(a){console.error("Error during initialization:",a)}}else console.error("No user ID or token found")})),{totalStudents:r,totalSections:c,totalSubjects:i,averageAttendance:d,averageScore:u,assessmentCompletion:m,performanceChart:a,attendanceChart:t,recentActivities:b,sections:f,subjects:h,selectedYear:g,selectedSection:k,selectedSubject:y,hasAttendanceData:A,hasPerformanceData:D,hasAssessmentData:E,hasActivity:j,formatDate:M,getFilterDisplay:F,handleYearChange:Y,applyFilters:_,assessmentTypeChart:s,performanceTrendChart:o,assessmentTypePerformanceChart:n,selectedStartDate:L,selectedEndDate:S,today:w}}};const Mt=(0,i.A)(Rt,[["render",Tt],["__scopeId","data-v-65209e94"]]);var _t=Mt;const $t={class:"student-management"},Kt={class:"sticky-controls"},zt={class:"d-flex gap-2 mb-3"},Wt={class:"table-controls mb-3"},Xt={class:"d-flex justify-content-between align-items-center"},Bt={class:"d-flex align-items-center gap-3"},Ut={class:"dropdown"},Ht={class:"dropdown-menu shadow-lg","aria-labelledby":"sortDropdown"},Ot={class:"dropdown"},Qt={class:"btn btn-control",type:"button",id:"filterDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},Vt={key:0,class:"filter-badge"},qt={class:"dropdown-menu shadow-lg p-3","aria-labelledby":"filterDropdown"},Jt={class:"d-flex justify-content-between align-items-center mb-2"},Gt={class:"mb-3"},Zt={class:"mb-3"},es={class:"search-control"},as={class:"input-group"},ts={class:"table-responsive"},ss={class:"table table-hover"},ls=["onClick"],os={key:1},ns={colspan:"6",class:"text-center py-4"},rs={class:"empty-state-message"},cs={key:0,class:"text-muted small"},is={class:"pagination-controls mt-3 d-flex justify-content-between align-items-center"},ds={class:"pagination-info"},us={class:"pagination-buttons"},vs=["disabled"],ps=["disabled"],ms={key:0,class:"add-student-modal"},bs={class:"add-student-dialog"},fs={class:"add-student-content"},hs={class:"modal-header bg-primary text-white"},gs={class:"modal-body"},ks={class:"mb-3"},ys=["value"],Ls={class:"mb-3"},Ss={class:"text-end"},ws=["disabled"],Cs={class:"modal-dialog modal-xxl"},As={class:"modal-content"},Ds={class:"modal-header bg-primary text-white"},Es={class:"modal-body"},js={class:"student-details"},Is={class:"student-info"},Ys={class:"info-content"},Fs={class:"student-charts"},xs={class:"chart-section"},Ts={ref:"performanceChart"},Ns={class:"chart-section"},Ps={class:"table-responsive attendance-table"},Rs={class:"table"},Ms={key:2,class:"modal-wrapper"},_s={class:"modal-dialog"},$s={class:"modal-content"},Ks={class:"modal-header"},zs={class:"modal-body"},Ws={class:"mb-3"},Xs={class:"mb-3"},Bs={class:"mb-3"},Us={class:"mb-3"},Hs={class:"mb-3"},Os=["value"],Qs={class:"mb-3"},Vs=["value"],qs={class:"d-flex justify-content-end gap-2"},Js={key:3,class:"modal-wrapper"},Gs={class:"modal-dialog"},Zs={class:"modal-content"},el={class:"modal-header"},al={class:"modal-body"},tl={class:"text-danger"},sl={class:"modal-footer"},ll={key:4,class:"modal-wrapper"},ol={class:"modal-dialog"},nl={class:"modal-content"},rl={class:"modal-header bg-success text-white"},cl={class:"modal-body"},il={class:"mb-3"},dl={class:"mb-3"},ul={class:"mb-3"},vl={class:"mb-3"},pl={class:"mb-3"},ml={class:"mb-3"},bl={class:"mb-3"},fl=["value"],hl={class:"mb-3"},gl=["value"],kl={class:"d-flex justify-content-end gap-2"},yl=["disabled"];function Ll(e,a,t,o,n,r){return(0,l.uX)(),(0,l.CE)("div",$t,[(0,l.Lk)("div",Kt,[(0,l.Lk)("div",zt,[(0,l.Lk)("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=e=>o.showAddStudentModal=!0)},a[49]||(a[49]=[(0,l.Lk)("i",{class:"fas fa-plus me-1"},null,-1),(0,l.eW)(" Add Student List ")])),(0,l.Lk)("button",{class:"btn btn-success",onClick:a[1]||(a[1]=e=>o.showAddSingleStudentModal=!0)},a[50]||(a[50]=[(0,l.Lk)("i",{class:"fas fa-user-plus me-1"},null,-1),(0,l.eW)(" Add Single Student ")]))]),(0,l.Lk)("div",Wt,[(0,l.Lk)("div",Xt,[(0,l.Lk)("div",Bt,[(0,l.Lk)("div",Ut,[a[55]||(a[55]=(0,l.Lk)("button",{class:"btn btn-control",type:"button",id:"sortDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,l.Lk)("i",{class:"fas fa-sort me-2"}),(0,l.eW)(" Sort by ")],-1)),(0,l.Lk)("ul",Ht,[(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center gap-2",href:"#",onClick:a[2]||(a[2]=(0,s.D$)((e=>o.sortBy("studentId")),["prevent"]))},[a[51]||(a[51]=(0,l.Lk)("i",{class:"fas fa-sort-numeric-down"},null,-1)),a[52]||(a[52]=(0,l.Lk)("span",null,"ID Number",-1)),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("studentId"),"ms-auto"])},null,2)])]),(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center gap-2",href:"#",onClick:a[3]||(a[3]=(0,s.D$)((e=>o.sortBy("lastName")),["prevent"]))},[a[53]||(a[53]=(0,l.Lk)("i",{class:"fas fa-sort-alpha-down"},null,-1)),a[54]||(a[54]=(0,l.Lk)("span",null,"Name",-1)),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("lastName"),"ms-auto"])},null,2)])])])]),(0,l.Lk)("div",Ot,[(0,l.Lk)("button",Qt,[a[56]||(a[56]=(0,l.Lk)("i",{class:"fas fa-filter me-2"},null,-1)),(0,l.eW)(" "+(0,y.v_)(o.hasActiveFilters?`${o.selectedYear||"All Years"} - ${o.selectedSection||"All Sections"}`:"Filter Students")+" ",1),o.hasActiveFilters?((0,l.uX)(),(0,l.CE)("span",Vt,"!")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",qt,[(0,l.Lk)("div",Jt,[a[57]||(a[57]=(0,l.Lk)("h6",{class:"dropdown-header px-0 mb-0"},"Filter Options",-1)),o.hasActiveFilters?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:a[4]||(a[4]=(...e)=>o.clearFilters&&o.clearFilters(...e))}," Clear Filters ")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Gt,[a[59]||(a[59]=(0,l.Lk)("label",{class:"form-label"},"Year Level",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select mb-2","onUpdate:modelValue":a[5]||(a[5]=e=>o.selectedYear=e),onChange:a[6]||(a[6]=(...e)=>o.applyFilters&&o.applyFilters(...e))},a[58]||(a[58]=[(0,l.Fv)('<option value="" data-v-60cc0322>All Years</option><option value="1st" data-v-60cc0322>1st Year</option><option value="2nd" data-v-60cc0322>2nd Year</option><option value="3rd" data-v-60cc0322>3rd Year</option><option value="4th" data-v-60cc0322>4th Year</option>',5)]),544),[[s.u1,o.selectedYear]])]),(0,l.Lk)("div",Zt,[a[61]||(a[61]=(0,l.Lk)("label",{class:"form-label"},"Section",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[7]||(a[7]=e=>o.selectedSection=e),onChange:a[8]||(a[8]=(...e)=>o.applyFilters&&o.applyFilters(...e))},a[60]||(a[60]=[(0,l.Lk)("option",{value:""},"All Sections",-1),(0,l.Lk)("option",{value:"South 1"},"South 1",-1),(0,l.Lk)("option",{value:"South 2"},"South 2",-1),(0,l.Lk)("option",{value:"South 3"},"South 3",-1)]),544),[[s.u1,o.selectedSection]])])])]),(0,l.Lk)("div",es,[(0,l.Lk)("div",as,[a[63]||(a[63]=(0,l.Lk)("span",{class:"input-group-text border-end-0"},[(0,l.Lk)("i",{class:"fas fa-search"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control border-start-0","onUpdate:modelValue":a[9]||(a[9]=e=>o.searchQuery=e),placeholder:"Search students...",onInput:a[10]||(a[10]=(...e)=>o.handleSearch&&o.handleSearch(...e))},null,544),[[s.Jo,o.searchQuery]]),o.searchQuery?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-outline-secondary border-start-0",type:"button",onClick:a[11]||(a[11]=(...e)=>o.clearSearch&&o.clearSearch(...e))},a[62]||(a[62]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))):(0,l.Q3)("",!0)])])])])])]),(0,l.Lk)("div",ts,[(0,l.Lk)("table",ss,[a[66]||(a[66]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Student ID"),(0,l.Lk)("th",null,"Last Name"),(0,l.Lk)("th",null,"First Name"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Year"),(0,l.Lk)("th",null,"Section")])],-1)),(0,l.Lk)("tbody",null,[o.paginatedStudents.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(o.paginatedStudents,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.studentId,onClick:a=>o.viewStudent(e),class:"clickable-row"},[(0,l.Lk)("td",null,(0,y.v_)(e.studentId),1),(0,l.Lk)("td",null,(0,y.v_)(e.lastName),1),(0,l.Lk)("td",null,(0,y.v_)(e.firstName),1),(0,l.Lk)("td",null,(0,y.v_)(e.email),1),(0,l.Lk)("td",null,(0,y.v_)(e.year),1),(0,l.Lk)("td",null,(0,y.v_)(e.section),1)],8,ls)))),128)):((0,l.uX)(),(0,l.CE)("tr",os,[(0,l.Lk)("td",ns,[(0,l.Lk)("div",rs,[a[64]||(a[64]=(0,l.Lk)("i",{class:"fas fa-users text-muted mb-2"},null,-1)),a[65]||(a[65]=(0,l.Lk)("p",{class:"mb-0"},"No students found",-1)),o.hasActiveFilters?((0,l.uX)(),(0,l.CE)("p",cs," Try adjusting your filters ")):(0,l.Q3)("",!0)])])]))])])]),(0,l.Lk)("div",is,[(0,l.Lk)("div",ds," Showing "+(0,y.v_)(o.paginationInfo.start)+" to "+(0,y.v_)(o.paginationInfo.end)+" of "+(0,y.v_)(o.sortedStudents.length)+" entries ",1),(0,l.Lk)("div",us,[(0,l.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:a[12]||(a[12]=(...e)=>o.previousPage&&o.previousPage(...e)),disabled:1===o.currentPage},a[67]||(a[67]=[(0,l.Lk)("i",{class:"fas fa-chevron-left me-1"},null,-1),(0,l.eW)(" Previous ")]),8,vs),(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[13]||(a[13]=(...e)=>o.nextPage&&o.nextPage(...e)),disabled:o.currentPage>=o.totalPages},a[68]||(a[68]=[(0,l.eW)(" Next "),(0,l.Lk)("i",{class:"fas fa-chevron-right ms-1"},null,-1)]),8,ps)])]),o.showAddStudentModal?((0,l.uX)(),(0,l.CE)("div",ms,[(0,l.Lk)("div",{class:"add-student-backdrop",onClick:a[14]||(a[14]=e=>o.showAddStudentModal=!1)}),(0,l.Lk)("div",bs,[(0,l.Lk)("div",fs,[(0,l.Lk)("div",hs,[a[69]||(a[69]=(0,l.Lk)("h5",{class:"modal-title"},"Add Student List",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close btn-close-white",onClick:a[15]||(a[15]=e=>o.showAddStudentModal=!1)})]),(0,l.Lk)("div",gs,[(0,l.Lk)("form",{onSubmit:a[19]||(a[19]=(0,s.D$)(((...e)=>o.handleFileUpload&&o.handleFileUpload(...e)),["prevent"]))},[(0,l.Lk)("div",ks,[a[71]||(a[71]=(0,l.Lk)("label",{class:"form-label"},"Year Level",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[16]||(a[16]=e=>o.uploadYear=e),required:""},[a[70]||(a[70]=(0,l.Lk)("option",{value:""},"Select Year",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,ys)))),128))],512),[[s.u1,o.uploadYear]]),a[72]||(a[72]=(0,l.Lk)("small",{class:"text-muted d-block mt-1"}," Note: Sections will be automatically assigned based on the number of students (50 students per section). ",-1))]),(0,l.Lk)("div",Ls,[a[73]||(a[73]=(0,l.Lk)("label",{class:"form-label"},"CSV File",-1)),(0,l.Lk)("input",{type:"file",class:"form-control",accept:".csv",onChange:a[17]||(a[17]=(...e)=>o.handleFileChange&&o.handleFileChange(...e)),required:""},null,32),a[74]||(a[74]=(0,l.Lk)("small",{class:"text-muted d-block mt-1"},[(0,l.Lk)("strong",null,"Required fields:"),(0,l.eW)(" StudentID, LastName, FirstName, MiddleName, ContactNumber, Email ")],-1)),a[75]||(a[75]=(0,l.Lk)("small",{class:"text-muted d-block mt-1"},[(0,l.Lk)("strong",null,"Important:"),(0,l.eW)(' Make sure the CSV file has an "Email" column with valid email addresses. ')],-1)),a[76]||(a[76]=(0,l.Lk)("small",{class:"text-muted d-block mt-1"}," File must be in CSV format with headers matching the required fields exactly. ",-1))]),(0,l.Lk)("div",Ss,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary me-2",onClick:a[18]||(a[18]=e=>o.showAddStudentModal=!1)}," Cancel "),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:o.isUploading||!o.selectedFile},(0,y.v_)(o.isUploading?"Uploading...":"Upload"),9,ws)])],32)])])])])):(0,l.Q3)("",!0),o.selectedStudent?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"modal-wrapper",onClick:a[22]||(a[22]=(0,s.D$)(((...e)=>o.closeStudentModal&&o.closeStudentModal(...e)),["self"]))},[(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[20]||(a[20]=(...e)=>o.closeStudentModal&&o.closeStudentModal(...e))}),(0,l.Lk)("div",Cs,[(0,l.Lk)("div",As,[(0,l.Lk)("div",Ds,[a[77]||(a[77]=(0,l.Lk)("h5",{class:"modal-title"},[(0,l.Lk)("i",{class:"fas fa-user-graduate me-2"}),(0,l.eW)(" Student Details ")],-1)),(0,l.Lk)("button",{type:"button",class:"btn-close btn-close-white",onClick:a[21]||(a[21]=(...e)=>o.closeStudentModal&&o.closeStudentModal(...e))})]),(0,l.Lk)("div",Es,[(0,l.Lk)("div",js,[(0,l.Lk)("div",Is,[a[84]||(a[84]=(0,l.Lk)("h6",{class:"info-title"},"Student Information",-1)),(0,l.Lk)("div",Ys,[(0,l.Lk)("p",null,[a[78]||(a[78]=(0,l.Lk)("strong",null,"Name:",-1)),(0,l.eW)(" "+(0,y.v_)(o.selectedStudent.firstName)+" "+(0,y.v_)(o.selectedStudent.lastName),1)]),(0,l.Lk)("p",null,[a[79]||(a[79]=(0,l.Lk)("strong",null,"ID:",-1)),(0,l.eW)(" "+(0,y.v_)(o.selectedStudent.studentId),1)]),(0,l.Lk)("p",null,[a[80]||(a[80]=(0,l.Lk)("strong",null,"Year Level:",-1)),(0,l.eW)(" "+(0,y.v_)(o.selectedStudent.year),1)]),(0,l.Lk)("p",null,[a[81]||(a[81]=(0,l.Lk)("strong",null,"Academic Year:",-1)),(0,l.eW)(" "+(0,y.v_)(o.getAcademicYearRange(o.selectedStudent.year)),1)]),(0,l.Lk)("p",null,[a[82]||(a[82]=(0,l.Lk)("strong",null,"Section:",-1)),(0,l.eW)(" "+(0,y.v_)(o.selectedStudent.section),1)]),(0,l.Lk)("p",null,[a[83]||(a[83]=(0,l.Lk)("strong",null,"Email:",-1)),(0,l.eW)(" "+(0,y.v_)(o.selectedStudent.email),1)])])]),(0,l.Lk)("div",Fs,[(0,l.Lk)("div",xs,[a[85]||(a[85]=(0,l.Lk)("h6",null,"Performance Trends",-1)),(0,l.Lk)("canvas",Ts,null,512)]),(0,l.Lk)("div",Ns,[a[87]||(a[87]=(0,l.Lk)("h6",null,"Attendance History",-1)),(0,l.Lk)("div",Ps,[(0,l.Lk)("table",Rs,[a[86]||(a[86]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Date"),(0,l.Lk)("th",null,"Subject"),(0,l.Lk)("th",null,"Status")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.selectedStudent.attendanceHistory,(a=>((0,l.uX)(),(0,l.CE)("tr",{key:a.date},[(0,l.Lk)("td",null,(0,y.v_)(e.formatDate(a.date)),1),(0,l.Lk)("td",null,(0,y.v_)(a.subject),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,y.C4)(["badge","present"===a.status?"bg-success":"bg-danger"])},(0,y.v_)("present"===a.status?"Present":"Absent"),3)])])))),128))])])])])])])])])])])):(0,l.Q3)("",!0),o.isEditing?((0,l.uX)(),(0,l.CE)("div",Ms,[(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[23]||(a[23]=(...e)=>o.cancelEditing&&o.cancelEditing(...e))}),(0,l.Lk)("div",_s,[(0,l.Lk)("div",$s,[(0,l.Lk)("div",Ks,[a[88]||(a[88]=(0,l.Lk)("h5",{class:"modal-title"},"Edit Student",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[24]||(a[24]=(...e)=>o.cancelEditing&&o.cancelEditing(...e))})]),(0,l.Lk)("div",zs,[(0,l.Lk)("form",{onSubmit:a[32]||(a[32]=(0,s.D$)(((...e)=>o.saveStudentChanges&&o.saveStudentChanges(...e)),["prevent"]))},[(0,l.Lk)("div",Ws,[a[89]||(a[89]=(0,l.Lk)("label",{class:"form-label"},"Student ID",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[25]||(a[25]=e=>o.editingStudent.studentId=e)},null,512),[[s.Jo,o.editingStudent.studentId]])]),(0,l.Lk)("div",Xs,[a[90]||(a[90]=(0,l.Lk)("label",{class:"form-label"},"First Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[26]||(a[26]=e=>o.editingStudent.firstName=e)},null,512),[[s.Jo,o.editingStudent.firstName]])]),(0,l.Lk)("div",Bs,[a[91]||(a[91]=(0,l.Lk)("label",{class:"form-label"},"Last Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[27]||(a[27]=e=>o.editingStudent.lastName=e)},null,512),[[s.Jo,o.editingStudent.lastName]])]),(0,l.Lk)("div",Us,[a[92]||(a[92]=(0,l.Lk)("label",{class:"form-label"},"Email",-1)),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":a[28]||(a[28]=e=>o.editingStudent.email=e)},null,512),[[s.Jo,o.editingStudent.email]])]),(0,l.Lk)("div",Hs,[a[93]||(a[93]=(0,l.Lk)("label",{class:"form-label"},"Year",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[29]||(a[29]=e=>o.editingStudent.year=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{value:e},(0,y.v_)(e),9,Os)))),256))],512),[[s.u1,o.editingStudent.year]])]),(0,l.Lk)("div",Qs,[a[94]||(a[94]=(0,l.Lk)("label",{class:"form-label"},"Section",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[30]||(a[30]=e=>o.editingStudent.section=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableSections,(e=>((0,l.uX)(),(0,l.CE)("option",{value:e},(0,y.v_)(e),9,Vs)))),256))],512),[[s.u1,o.editingStudent.section]])]),(0,l.Lk)("div",qs,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[31]||(a[31]=(...e)=>o.cancelEditing&&o.cancelEditing(...e))}," Cancel "),a[95]||(a[95]=(0,l.Lk)("button",{type:"submit",class:"btn btn-primary"}," Save Changes ",-1))])],32)])])])])):(0,l.Q3)("",!0),o.showDeleteModal?((0,l.uX)(),(0,l.CE)("div",Js,[(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[33]||(a[33]=e=>o.showDeleteModal=!1)}),(0,l.Lk)("div",Gs,[(0,l.Lk)("div",Zs,[(0,l.Lk)("div",el,[a[96]||(a[96]=(0,l.Lk)("h5",{class:"modal-title"},"Confirm Delete",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[34]||(a[34]=e=>o.showDeleteModal=!1)})]),(0,l.Lk)("div",al,[a[97]||(a[97]=(0,l.Lk)("p",null,"Are you sure you want to delete this student?",-1)),(0,l.Lk)("p",tl,[(0,l.Lk)("strong",null,(0,y.v_)(o.studentToDelete?.firstName)+" "+(0,y.v_)(o.studentToDelete?.lastName),1)]),a[98]||(a[98]=(0,l.Lk)("p",{class:"text-muted small"},"This action cannot be undone.",-1))]),(0,l.Lk)("div",sl,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[35]||(a[35]=e=>o.showDeleteModal=!1)}," Cancel "),(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:a[36]||(a[36]=e=>o.deleteStudent(o.studentToDelete))}," Delete ")])])])])):(0,l.Q3)("",!0),o.showAddSingleStudentModal?((0,l.uX)(),(0,l.CE)("div",ll,[(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[37]||(a[37]=e=>o.showAddSingleStudentModal=!1)}),(0,l.Lk)("div",ol,[(0,l.Lk)("div",nl,[(0,l.Lk)("div",rl,[a[99]||(a[99]=(0,l.Lk)("h5",{class:"modal-title"},[(0,l.Lk)("i",{class:"fas fa-user-plus me-2"}),(0,l.eW)(" Add Single Student ")],-1)),(0,l.Lk)("button",{type:"button",class:"btn-close btn-close-white",onClick:a[38]||(a[38]=e=>o.showAddSingleStudentModal=!1)})]),(0,l.Lk)("div",cl,[(0,l.Lk)("form",{onSubmit:a[48]||(a[48]=(0,s.D$)(((...e)=>o.handleAddSingleStudent&&o.handleAddSingleStudent(...e)),["prevent"]))},[(0,l.Lk)("div",il,[a[100]||(a[100]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Student ID "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[39]||(a[39]=e=>o.newStudent.studentId=e),required:""},null,512),[[s.Jo,o.newStudent.studentId]])]),(0,l.Lk)("div",dl,[a[101]||(a[101]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("First Name "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[40]||(a[40]=e=>o.newStudent.firstName=e),required:""},null,512),[[s.Jo,o.newStudent.firstName]])]),(0,l.Lk)("div",ul,[a[102]||(a[102]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Middle Name "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[41]||(a[41]=e=>o.newStudent.middleName=e),required:""},null,512),[[s.Jo,o.newStudent.middleName]])]),(0,l.Lk)("div",vl,[a[103]||(a[103]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Last Name "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[42]||(a[42]=e=>o.newStudent.lastName=e),required:""},null,512),[[s.Jo,o.newStudent.lastName]])]),(0,l.Lk)("div",pl,[a[104]||(a[104]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Email "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":a[43]||(a[43]=e=>o.newStudent.email=e),required:""},null,512),[[s.Jo,o.newStudent.email]])]),(0,l.Lk)("div",ml,[a[105]||(a[105]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Contact Number "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[44]||(a[44]=e=>o.newStudent.contactNumber=e),required:""},null,512),[[s.Jo,o.newStudent.contactNumber]])]),(0,l.Lk)("div",bl,[a[107]||(a[107]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Year "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[45]||(a[45]=e=>o.newStudent.year=e),required:""},[a[106]||(a[106]=(0,l.Lk)("option",{value:""},"Select Year",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,fl)))),128))],512),[[s.u1,o.newStudent.year]])]),(0,l.Lk)("div",hl,[a[109]||(a[109]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("Section "),(0,l.Lk)("span",{class:"text-danger"},"*")],-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[46]||(a[46]=e=>o.newStudent.section=e),required:""},[a[108]||(a[108]=(0,l.Lk)("option",{value:""},"Select Section",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableSections,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,gl)))),128))],512),[[s.u1,o.newStudent.section]])]),(0,l.Lk)("div",kl,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[47]||(a[47]=e=>o.showAddSingleStudentModal=!1)}," Cancel "),(0,l.Lk)("button",{type:"submit",class:"btn btn-success",disabled:o.isAddingStudent},(0,y.v_)(o.isAddingStudent?"Adding...":"Add Student"),9,yl)])],32)])])])])):(0,l.Q3)("",!0)])}t(2489);var Sl=t(8077);const wl=p.A.create({baseURL:"http://localhost:8081/api",headers:{"Content-Type":"application/json"}});var Cl={name:"StudentManagement",setup(){const e=(0,v.Pj)(),a=(0,W.KR)([]),t=(0,W.KR)(""),s=(0,W.KR)(null),o=(0,W.KR)(null),n=(0,W.KR)(""),r=(0,W.KR)("asc"),c=(0,W.KR)(!1),i=(0,W.KR)(null),d=(0,W.KR)(!1),u=(0,W.KR)(null),p=(0,W.KR)(!1),m=(0,W.KR)(""),b=(0,W.KR)(""),f=(0,W.KR)(null),h=(0,W.KR)(""),g=(0,W.KR)(!1),k=((0,W.KR)(null),(0,W.KR)(null),(0,W.KR)(""),(0,W.KR)(""),(0,W.KR)(!1),(0,W.KR)(!1),(0,W.KR)(!1)),y=(0,W.KR)(!1),L=["1st","2nd","3rd","4th"],S=["South 1","South 2","South 3"],w=(0,W.KR)({studentId:"",firstName:"",middleName:"",lastName:"",email:"",contactNumber:"",year:"",section:""}),C=(0,W.KR)(!1),A=(0,W.KR)(1),D=25,E=(0,l.EW)((()=>Math.ceil(B.value.length/D))),j=(0,l.EW)((()=>{const e=(A.value-1)*D,a=e+D;return B.value.slice(e,a)})),I=(0,l.EW)((()=>{const e=(A.value-1)*D+1,a=Math.min(e+D-1,B.value.length);return{start:e,end:a}})),Y=()=>{A.value<E.value&&A.value++},F=()=>{A.value>1&&A.value--};(0,l.wB)([t,m,b],(()=>{A.value=1})),(0,l.sV)((async()=>{e.getters.isLoggedIn&&await te(),(0,l.dY)((()=>{const e=document.querySelectorAll('[data-bs-toggle="dropdown"]'),a=[];e.forEach((e=>{e&&a.push(new Sl.ms(e))})),(0,l.hi)((()=>{a.forEach((e=>{e&&"function"===typeof e.dispose&&e.dispose()}))}))}))})),(0,l.wB)((()=>e.state.auth.token),(e=>{e&&te()}));const x=e=>{const a=e.target.files[0];if(a&&"text/csv"!==a.type)return alert("Please select a CSV file"),e.target.value="",void(f.value=null);f.value=a,console.log("File selected:",a?.name)},T=async()=>{if(!f.value||!h.value)return void alert("Please select both a year and a CSV file");g.value=!0;const t=new FormData;t.append("file",f.value),t.append("year",h.value);try{console.log("Starting upload...",{year:h.value,fileName:f.value.name});const s=e.state.auth.token;if(!s)throw new Error("No authentication token found");console.log("Form data contents:",{file:f.value,year:h.value});const l=await wl.post("/students/upload",t,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});if(console.log("Upload successful:",l.data),l.data.errors&&l.data.errors.length>0){const e=l.data.errors.join("\n");alert(`Upload completed with some errors:\n${e}`)}else{const e=l.data.sectionCounts;alert(`File uploaded successfully!\n\nStudent distribution:\nSouth 1: ${e["South 1"]} students\nSouth 2: ${e["South 2"]} students\nSouth 3: ${e["South 3"]} students`)}f.value=null,h.value="",await te(),console.log("Students after upload:",a.value),a.value.length>0&&(console.log("First student after upload:",a.value[0]),console.log("Email field exists after upload:","email"in a.value[0]),console.log("Email value after upload:",a.value[0].email)),k.value=!1}catch(s){console.error("Upload failed:",s),alert("Error uploading file: "+(s.response?.data?.message||s.message))}finally{g.value=!1}},N=(0,l.EW)((()=>a.value.filter((e=>{const a=t.value.toLowerCase(),s=e.studentId.toLowerCase().includes(a)||e.firstName.toLowerCase().includes(a)||e.lastName.toLowerCase().includes(a),l=!m.value||e.year===m.value,o=!b.value||e.section===b.value;return s&&l&&o})))),P=()=>{if(o.value){const e=oa.Ay.getChart(o.value);e&&e.destroy()}s.value=null},R=e=>{i.value=e,c.value=!0},M=async t=>{try{const l=e.state.auth.token;await wl.delete("/students/"+t._id,{headers:{Authorization:`Bearer ${l}`}}),a.value=a.value.filter((e=>e._id!==t._id)),s.value=null,c.value=!1,i.value=null,alert("Student deleted successfully")}catch(l){console.error("Failed to delete student:",l),alert("Failed to delete student. Please try again.")}},_=e=>{u.value={...e},d.value=!0},$=()=>{u.value=null,d.value=!1},K=async()=>{try{const t=e.state.auth.token,l=await wl.put("/students/"+u.value._id,{studentId:u.value.studentId,firstName:u.value.firstName,lastName:u.value.lastName,email:u.value.email,year:u.value.year,section:u.value.section},{headers:{Authorization:`Bearer ${t}`}});if(!l.data)throw new Error("Failed to update student information");{const e=a.value.findIndex((e=>e._id===u.value._id));-1!==e&&(a.value[e]={...u.value}),s.value=null,u.value=null,d.value=!1,alert("Student information updated successfully")}}catch(t){console.error("Failed to update student:",t),alert("Failed to update student information. Please try again.")}},z=e=>{n.value===e?r.value="asc"===r.value?"desc":"asc":(n.value=e,r.value="asc")},X=e=>n.value!==e?"fas fa-sort":"asc"===r.value?"fas fa-sort-up":"fas fa-sort-down",B=(0,l.EW)((()=>{let e=N.value;return n.value&&(e=[...e].sort(((e,a)=>{let t=e[n.value],s=a[n.value];return"string"===typeof t&&(t=t.toLowerCase()),"string"===typeof s&&(s=s.toLowerCase()),t<s?"asc"===r.value?-1:1:t>s?"asc"===r.value?1:-1:0}))),e})),U=()=>{p.value=!p.value,p.value||(t.value="")},H=()=>{console.log("Searching for:",t.value)},O=()=>{t.value="",H()},Q=e=>{const a=(new Date).getFullYear();let t=0;switch(e){case"1st":t=1;break;case"2nd":t=2;break;case"3rd":t=3;break;case"4th":t=4;break;default:return"N/A"}const s=a-t+1;return`${s} - ${s+1}`},V=(0,l.EW)((()=>m.value||b.value)),q=e=>{if(s.value=e,o.value){o.value.getContext("2d")}},J=()=>{m.value="",b.value="",t.value=""},G=()=>{te()},Z=async()=>{try{C.value=!0;const a=["studentId","firstName","middleName","lastName","email","contactNumber","year","section"];for(const e of a)if(!w.value[e])throw new Error(`${e.charAt(0).toUpperCase()+e.slice(1)} is required`);const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!t.test(w.value.email))throw new Error("Please enter a valid email address");const s=e.state.auth.token;if(!s)throw new Error("No authentication token found");const l=await wl.post("/students",{...w.value,academicYears:ae(w.value.year)},{headers:{Authorization:`Bearer ${s}`}});console.log("Student added successfully:",l.data),ee(),y.value=!1,await te(),alert("Student added successfully")}catch(a){console.error("Failed to add student:",a),alert("Error adding student: "+(a.response?.data?.message||a.message))}finally{C.value=!1}},ee=()=>{w.value={studentId:"",firstName:"",middleName:"",lastName:"",email:"",contactNumber:"",year:"",section:""}},ae=e=>{const a=(new Date).getFullYear();let t,s;switch(e){case"1st":t=a,s=a+4;break;case"2nd":t=a-1,s=a+3;break;case"3rd":t=a-2,s=a+2;break;case"4th":t=a-3,s=a+1;break;default:t=a,s=a+4}return{startYear:t,endYear:s}},te=async()=>{try{const t=e.state.auth.token,s=await wl.get("/students",{headers:{Authorization:`Bearer ${t}`}});a.value=s.data}catch(t){console.error("Failed to fetch students:",t),alert("Failed to fetch students. Please try again.")}};return{students:a,searchQuery:t,selectedStudent:s,performanceChart:o,sortField:n,sortOrder:r,showDeleteModal:c,studentToDelete:i,isEditing:d,editingStudent:u,showSearch:p,showAddStudentModal:k,showAddSingleStudentModal:y,selectedFile:f,uploadYear:h,isUploading:g,availableYears:L,availableSections:S,newStudent:w,isAddingStudent:C,handleFileChange:x,handleFileUpload:T,handleAddSingleStudent:Z,resetNewStudentForm:ee,filteredStudents:N,closeStudentModal:P,confirmDelete:R,deleteStudent:M,startEditing:_,cancelEditing:$,saveStudentChanges:K,sortBy:z,getSortIcon:X,sortedStudents:B,toggleSearch:U,handleSearch:H,clearSearch:O,fetchStudents:te,hasActiveFilters:V,selectedYear:m,selectedSection:b,viewStudent:q,getAcademicYearRange:Q,clearFilters:J,applyFilters:G,currentPage:A,totalPages:E,paginatedStudents:j,paginationInfo:I,nextPage:Y,previousPage:F}}};const Al=(0,i.A)(Cl,[["render",Ll],["__scopeId","data-v-60cc0322"]]);var Dl=Al;const El={class:"class-records"},jl={class:"d-flex justify-content-between align-items-center mb-4"},Il={class:"d-flex gap-2"},Yl={class:"d-flex align-items-center gap-3"},Fl={class:"date-display"},xl=["disabled"],Tl={class:"card"},Nl={class:"card-body"},Pl={class:"table-controls mb-4"},Rl={class:"d-flex gap-3 align-items-center"},Ml={class:"d-flex gap-3"},_l={class:"dropdown"},$l={class:"dropdown-menu control-menu"},Kl={class:"dropdown"},zl={class:"btn btn-control",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Wl={key:0,class:"filter-badge"},Xl={class:"dropdown-menu control-menu p-3",style:{width:"280px"}},Bl={class:"mb-3"},Ul=["value"],Hl={class:"mb-3"},Ol=["disabled"],Ql=["value"],Vl={class:"mb-3"},ql=["disabled"],Jl=["value"],Gl={class:"d-flex justify-content-end gap-2 mt-3"},Zl={class:"search-control"},eo={class:"input-group"},ao={class:"table-responsive"},to={class:"table table-hover"},so=["onClick"],lo=["onClick"],oo=["value","max","onInput"],no={key:1},ro={colspan:"5",class:"text-center py-4"},co={class:"empty-state-message"},io={key:0,class:"text-muted small"},uo={class:"pagination-controls mt-3 d-flex justify-content-between align-items-center"},vo={class:"pagination-info"},po={class:"pagination-buttons"},mo=["disabled"],bo=["disabled"],fo={key:0,class:"modal-overlay"},ho={class:"modal-dialog"},go={class:"modal-content"},ko={class:"modal-header"},yo={class:"modal-body"},Lo={class:"mb-3"},So=["value"],wo={key:1,disabled:""},Co={class:"mb-3"},Ao=["disabled"],Do=["value"],Eo={key:1,disabled:""},jo={class:"mb-3"},Io=["disabled"],Yo=["value"],Fo={key:1,disabled:""},xo={class:"d-flex justify-content-end gap-2"},To=["disabled"],No={key:1,class:"modal-overlay"},Po={class:"modal-wrapper"},Ro={class:"modal-dialog"},Mo={class:"modal-content"},_o={class:"modal-header"},$o={class:"modal-body"},Ko={class:"mb-3"},zo={class:"mb-3"},Wo={class:"mb-3"},Xo={class:"text-end"},Bo={class:"table"},Uo={key:0},Ho={class:"modal-overlay"},Oo={class:"modal-wrapper"},Qo={class:"modal-dialog modal-sm"},Vo={class:"modal-content"},qo={class:"modal-header"},Jo={class:"modal-body"},Go={class:"mb-3"},Zo={class:"mb-3"},en={class:"modal-footer"},an={class:"modal-overlay"},tn={class:"modal-wrapper"},sn={class:"modal-dialog modal-sm"},ln={class:"modal-content"},on={class:"modal-header"},nn={class:"modal-body"},rn={class:"mb-3"},cn={class:"mb-3"},dn={class:"modal-footer"};function un(e,a,t,o,n,r){const c=(0,l.g2)("StudentDetailsModal");return(0,l.uX)(),(0,l.CE)("div",El,[(0,l.Lk)("div",jl,[(0,l.Lk)("div",Il,[(0,l.Lk)("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=(...e)=>o.openAddStudentRecordModal&&o.openAddStudentRecordModal(...e))},a[49]||(a[49]=[(0,l.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,l.eW)(" Add Student Record ")])),(0,l.Lk)("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=e=>o.showAddAssessmentModal=!0)},a[50]||(a[50]=[(0,l.Lk)("i",{class:"fas fa-plus"},null,-1),(0,l.eW)(" Add Assessment ")]))]),(0,l.Lk)("div",Yl,[(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[2]||(a[2]=e=>o.navigateDate(-1))},a[51]||(a[51]=[(0,l.Lk)("i",{class:"fas fa-chevron-left"},null,-1)])),(0,l.Lk)("div",Fl,(0,y.v_)(o.formatDateForDisplay(o.currentDate)),1),(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[3]||(a[3]=e=>o.navigateDate(1)),disabled:o.isNextDayDisabled},a[52]||(a[52]=[(0,l.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,xl)])]),(0,l.Lk)("div",Tl,[(0,l.Lk)("div",Nl,[(0,l.Lk)("div",Pl,[(0,l.Lk)("div",Rl,[(0,l.Lk)("div",Ml,[(0,l.Lk)("div",_l,[a[57]||(a[57]=(0,l.Lk)("button",{class:"btn btn-control",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,l.Lk)("i",{class:"fas fa-sort me-2"}),(0,l.eW)(" Sort by ")],-1)),(0,l.Lk)("ul",$l,[(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center",href:"#",onClick:a[4]||(a[4]=e=>o.sortBy("studentNumber"))},[a[53]||(a[53]=(0,l.Lk)("i",{class:"fas fa-sort me-2"},null,-1)),a[54]||(a[54]=(0,l.eW)(" Student Number ")),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("studentNumber"),"ms-auto"])},null,2)])]),(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center",href:"#",onClick:a[5]||(a[5]=e=>o.sortBy("lastName"))},[a[55]||(a[55]=(0,l.Lk)("i",{class:"fas fa-sort-alpha-down me-2"},null,-1)),a[56]||(a[56]=(0,l.eW)(" Name ")),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("lastName"),"ms-auto"])},null,2)])])])]),(0,l.Lk)("div",Kl,[(0,l.Lk)("button",zl,[a[58]||(a[58]=(0,l.Lk)("i",{class:"fas fa-filter me-2"},null,-1)),a[59]||(a[59]=(0,l.eW)(" Filter ")),e.hasActiveFilters?((0,l.uX)(),(0,l.CE)("span",Wl,"!")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Xl,[a[66]||(a[66]=(0,l.Lk)("h6",{class:"dropdown-header mb-2"},"Filter Options",-1)),(0,l.Lk)("div",Bl,[a[61]||(a[61]=(0,l.Lk)("label",{class:"form-label"},"Year Level",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[6]||(a[6]=e=>o.selectedYear=e),onChange:a[7]||(a[7]=(...e)=>o.applyFilters&&o.applyFilters(...e))},[a[60]||(a[60]=(0,l.Lk)("option",{value:""},"All Years",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Ul)))),128))],544),[[s.u1,o.selectedYear]])]),(0,l.Lk)("div",Hl,[a[63]||(a[63]=(0,l.Lk)("label",{class:"form-label"},"Section",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[8]||(a[8]=e=>o.selectedSection=e),onChange:a[9]||(a[9]=(...e)=>o.applyFilters&&o.applyFilters(...e)),disabled:!o.selectedYear},[a[62]||(a[62]=(0,l.Lk)("option",{value:""},"All Sections",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableSections,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Ql)))),128))],40,Ol),[[s.u1,o.selectedSection]])]),(0,l.Lk)("div",Vl,[a[65]||(a[65]=(0,l.Lk)("label",{class:"form-label"},"Subject",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[10]||(a[10]=e=>o.selectedSubject=e),onChange:a[11]||(a[11]=(...e)=>o.applyFilters&&o.applyFilters(...e)),disabled:!o.selectedSection},[a[64]||(a[64]=(0,l.Lk)("option",{value:""},"All Subjects",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.teacherSubjects,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Jl)))),128))],40,ql),[[s.u1,o.selectedSubject]])]),(0,l.Lk)("div",Gl,[(0,l.Lk)("button",{class:"btn btn-sm btn-light",onClick:a[12]||(a[12]=(...e)=>o.clearFilters&&o.clearFilters(...e))}," Clear All "),(0,l.Lk)("button",{class:"btn btn-sm btn-primary",onClick:a[13]||(a[13]=(...e)=>o.applyFilters&&o.applyFilters(...e))}," Apply Filters ")])])])]),(0,l.Lk)("div",Zl,[(0,l.Lk)("div",eo,[a[68]||(a[68]=(0,l.Lk)("span",{class:"input-group-text"},[(0,l.Lk)("i",{class:"fas fa-search"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[14]||(a[14]=e=>o.searchQuery=e),placeholder:"Search students...",onInput:a[15]||(a[15]=(...e)=>o.handleSearch&&o.handleSearch(...e))},null,544),[[s.Jo,o.searchQuery]]),o.searchQuery?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:a[16]||(a[16]=(...a)=>e.clearSearch&&e.clearSearch(...a))},a[67]||(a[67]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))):(0,l.Q3)("",!0)])])])]),(0,l.Lk)("div",ao,[(0,l.Lk)("table",to,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[a[70]||(a[70]=(0,l.Lk)("th",null,"Student Number",-1)),a[71]||(a[71]=(0,l.Lk)("th",null,"Last Name",-1)),a[72]||(a[72]=(0,l.Lk)("th",null,"First Name",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.filteredAssessmentsByDate,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e.id},[(0,l.Lk)("div",{class:"assessment-header",onClick:a=>o.editAssessment(e)},[(0,l.eW)((0,y.v_)(e.type)+" "+(0,y.v_)(e.number)+" ",1),a[69]||(a[69]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("small",null,"("+(0,y.v_)(e.maxScore)+" pts)",1)],8,so)])))),128))])]),(0,l.Lk)("tbody",null,[o.paginatedStudents.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(o.paginatedStudents,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.studentNumber,onClick:a=>o.viewStudentDetails(e),class:"clickable-row"},[(0,l.Lk)("td",null,(0,y.v_)(e.studentNumber),1),(0,l.Lk)("td",null,(0,y.v_)(e.lastName),1),(0,l.Lk)("td",null,(0,y.v_)(e.firstName),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.filteredAssessmentsByDate,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t.id},[(0,l.Lk)("input",{type:"number",class:"form-control form-control-sm score-input",value:o.getStudentScore(e,t),max:t.maxScore,min:"0",onInput:a=>o.updateScore(e,t,a.target.value),onClick:a[17]||(a[17]=(0,s.D$)((()=>{}),["stop"]))},null,40,oo)])))),128))],8,lo)))),128)):((0,l.uX)(),(0,l.CE)("tr",no,[(0,l.Lk)("td",ro,[(0,l.Lk)("div",co,[a[73]||(a[73]=(0,l.Lk)("i",{class:"fas fa-users text-muted mb-2"},null,-1)),a[74]||(a[74]=(0,l.Lk)("p",{class:"mb-0"},"No students found",-1)),e.hasActiveFilters?((0,l.uX)(),(0,l.CE)("p",io," Try adjusting your filters ")):(0,l.Q3)("",!0)])])]))])])]),(0,l.Lk)("div",uo,[(0,l.Lk)("div",vo," Showing "+(0,y.v_)(o.paginationInfo.start)+" to "+(0,y.v_)(o.paginationInfo.end)+" of "+(0,y.v_)(o.sortedStudents.length)+" entries ",1),(0,l.Lk)("div",po,[(0,l.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:a[18]||(a[18]=(...e)=>o.previousPage&&o.previousPage(...e)),disabled:1===o.currentPage},a[75]||(a[75]=[(0,l.Lk)("i",{class:"fas fa-chevron-left me-1"},null,-1),(0,l.eW)(" Previous ")]),8,mo),(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[19]||(a[19]=(...e)=>o.nextPage&&o.nextPage(...e)),disabled:o.currentPage>=o.totalPages},a[76]||(a[76]=[(0,l.eW)(" Next "),(0,l.Lk)("i",{class:"fas fa-chevron-right ms-1"},null,-1)]),8,bo)])])])]),o.showAddStudentRecordModal?((0,l.uX)(),(0,l.CE)("div",fo,[(0,l.Lk)("div",{class:"modal-wrapper",onClick:a[26]||(a[26]=(0,s.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",ho,[(0,l.Lk)("div",go,[(0,l.Lk)("div",ko,[a[77]||(a[77]=(0,l.Lk)("h5",{class:"modal-title"},"Add Student Record",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[20]||(a[20]=e=>o.showAddStudentRecordModal=!1)})]),(0,l.Lk)("div",yo,[(0,l.Lk)("form",{onSubmit:a[25]||(a[25]=(0,s.D$)(((...e)=>o.handleAddStudentRecord&&o.handleAddStudentRecord(...e)),["prevent"]))},[(0,l.Lk)("div",Lo,[a[79]||(a[79]=(0,l.Lk)("label",{class:"form-label"},"Year",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[21]||(a[21]=e=>o.newStudentRecord.year=e),required:""},[a[78]||(a[78]=(0,l.Lk)("option",{value:""},"Select Year",-1)),o.availableYears.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(o.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,So)))),128)):((0,l.uX)(),(0,l.CE)("option",wo,"No available years"))],512),[[s.u1,o.newStudentRecord.year]])]),(0,l.Lk)("div",Co,[a[81]||(a[81]=(0,l.Lk)("label",{class:"form-label"},"Section",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[22]||(a[22]=e=>o.newStudentRecord.section=e),disabled:!o.newStudentRecord.year,required:""},[a[80]||(a[80]=(0,l.Lk)("option",{value:""},"Select Section",-1)),o.filteredSections.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(o.filteredSections,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Do)))),128)):((0,l.uX)(),(0,l.CE)("option",Eo,"No available sections"))],8,Ao),[[s.u1,o.newStudentRecord.section]])]),(0,l.Lk)("div",jo,[a[83]||(a[83]=(0,l.Lk)("label",{class:"form-label"},"Subject",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[23]||(a[23]=e=>o.newStudentRecord.subject=e),disabled:!o.newStudentRecord.section,required:""},[a[82]||(a[82]=(0,l.Lk)("option",{value:""},"Select Subject",-1)),o.teacherSubjects.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(o.teacherSubjects,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Yo)))),128)):((0,l.uX)(),(0,l.CE)("option",Fo,"No available subjects"))],8,Io),[[s.u1,o.newStudentRecord.subject]])]),(0,l.Lk)("div",xo,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[24]||(a[24]=e=>o.showAddStudentRecordModal=!1)}," Cancel "),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:!o.canAddStudentRecord}," Add Record ",8,To)])],32)])])])]),(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[27]||(a[27]=e=>o.showAddStudentRecordModal=!1)})])):(0,l.Q3)("",!0),o.showAddAssessmentModal?((0,l.uX)(),(0,l.CE)("div",No,[(0,l.Lk)("div",Po,[(0,l.Lk)("div",Ro,[(0,l.Lk)("div",Mo,[(0,l.Lk)("div",_o,[a[84]||(a[84]=(0,l.Lk)("h5",{class:"modal-title"},"Add Assessment",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[28]||(a[28]=e=>o.showAddAssessmentModal=!1)})]),(0,l.Lk)("div",$o,[(0,l.Lk)("form",{onSubmit:a[33]||(a[33]=(0,s.D$)(((...e)=>o.handleAddAssessment&&o.handleAddAssessment(...e)),["prevent"]))},[(0,l.Lk)("div",Ko,[a[86]||(a[86]=(0,l.Lk)("label",{class:"form-label"},"Type",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[29]||(a[29]=e=>o.newAssessment.type=e),required:""},a[85]||(a[85]=[(0,l.Lk)("option",{value:""},"Select Type",-1),(0,l.Lk)("option",{value:"Quiz"},"Quiz",-1),(0,l.Lk)("option",{value:"Activity"},"Activity",-1),(0,l.Lk)("option",{value:"Performance Task"},"Performance Task",-1)]),512),[[s.u1,o.newAssessment.type]])]),(0,l.Lk)("div",zo,[a[87]||(a[87]=(0,l.Lk)("label",{class:"form-label"},"Number",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",class:"form-control","onUpdate:modelValue":a[30]||(a[30]=e=>o.newAssessment.number=e),min:"1",required:""},null,512),[[s.Jo,o.newAssessment.number]])]),(0,l.Lk)("div",Wo,[a[88]||(a[88]=(0,l.Lk)("label",{class:"form-label"},"Maximum Score",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",class:"form-control","onUpdate:modelValue":a[31]||(a[31]=e=>o.newAssessment.maxScore=e),min:"1",required:""},null,512),[[s.Jo,o.newAssessment.maxScore]])]),(0,l.Lk)("div",Xo,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary me-2",onClick:a[32]||(a[32]=e=>o.showAddAssessmentModal=!1)}," Cancel "),a[89]||(a[89]=(0,l.Lk)("button",{type:"submit",class:"btn btn-primary"}," Add Assessment ",-1))])],32)])])])]),(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[34]||(a[34]=e=>o.showAddAssessmentModal=!1)})])):(0,l.Q3)("",!0),(0,l.bF)(c,{show:!!o.selectedStudent,student:o.selectedStudent||{},"year-level":o.selectedYear,section:o.selectedSection,subject:o.selectedSubject,title:"Student Performance Details","chart-title":"Assessment Performance","history-title":"Assessment History","table-headers":["Date","Assessment","Score","Percentage"],"chart-id":`performanceChart-${o.selectedStudent?.studentNumber}`,"is-class-record":!0,"onUpdate:show":a[35]||(a[35]=e=>!e&&(o.selectedStudent=null)),onClose:a[36]||(a[36]=e=>o.selectedStudent=null),onDateFilterChange:e.handleDateFilterChange,onAssessmentTypeChange:e.handleAssessmentTypeChange},{"history-table":(0,l.k6)((()=>[(0,l.Lk)("table",Bo,[a[91]||(a[91]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Date"),(0,l.Lk)("th",null,"Assessment"),(0,l.Lk)("th",null,"Score"),(0,l.Lk)("th",null,"Percentage")])],-1)),(0,l.Lk)("tbody",null,[o.selectedStudent?.assessmentHistory&&0!==o.selectedStudent.assessmentHistory.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",Uo,a[90]||(a[90]=[(0,l.Lk)("td",{colspan:"4",class:"text-center py-3 text-muted"},[(0,l.Lk)("i",{class:"fas fa-info-circle me-2"}),(0,l.eW)("No assessment records found. ")],-1)]))),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.selectedStudent?.assessmentHistory,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.date+e.type},[(0,l.Lk)("td",null,(0,y.v_)(o.formatDate(e.date)),1),(0,l.Lk)("td",null,(0,y.v_)(e.type),1),(0,l.Lk)("td",null,(0,y.v_)(e.score)+"/"+(0,y.v_)(e.maxScore),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,y.C4)(["badge",{"bg-success":e.percentage>=90,"bg-primary":e.percentage>=80&&e.percentage<90,"bg-warning":e.percentage>=75&&e.percentage<80,"bg-danger":e.percentage<75}])},(0,y.v_)(e.percentage.toFixed(1))+"% ",3)])])))),128))])])])),_:1},8,["show","student","year-level","section","subject","chart-id","onDateFilterChange","onAssessmentTypeChange"]),o.showChartDateFilter?((0,l.uX)(),(0,l.Wv)(l.Im,{key:2,to:"body"},[(0,l.Lk)("div",Ho,[(0,l.Lk)("div",Oo,[(0,l.Lk)("div",Qo,[(0,l.Lk)("div",Vo,[(0,l.Lk)("div",qo,[a[92]||(a[92]=(0,l.Lk)("h5",{class:"modal-title"},"Filter Chart Date Range",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[37]||(a[37]=e=>o.showChartDateFilter=!1)})]),(0,l.Lk)("div",Jo,[(0,l.Lk)("div",Go,[a[93]||(a[93]=(0,l.Lk)("label",{class:"form-label"},"Start Date",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[38]||(a[38]=e=>o.chartDateRange.start=e)},null,512),[[s.Jo,o.chartDateRange.start]])]),(0,l.Lk)("div",Zo,[a[94]||(a[94]=(0,l.Lk)("label",{class:"form-label"},"End Date",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[39]||(a[39]=e=>o.chartDateRange.end=e)},null,512),[[s.Jo,o.chartDateRange.end]])])]),(0,l.Lk)("div",en,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[40]||(a[40]=(...e)=>o.clearChartDateFilter&&o.clearChartDateFilter(...e))},"Clear"),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:a[41]||(a[41]=(...e)=>o.applyChartDateFilter&&o.applyChartDateFilter(...e))},"Apply")])])]),(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[42]||(a[42]=e=>o.showChartDateFilter=!1)})])])])):(0,l.Q3)("",!0),o.showHistoryDateFilter?((0,l.uX)(),(0,l.Wv)(l.Im,{key:3,to:"body"},[(0,l.Lk)("div",an,[(0,l.Lk)("div",tn,[(0,l.Lk)("div",sn,[(0,l.Lk)("div",ln,[(0,l.Lk)("div",on,[a[95]||(a[95]=(0,l.Lk)("h5",{class:"modal-title"},"Filter History Date Range",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[43]||(a[43]=e=>o.showHistoryDateFilter=!1)})]),(0,l.Lk)("div",nn,[(0,l.Lk)("div",rn,[a[96]||(a[96]=(0,l.Lk)("label",{class:"form-label"},"Start Date",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[44]||(a[44]=e=>o.historyDateRange.start=e)},null,512),[[s.Jo,o.historyDateRange.start]])]),(0,l.Lk)("div",cn,[a[97]||(a[97]=(0,l.Lk)("label",{class:"form-label"},"End Date",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[45]||(a[45]=e=>o.historyDateRange.end=e)},null,512),[[s.Jo,o.historyDateRange.end]])])]),(0,l.Lk)("div",dn,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[46]||(a[46]=(...e)=>o.clearHistoryDateFilter&&o.clearHistoryDateFilter(...e))},"Clear"),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:a[47]||(a[47]=(...e)=>o.applyHistoryDateFilter&&o.applyHistoryDateFilter(...e))},"Apply")])])]),(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[48]||(a[48]=e=>o.showHistoryDateFilter=!1)})])])])):(0,l.Q3)("",!0)])}var vn=t(2830),pn=t.n(vn);t(4224);const mn={class:"modal-dialog modal-xxl"},bn={class:"modal-content"},fn={class:"modal-header bg-primary text-white"},hn={class:"modal-title"},gn={class:"modal-body"},kn={class:"student-details"},yn={class:"student-info"},Ln={class:"info-content"},Sn={class:"student-charts"},wn={key:0,class:"charts-container"},Cn={class:"chart-controls mb-3"},An={class:"assessment-type-selector"},Dn=["onClick"],En={class:"date-filter"},jn={class:"input-group input-group-sm"},In={key:0,class:"chart-section"},Yn={class:"chart-container",style:{height:"300px"}},Fn=["id"],xn={key:1,class:"chart-section"},Tn={class:"chart-container",style:{height:"300px"}},Nn=["id"],Pn={key:2,class:"chart-section"},Rn={class:"chart-container",style:{height:"300px"}},Mn=["id"],_n={key:3,class:"chart-section"},$n={class:"chart-container",style:{height:"300px"}},Kn=["id"],zn={key:1,class:"chart-section"},Wn={class:"chart-container",style:{height:"300px"}},Xn=["id"],Bn={class:"chart-section"},Un={class:"table-responsive data-table"},Hn={class:"table"},On={class:"modal-footer"};function Qn(e,a,t,o,n,r){return(0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[e.show?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:a[8]||(a[8]=(0,s.D$)(((...a)=>e.closeModal&&e.closeModal(...a)),["self"]))},[(0,l.Lk)("div",{class:"modal-wrapper",onClick:a[6]||(a[6]=(0,s.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",mn,[(0,l.Lk)("div",bn,[(0,l.Lk)("div",fn,[(0,l.Lk)("h5",hn,[a[9]||(a[9]=(0,l.Lk)("i",{class:"fas fa-user-graduate me-2"},null,-1)),(0,l.eW)(" "+(0,y.v_)(e.title),1)]),(0,l.Lk)("button",{type:"button",class:"btn-close btn-close-white",onClick:a[0]||(a[0]=(...a)=>e.closeModal&&e.closeModal(...a))})]),(0,l.Lk)("div",gn,[(0,l.Lk)("div",kn,[(0,l.Lk)("div",yn,[a[15]||(a[15]=(0,l.Lk)("h6",{class:"info-title"},"Student Information",-1)),(0,l.Lk)("div",Ln,[(0,l.Lk)("p",null,[a[10]||(a[10]=(0,l.Lk)("strong",null,"Student ID:",-1)),(0,l.eW)(" "+(0,y.v_)(e.student?.studentNumber),1)]),(0,l.Lk)("p",null,[a[11]||(a[11]=(0,l.Lk)("strong",null,"Name:",-1)),(0,l.eW)(" "+(0,y.v_)(e.student?.firstName)+" "+(0,y.v_)(e.student?.lastName),1)]),(0,l.Lk)("p",null,[a[12]||(a[12]=(0,l.Lk)("strong",null,"Year Level:",-1)),(0,l.eW)(" "+(0,y.v_)(e.yearLevel),1)]),(0,l.Lk)("p",null,[a[13]||(a[13]=(0,l.Lk)("strong",null,"Section:",-1)),(0,l.eW)(" "+(0,y.v_)(e.section),1)]),(0,l.Lk)("p",null,[a[14]||(a[14]=(0,l.Lk)("strong",null,"Subject:",-1)),(0,l.eW)(" "+(0,y.v_)(e.subject),1)]),(0,l.RG)(e.$slots,"additional-info",{},void 0,!0)])]),(0,l.Lk)("div",Sn,[e.isClassRecord?((0,l.uX)(),(0,l.CE)("div",wn,[(0,l.Lk)("div",Cn,[(0,l.Lk)("div",An,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(["All","Quiz","Activity","Performance Task"],(a=>(0,l.Lk)("button",{key:a,class:(0,y.C4)(["btn btn-sm",e.selectedAssessmentType===a?"btn-primary":"btn-outline-secondary"]),onClick:t=>e.changeAssessmentType(a)},(0,y.v_)(a),11,Dn))),64))]),(0,l.Lk)("div",En,[(0,l.Lk)("div",jn,[a[16]||(a[16]=(0,l.Lk)("span",{class:"input-group-text"},"From",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=a=>e.dateFilter.start=a),onChange:a[2]||(a[2]=a=>e.$emit("date-filter-change",e.dateFilter))},null,544),[[s.Jo,e.dateFilter.start]]),a[17]||(a[17]=(0,l.Lk)("span",{class:"input-group-text"},"To",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=a=>e.dateFilter.end=a),onChange:a[4]||(a[4]=a=>e.$emit("date-filter-change",e.dateFilter))},null,544),[[s.Jo,e.dateFilter.end]])])])]),"All"===e.selectedAssessmentType?((0,l.uX)(),(0,l.CE)("div",In,[a[18]||(a[18]=(0,l.Lk)("h6",null,"All Assessments",-1)),(0,l.Lk)("div",Yn,[(0,l.Lk)("canvas",{id:`all-${e.chartId}`},null,8,Fn)])])):"Quiz"===e.selectedAssessmentType?((0,l.uX)(),(0,l.CE)("div",xn,[a[19]||(a[19]=(0,l.Lk)("h6",null,"Quiz Performance",-1)),(0,l.Lk)("div",Tn,[(0,l.Lk)("canvas",{id:`quiz-${e.chartId}`},null,8,Nn)])])):"Activity"===e.selectedAssessmentType?((0,l.uX)(),(0,l.CE)("div",Pn,[a[20]||(a[20]=(0,l.Lk)("h6",null,"Activity Performance",-1)),(0,l.Lk)("div",Rn,[(0,l.Lk)("canvas",{id:`activity-${e.chartId}`},null,8,Mn)])])):"Performance Task"===e.selectedAssessmentType?((0,l.uX)(),(0,l.CE)("div",_n,[a[21]||(a[21]=(0,l.Lk)("h6",null,"Performance Task",-1)),(0,l.Lk)("div",$n,[(0,l.Lk)("canvas",{id:`performance-${e.chartId}`},null,8,Kn)])])):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("div",zn,[(0,l.Lk)("h6",null,(0,y.v_)(e.chartTitle),1),(0,l.Lk)("div",Wn,[(0,l.Lk)("canvas",{id:e.chartId},null,8,Xn)])])),(0,l.Lk)("div",Bn,[(0,l.Lk)("h6",null,(0,y.v_)(e.historyTitle),1),(0,l.Lk)("div",Un,[(0,l.RG)(e.$slots,"history-table",{},(()=>[(0,l.Lk)("table",Hn,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.tableHeaders,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e},(0,y.v_)(e),1)))),128))])]),(0,l.Lk)("tbody",null,[(0,l.RG)(e.$slots,"table-rows",{},(()=>[a[22]||(a[22]=(0,l.Lk)("tr",null,[(0,l.Lk)("td",{colspan:"100%",class:"text-center py-3 text-muted"},[(0,l.Lk)("i",{class:"fas fa-info-circle me-2"}),(0,l.eW)("No records found. ")])],-1))]),!0)])])]),!0)])])])])]),(0,l.Lk)("div",On,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[5]||(a[5]=(...a)=>e.closeModal&&e.closeModal(...a))},a[23]||(a[23]=[(0,l.Lk)("i",{class:"fas fa-times me-2"},null,-1),(0,l.eW)("Close ")]))])])])]),(0,l.Lk)("div",{class:"modal-backdrop",onClick:a[7]||(a[7]=(...a)=>e.closeModal&&e.closeModal(...a))})])):(0,l.Q3)("",!0)])}var Vn=(0,l.pM)({name:"StudentDetailsModal",props:{show:{type:Boolean,required:!0},student:{type:Object,required:!0},yearLevel:{type:String,default:""},section:{type:String,default:""},subject:{type:String,default:""},title:{type:String,default:"Student Details"},chartTitle:{type:String,default:"Performance Overview"},historyTitle:{type:String,default:"History"},tableHeaders:{type:Array,default:()=>["Date","Status"]},chartId:{type:String,default:"studentChart"},isClassRecord:{type:Boolean,default:!1}},emits:["close","update:show","date-filter-change","assessment-type-change"],data(){const e=(new Date).toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()-30);const t=a.toISOString().split("T")[0];return{selectedAssessmentType:"All",dateFilter:{start:t,end:e}}},methods:{closeModal(){this.$emit("update:show",!1),this.$emit("close")},changeAssessmentType(e){this.selectedAssessmentType=e,this.$emit("assessment-type-change",e)}}});const qn=(0,i.A)(Vn,[["render",Qn],["__scopeId","data-v-261896b0"]]);var Jn=qn;const Gn=p.A.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"},timeout:1e4,validateStatus:function(e){return e>=200&&e<500}});Gn.interceptors.request.use((e=>(console.log(`API Request: ${e.method.toUpperCase()} ${e.url}`,e.data||e.params),e)),(e=>(console.error("API Request Error:",e),Promise.reject(e)))),Gn.interceptors.response.use((e=>(console.log(`API Response: ${e.status} ${e.config.url}`,e.data),e)),(e=>(e.response?console.error(`API Error Response: ${e.response.status} ${e.config?.url}`,e.response.data):e.request?console.error("API No Response:",e.request):console.error("API Error:",e.message),Promise.reject(e))));var Zn={name:"ClassRecords",components:{StudentDetailsModal:Jn},setup(){const e=(0,v.Pj)(),a=(0,r.rd)(),t=(0,W.KR)(e.state.auth.user||null),s=async()=>{try{console.log("Fetching user profile...");const s=await Gn.get("/users/profile",{headers:{Authorization:`Bearer ${e.state.auth.token}`}});if(console.log("User profile response:",s.data),t.value=s.data,!t.value||"teacher"!==t.value.role)return console.log("User is not a teacher:",t.value?.role),void a.push("/dashboard");console.log("Teaching year:",t.value.teachingYear),console.log("Subjects:",t.value.subjects),t.value.teachingYear||(console.log("Teaching year not set, defaulting to 1st"),t.value.teachingYear="1st")}catch(s){console.error("Error fetching user profile:",s),a.push("/login")}};(0,l.sV)((async()=>{try{console.log("Component mounted, fetching user profile and subjects"),await s(),console.log("User profile fetched, now fetching user preferences");const a=localStorage.getItem("classRecordPreferences");if(a)try{const e=JSON.parse(a);console.log("Found preferences in localStorage:",e),e.selectedYear&&(o.value=e.selectedYear),e.selectedSection&&(n.value=e.selectedSection),e.selectedSubject&&(c.value=e.selectedSubject),e.currentPage&&($e.value=parseInt(e.currentPage)||1)}catch(e){console.error("Error parsing localStorage preferences:",e)}else await Ve();await Oe(),o.value&&n.value&&c.value?(console.log("Fetching available sections for year:",o.value),await ve(),console.log("Updating teacher subjects for section:",n.value),await Z(),console.log("Fetching class data for subject:",c.value),await B()):(console.log("Missing required filters, cannot fetch class data"),o.value&&n.value&&c.value||(await Ve(),o.value&&(await ve(),n.value&&(await Z(),c.value&&await B())))),console.log("Initial data loading complete")}catch(a){console.error("Error during component initialization:",a)}}));const o=(0,W.KR)(""),n=(0,W.KR)(""),c=(0,W.KR)(""),i=(0,W.KR)(""),d=(0,W.KR)([]),u=(0,W.KR)([]),p=(0,W.KR)(pn()().tz("Asia/Manila").startOf("day").toDate()),m=(0,W.KR)(!1),b=(0,W.KR)(null),f=(0,W.KR)(null),h=(0,W.KR)(null),g=(0,W.KR)(null),k=(0,W.KR)(!1),y=(0,W.KR)(!1),L=(0,W.KR)(""),S=(0,W.KR)("asc"),w=(0,W.KR)({year:"",section:"",subject:""}),C=(0,W.KR)(""),A=(0,W.KR)(!1),D=(0,W.KR)(!1),E=(0,W.KR)({start:pn()().subtract(30,"days").format("YYYY-MM-DD"),end:pn()().format("YYYY-MM-DD")}),j=(0,W.KR)({start:pn()().subtract(30,"days").format("YYYY-MM-DD"),end:pn()().format("YYYY-MM-DD")}),I=(0,W.KR)({type:"",number:"",maxScore:""}),Y=(0,W.KR)([]),F=(0,W.KR)([]),x=(0,W.KR)({}),T=(0,W.KR)([]),N=(0,l.EW)((()=>(console.log("User object:",t.value),console.log("Teaching year:",t.value?.teachingYear),t.value?.teachingYear||"N/A"))),P=((0,l.EW)((()=>{const e=N.value;switch(e){case"1st":return["ITE 100","ITE 101","ITE 102","ITE 103"];case"2nd":return["ITE 200","ITE 201","ITE 202","ITE 203"];case"3rd":return["ITE 301","ITE 302","ITE 303","ITE 304"];case"4th":return["ITE 400","ITE 401","ITE 402","ITE 403","ITE 404"];default:return[]}})),(0,l.EW)((()=>d.value.filter((e=>{const a=i.value.toLowerCase();return e.studentNumber.toLowerCase().includes(a)||e.firstName.toLowerCase().includes(a)||e.lastName.toLowerCase().includes(a)}))))),R=(0,l.EW)((()=>{let e=[...P.value];return L.value&&e.sort(((e,a)=>{let t=e[L.value],s=a[L.value];return"string"===typeof t&&(t=t.toLowerCase()),"string"===typeof s&&(s=s.toLowerCase()),t<s?"asc"===S.value?-1:1:t>s?"asc"===S.value?1:-1:0})),e})),M=e=>{L.value===e?S.value="asc"===S.value?"desc":"asc":(L.value=e,S.value="asc")},_=e=>L.value!==e?"fas fa-sort":"asc"===S.value?"fas fa-sort-up":"fas fa-sort-down",$=()=>{y.value=!y.value,y.value||(i.value="")},K=()=>{console.log("Searching for:",i.value)},z=async()=>{try{console.log("Applying filters:",{year:o.value,section:n.value,subject:c.value}),await Qe(),o.value&&n.value&&c.value&&qe({year:o.value,section:n.value,subject:c.value,timestamp:(new Date).toISOString()});try{const a=e.state.auth.token,t=e.state.auth.user?._id;t&&o.value&&n.value&&c.value&&(await Gn.post("/users/record-filter-usage",{userId:t,year:o.value,section:n.value,subject:c.value,timestamp:(new Date).toISOString()},{headers:{Authorization:`Bearer ${a}`}}),console.log("Filter usage recorded"))}catch(a){console.error("Error recording filter usage:",a)}await B(),o.value&&n.value&&c.value&&await H()}catch(t){console.error("Error applying filters:",t),console.error("Error details:",{message:t.message,response:t.response?.data,status:t.response?.status});try{const e=localStorage.getItem("classRecordPreferences");if(e){const a=JSON.parse(e);console.log("Recovering with localStorage preferences:",a);let t=!1;a.selectedYear&&a.selectedYear!==o.value&&(o.value=a.selectedYear,t=!0),a.selectedSection&&a.selectedSection!==n.value&&(n.value=a.selectedSection,t=!0),a.selectedSubject&&a.selectedSubject!==c.value&&(c.value=a.selectedSubject,t=!0),t&&(console.log("Recovered with localStorage values, fetching data again"),await B(),o.value&&n.value&&c.value&&await H())}}catch(s){console.error("Failed to recover with localStorage:",s)}}},X=(0,l.EW)((()=>w.value.year&&w.value.section&&w.value.subject)),B=async()=>{try{if(!o.value||!n.value||!c.value)return console.log("Missing required filters for fetchClassData:",{year:o.value||"missing",section:n.value||"missing",subject:c.value||"missing"}),void(d.value=[]);const a=e.state.auth.user?._id;if(!a)return void console.error("Teacher ID not available");const t={teacherId:a,year:o.value,section:n.value,subject:c.value};console.log("Fetching class data with filters:",t);const s=await Gn.get("/teacher-class-records/students",{params:t,headers:{Authorization:`Bearer ${e.state.auth.token}`}});if(!s.data||!Array.isArray(s.data)||0===s.data.length)return console.log("No students found for the selected filters"),void(d.value=[]);d.value=s.data.map((e=>({...e,scores:{}}))),await H(),console.log("Fetched students:",d.value.length)}catch(a){console.error("Failed to fetch class data:",a),console.error("Error details:",{message:a.message,response:a.response?.data,status:a.response?.status}),400!==a.response?.status&&alert("Failed to load class data. Please try again."),d.value=[]}},U=async()=>{try{if(!n.value||!c.value)return void alert("Please select a section and subject first");const a=e.state.auth.user?._id;if(!a)return void console.error("Teacher ID not available");const t={type:I.value.type,number:parseInt(I.value.number),maxScore:parseInt(I.value.maxScore),teacherId:a,section:n.value,subject:c.value,date:p.value.toISOString()},s=await Gn.post("/assessments",t,{headers:{Authorization:`Bearer ${e.state.auth.token}`,"Content-Type":"application/json"}});u.value.push(s.data),I.value={type:"",number:"",maxScore:""},m.value=!1}catch(a){console.error("Failed to add assessment:",a),alert("Failed to add assessment. "+(a.response?.data?.message||"Please try again."))}},H=async()=>{try{if(!n.value||!c.value)return void console.log("Missing required filters for fetching assessments");const a=e.state.auth.user?._id||t.value?._id,s=pn()(p.value).format("YYYY-MM-DD");console.log("Fetching assessments for:",{teacherId:a,section:n.value,subject:c.value,date:s});const l=V("Loading assessments...","info",0),o=await Gn.get("/assessments",{params:{teacherId:a,section:n.value,subject:c.value,date:s},headers:{Authorization:`Bearer ${e.state.auth.token}`}});if(q(l),!o.data||!Array.isArray(o.data))return console.error("Invalid response data:",o.data),void V("Failed to load assessments","error",3e3);console.log(`Loaded ${o.data.length} assessments`);const r=o.data.sort(((e,a)=>{const t=new Date(e.date),s=new Date(a.date);if(t.getTime()!==s.getTime())return t-s;const l={Quiz:1,Activity:2,"Performance Task":3};return l[e.type]!==l[a.type]?l[e.type]-l[a.type]:e.number-a.number}));u.value=r.map((e=>{const a=e.title||`${e.type} ${e.number}`;return{...e,id:e._id,title:a,scores:e.scores||{},date:e.date?new Date(e.date):new Date}})),console.log("Processed assessments:",u.value),b.value&&await J(b.value),u.value.length>0?V(`Loaded ${u.value.length} assessments`,"success",2e3):V("No assessments found for the selected filters","info",3e3)}catch(a){console.error("Error fetching assessments:",a),V("Failed to load assessments: "+(a.message||"Unknown error"),"error",3e3)}},O=(0,l.EW)((()=>u.value.filter((e=>{const a=new Date(e.date),t=new Date(p.value);t.setUTCHours(0,0,0,0),t.setHours(t.getHours()+8);const s=new Date(p.value);return s.setUTCHours(23,59,59,999),s.setHours(s.getHours()+8),a>=t&&a<=s})).sort(((e,a)=>{const t={Quiz:1,Activity:2,"Performance Task":3};return t[e.type]!==t[a.type]?t[e.type]-t[a.type]:e.number-a.number}))));(0,l.wB)(p,(async()=>{await H()}));const Q=async(a,t,s)=>{try{const o=e.state.auth.token,n=e.state.auth.user?._id;if(!n)return console.error("Teacher ID not available"),void V("Teacher ID not available. Please log in again.","error",3e3);const r=t._id||t.id;if(!r)return console.error("Assessment ID not available"),void V("Assessment ID not available. Please try again.","error",3e3);let c=s;if(void 0===c&&(c=a.scores?.[r]),null===c||""===c)c=null,console.log(`Removing score for student ${a.studentNumber}, assessment ${r}`);else{const e=parseInt(c);if(isNaN(e)||e<0||e>t.maxScore)return void V(`Please enter a valid score between 0 and ${t.maxScore}`,"error",3e3);c=e}console.log(`Updating score for student ${a.studentNumber}, assessment ${r}: ${c}`);const i={assessmentId:r,teacherId:n,studentNumber:a.studentNumber,score:c};console.log("Sending score update request with payload:",i);const v=V("Updating score...","info",0),p=await Gn.post("/assessments/update-score-direct",i,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(q(v),console.log("Score update response:",p.data),!p.data||!p.data.success)return console.error("Error updating score:",p.data?.message||"Unknown error"),void V(p.data?.message||"Failed to update score","error",3e3);V("Score updated successfully","success",2e3);const m=p.data.assessment;if(!m)return void console.error("No assessment returned from server");console.log("Updated assessment:",m),console.log("Updated scores:",m.scores);const f=u.value.findIndex((e=>e._id===r||e.id===r));if(-1!==f){if(u.value[f]={...u.value[f],scores:m.scores||{}},u.value=[...u.value],d.value){const e=d.value.findIndex((e=>e.studentNumber===a.studentNumber));-1!==e&&(d.value[e].scores||(d.value[e].scores={}),d.value[e].scores[r]=c,d.value=[...d.value])}b.value&&b.value.studentNumber===a.studentNumber&&(0,l.dY)((()=>{He(),Je()}))}}catch(o){console.error("Error updating score:",o),V("Failed to update score. Please try again.","error",3e3)}},V=(e,a="info",t=3e3)=>{const s=document.createElement("div");if(s.className=`toast toast-${a}`,s.innerHTML=e,document.body.appendChild(s),!document.getElementById("toast-styles")){const e=document.createElement("style");e.id="toast-styles",e.innerHTML="\n          .toast {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 4px;\n            color: white;\n            font-weight: bold;\n            z-index: 9999;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            animation: toast-in 0.3s ease-out;\n          }\n          .toast-info {\n            background-color: #3498db;\n          }\n          .toast-success {\n            background-color: #2ecc71;\n          }\n          .toast-warning {\n            background-color: #f39c12;\n          }\n          .toast-error {\n            background-color: #e74c3c;\n          }\n          @keyframes toast-in {\n            from { transform: translateY(-20px); opacity: 0; }\n            to { transform: translateY(0); opacity: 1; }\n          }\n        ",document.head.appendChild(e)}return t>0&&setTimeout((()=>{q(s)}),t),s},q=e=>{e&&document.body.contains(e)&&(e.style.opacity="0",e.style.transform="translateY(-20px)",e.style.transition="all 0.3s ease-out",setTimeout((()=>{document.body.contains(e)&&document.body.removeChild(e)}),300))},J=async a=>{try{if(!a)return void console.error("Invalid student data provided to viewStudentDetails");if(b.value){const e=`performanceChart-${b.value.studentNumber}`,a=[`all-${e}`,`quiz-${e}`,`activity-${e}`,`performance-${e}`];a.forEach((e=>{const a=document.getElementById(e);if(a){const e=oa.Ay.getChart(a);e&&e.destroy()}}))}C.value="All";const t=await Gn.get("/assessments",{params:{teacherId:e.state.auth.user?._id,section:n.value,subject:c.value},headers:{Authorization:`Bearer ${e.state.auth.token}`}});if(!t.data)throw new Error("Failed to fetch assessment data");const s=t.data.map((e=>({...e,id:e._id,scores:e.scores||{}})));b.value={...a,assessments:s};const o=pn()().format("YYYY-MM-DD"),r=pn()().subtract(30,"days").format("YYYY-MM-DD");E.value={start:r,end:o},j.value={start:r,end:o},(0,l.dY)((()=>{He()}))}catch(t){console.error("Error fetching student details:",t),alert("Failed to load student details. Please try again.")}};(0,l.wB)(p,(async()=>{b.value&&await J(b.value)}));const G=e=>e?pn()(e).tz("Asia/Manila").format("MMMM D, YYYY"):"",Z=async()=>{try{if(!o.value||!n.value)return console.log("Missing year or section for fetching subjects"),void(T.value=[]);const a=e.state.auth.user?._id,t=await Gn.get("/teacher-class-records/available-subjects",{params:{teacherId:a,year:o.value,section:n.value},headers:{Authorization:`Bearer ${e.state.auth.token}`}});t.data&&t.data.subjects?(T.value=t.data.subjects.sort(),console.log("Fetched teacher subjects:",T.value),!c.value&&T.value.length>0&&(c.value=T.value[0])):T.value=[]}catch(a){console.error("Failed to fetch teacher subjects:",a),T.value=[]}},ee=async()=>{console.log("handleAddStudentRecord function called");try{const l=e.state.auth.token,r=e.state.auth.user?._id||t.value?._id;if(console.log("Adding student record with:",{year:w.value.year,section:w.value.section,subject:w.value.subject}),!r)return console.error("Teacher ID not available"),alert("Teacher information is not available. Please try logging in again."),e.dispatch("logout"),void a.push("/login");console.log("Fetching students for section:",w.value.year,w.value.section);const i=await Gn.get("/students/by-section",{params:{year:w.value.year,section:w.value.section},headers:{Authorization:`Bearer ${l}`}});if(console.log("Students response:",i.data),!i.data||0===i.data.length)return void alert("No students found in the selected section.");const u=i.data.map((e=>({studentId:e._id,studentNumber:e.studentId,firstName:e.firstName,lastName:e.lastName,year:e.year,section:e.section})));console.log("Mapped students:",u);const v={teacherId:r,year:w.value.year,section:w.value.section,subject:w.value.subject,students:u};console.log("Creating class record with data:",v);const p=await Gn.post("/teacher-class-records/create",v,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(console.log("Create response:",p.data),p.data){try{const e=pn()().tz("Asia/Manila").startOf("day").format("YYYY-MM-DD");console.log("Creating attendance records for date:",e);const a=u.map((a=>(console.log(`Creating attendance record for student ${a.firstName} ${a.lastName} (${a.studentNumber})`),Gn.post("/attendance",{studentId:a.studentId,teacherId:r,date:e,subject:w.value.subject,section:w.value.section,status:"present"},{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}).then((e=>(console.log(`Successfully created attendance record for student ${a.studentNumber}:`,e.data),e))).catch((e=>(console.warn(`Failed to create attendance record for student ${a.studentNumber}:`,e),e.response&&404===e.response.status&&console.warn("Attendance API endpoint not found. This is expected if the attendance service is not yet implemented."),Promise.resolve()))))));await Promise.all(a),console.log("Attendance records creation completed")}catch(s){console.warn("Error creating attendance records:",s)}k.value=!1,w.value={year:"",section:"",subject:""},o.value=v.year,n.value=v.section,c.value=v.subject,console.log("Selected filters updated to:",{year:o.value,section:n.value,subject:c.value}),console.log("Refreshing class data and attendance..."),await B(),0===d.value.length&&(console.log("No students loaded after fetchClassData, trying again..."),setTimeout((async()=>{await B(),console.log("Second attempt to fetch class data complete, students:",d.value.length)}),500));try{await Re(),console.log("Attendance data refreshed successfully")}catch(s){console.warn("Error fetching attendance:",s)}console.log("Data refresh complete"),alert("Student records added successfully!")}}catch(l){console.error("Failed to add student record:",l),l.response&&console.error("Error response:",l.response.data);let a=!1;try{if(w.value.year&&w.value.section&&w.value.subject){const s=await Gn.get("/teacher-class-records",{params:{teacherId:e.state.auth.user?._id||t.value?._id,year:w.value.year,section:w.value.section,subject:w.value.subject},headers:{Authorization:`Bearer ${e.state.auth.token}`}});s.data&&s.data.length>0&&(a=!0,console.log("Class record was created successfully despite errors"))}}catch(r){console.error("Error checking if class record was created:",r)}if(a){k.value=!1;const e=w.value.year,a=w.value.section,t=w.value.subject;w.value={year:"",section:"",subject:""},o.value=e,n.value=a,c.value=t,await B();try{await Re(),console.log("Attendance data refreshed successfully after recovery")}catch(s){console.warn("Error fetching attendance after recovery:",s)}alert("Student records added successfully, but there was an issue with attendance records. You may need to set attendance separately.")}else"A class record already exists for this combination"===l.response?.data?.message?alert("A class record already exists for this combination of teacher, year, section, and subject."):alert("Failed to add student record. Please try again.")}};(0,l.wB)(o,(async e=>{e?(n.value="",c.value="",await ve(),await Qe()):F.value=[]})),(0,l.wB)(n,(async e=>{e?(c.value="",await Z(),await Qe()):T.value=[]})),(0,l.wB)(c,(async e=>{e?(await B(),await Qe()):d.value=[]}));const ae=async()=>{o.value="",n.value="",c.value="",$e.value=1,d.value=[],u.value=[],localStorage.removeItem("classRecordPreferences");try{const a=e.state.auth.token,t=e.state.auth.user?._id;if(t){const e={selectedYear:"",selectedSection:"",selectedSubject:"",currentPage:1};await Gn.post("/users/preferences",{userId:t,preferences:e},{headers:{Authorization:`Bearer ${a}`}}),console.log("Preferences cleared successfully")}}catch(a){console.error("Error clearing preferences:",a)}};(0,l.sV)((async()=>{if(e.getters.isLoggedIn)try{const s=e.state.auth.token;if(!s)return console.error("No auth token found"),void a.push("/login");console.log("Fetching user profile...");const l=await Gn.get("/users/profile",{headers:{Authorization:`Bearer ${s}`}});console.log("User profile response:",l.data),l.data&&"teacher"===l.data.role?(t.value=l.data,console.log("Teacher data loaded:",t.value),await ue(),o.value&&(await ve(),n.value&&(await Z(),c.value&&await Promise.all([B(),H()])))):(console.error("User is not a teacher:",l.data),a.push("/login"))}catch(s){Ee(s,"onMounted")}else console.log("User not logged in, redirecting to login"),a.push("/login")}));const te=e=>{switch(e){case"Quiz":return"badge-quiz";case"Activity":return"badge-activity";case"Performance Task":return"badge-performance";default:return""}},se=e=>e>=90?"score-excellent":e>=80?"score-good":e>=75?"score-average":"score-poor";(0,l.wB)([n,c],(async()=>{n.value&&c.value&&(await B(),await H())}));const le=(e,a)=>{if(e.value){const a=oa.Ay.getChart(e.value);a&&a.destroy()}const t={Quiz:"#4e73df",Activity:"#1cc88a","Performance Task":"#f6c23e"},s={type:"bar",data:{labels:a.labels,datasets:[{data:a.scores,backgroundColor:t[a.type],borderRadius:6,maxBarThickness:40,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#fff",titleColor:"#203464",bodyColor:"#203464",borderColor:"#e9ecef",borderWidth:1,padding:12,displayColors:!1,callbacks:{label:function(e){return`Score: ${e.parsed.y}%`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#6c757d",font:{size:11}}},y:{beginAtZero:!0,max:100,grid:{color:"#f8f9fa",drawBorder:!1},ticks:{color:"#6c757d",font:{size:11,callback:function(e){return e+"%"}}}}}}};return new oa.Ay(e.value,s)},oe=()=>{if([f,h,g].forEach((e=>{if(e.value){const a=oa.Ay.getChart(e.value);a&&a.destroy()}})),!b.value)return;const e={Quiz:f,Activity:h,"Performance Task":g};Object.entries(e).forEach((([e,a])=>{const t=b.value.assessments.filter((a=>a.type===e)).sort(((e,a)=>new Date(e.date)-new Date(a.date)));if(t.length>0){const s={type:e,labels:t.map((e=>G(e.date))),scores:t.map((e=>(e.score/e.maxScore*100).toFixed(1)))};le(a,s)}}))},ne=(0,W.KR)(!1),re=(0,W.KR)({type:"",number:"",maxScore:""}),ce=e=>{re.value={...e},ne.value=!0},ie=async()=>{try{const a=e.state.auth.token,t=await Gn.put(`/assessments/${re.value._id}`,{type:re.value.type,number:re.value.number,maxScore:re.value.maxScore},{headers:{Authorization:`Bearer ${a}`}});if(t.data){const e=u.value.findIndex((e=>e._id===re.value._id));-1!==e&&(u.value[e]={...t.data,id:t.data._id}),ne.value=!1,alert("Assessment updated successfully!")}}catch(a){console.error("Failed to update assessment:",a),alert("Failed to update assessment. Please try again.")}},de=async()=>{if(confirm("Are you sure you want to delete this assessment? This action cannot be undone."))try{const a=e.state.auth.token;await Gn.delete(`/assessments/${re.value._id}`,{headers:{Authorization:`Bearer ${a}`}}),u.value=u.value.filter((e=>e._id!==re.value._id)),ne.value=!1,alert("Assessment deleted successfully!")}catch(a){console.error("Failed to delete assessment:",a),alert("Failed to delete assessment. Please try again.")}},ue=async()=>{try{console.log("Starting fetchAvailableYears...");const a=e.state.auth.token,t=e.state.auth.user?._id;if(!t)return void console.error("No teacherId available");console.log("Making API request for available years...");const s=await Gn.get("/teacher-class-records",{params:{teacherId:t},headers:{Authorization:`Bearer ${a}`}});console.log("Available years response:",s.data);const l=[...new Set(s.data.map((e=>e.year)))];Y.value=l.sort(),!o.value&&Y.value.length>0&&(o.value=Y.value[0])}catch(a){Ee(a,"fetchAvailableYears")}},ve=async()=>{try{if(!o.value)return console.log("No year selected for fetching sections"),void(F.value=[]);const a=e.state.auth.user?._id,t=await Gn.get("/teacher-class-records/available-sections",{params:{teacherId:a,year:o.value},headers:{Authorization:`Bearer ${e.state.auth.token}`}}),s=[...new Set(t.data.map((e=>e.section)))];F.value=s.sort(),console.log("Fetched available sections:",F.value)}catch(a){console.error("Failed to fetch available sections:",a),F.value=[]}},pe=(0,l.EW)((()=>!!o.value)),me=(0,l.EW)((()=>!!n.value)),be=(0,l.EW)((()=>b.value?.assessments?b.value.assessments.filter((e=>{if(C.value&&e.type!==C.value)return!1;if(j.value.start&&j.value.end){const a=new Date(e.date),t=new Date(j.value.start);t.setUTCHours(0,0,0,0),t.setHours(t.getHours()+8);const s=new Date(j.value.end);if(s.setUTCHours(23,59,59,999),s.setHours(s.getHours()+8),a<t||a>s)return!1}return!0})).sort(((e,a)=>new Date(a.date)-new Date(e.date))):[])),fe=()=>{E.value.start&&E.value.end&&(0,l.dY)((()=>{He()})),A=!1},he=()=>{E.value={start:pn()().subtract(30,"days").format("YYYY-MM-DD"),end:pn()().format("YYYY-MM-DD")},(0,l.dY)((()=>{He()})),A=!1},ge=()=>{D=!1},ke=()=>{j.value={start:pn()().subtract(30,"days").format("YYYY-MM-DD"),end:pn()().format("YYYY-MM-DD")},D=!1};(0,l.wB)(C,(()=>{}));const ye=async()=>{try{await e.dispatch("logout"),a.push("/login")}catch(t){console.error("Logout failed:",t)}},Le=e=>{const a=pn()().tz("Asia/Manila").startOf("day"),t=pn()(p.value).tz("Asia/Manila").startOf("day").add(e,"days");(e<0||e>0&&!t.isAfter(a,"day"))&&(Ae.value=e>0?"slide-left":"slide-right",p.value=t.toDate(),B(),Re(),setTimeout((()=>{Ae.value=""}),300))},Se=e=>{if(!e)return"";const a=new Date(e);return a.setHours(a.getHours()+8),a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",timeZone:"Asia/Manila"})},we=()=>{A.value=!0,D.value=!1},Ce=()=>{D.value=!0,A.value=!1},Ae=(0,W.KR)(""),De=(0,l.EW)((()=>{const e=pn()().tz("Asia/Manila").startOf("day"),a=pn()(p.value).tz("Asia/Manila").startOf("day");return a.isSameOrAfter(e,"day")})),Ee=(t,s)=>{console.error(`Error in ${s}:`,t),console.error("Error details:",{message:t.message,response:t.response?.data,status:t.response?.status}),401===t.response?.status&&(e.dispatch("logout"),a.push("/login"))},je=async()=>{try{const a=e.state.auth.token;console.log("Fetching available years and sections...");const t=await Gn.get("/students/available-years-sections",{headers:{Authorization:`Bearer ${a}`}});if(console.log("API Response:",t.data),t.data){if(Y.value=t.data.years||[],F.value=t.data.sections||[],t.data.sectionsByYear?x.value=t.data.sectionsByYear:x.value={},0===Y.value.length&&(Y.value=["1st","2nd","3rd","4th"],console.log("No years found, using default values:",Y.value)),0===F.value.length&&(F.value=["South 1","South 2","South 3"],console.log("No sections found, using default values:",F.value)),0===Object.keys(x.value).length){const e=["1st","2nd","3rd","4th"],a=["South 1","South 2","South 3"];e.forEach((e=>{x.value[e]=a})),console.log("No sections by year found, using default mapping:",x.value)}console.log("Available years:",Y.value),console.log("Available sections:",F.value),console.log("Sections by year:",x.value)}}catch(a){console.error("Failed to fetch available years and sections:",a),Y.value=["1st","2nd","3rd","4th"],F.value=["South 1","South 2","South 3"],x.value={"1st":["South 1","South 2","South 3"],"2nd":["South 1","South 2","South 3"],"3rd":["South 1","South 2","South 3"],"4th":["South 1","South 2","South 3"]},console.log("Using default values due to error")}},Ie=async()=>{try{const a=e.state.auth.token,t=e.state.auth.user?._id;if(console.log("Fetching teacher subjects..."),!t)return console.error("Teacher ID not available"),void(T.value=[]);const s=await Gn.get("/users/profile",{headers:{Authorization:`Bearer ${a}`}});console.log("Teacher profile response:",s.data),s.data&&s.data.subjects&&s.data.subjects.length>0?(T.value=s.data.subjects.sort(),console.log("Fetched teacher subjects:",T.value)):(console.log("No subjects found in teacher profile"),T.value=[])}catch(a){console.error("Failed to fetch teacher subjects:",a),T.value=[]}},Ye=async()=>{w.value={year:"",section:"",subject:""},console.log("Opening Add Student Record modal");try{await je(),await Ie(),console.log("Form reset and data fetched, opening modal"),console.log("- Years:",Y.value),console.log("- Sections by year:",x.value),console.log("- Subjects:",T.value),k.value=!0}catch(e){console.error("Error preparing Add Student Record modal:",e),alert("Failed to prepare the Add Student Record form. Please try again.")}},Fe=(0,l.EW)((()=>{if(!w.value.year)return[];console.log("Filtering sections for year:",w.value.year),console.log("Available sections by year:",x.value);const e=x.value[w.value.year]||[];return console.log("Filtered sections:",e),e}));(0,l.wB)((()=>w.value.year),(e=>{w.value.section=""}));let xe=null;const Te=()=>{const e=()=>{const e=pn()().tz("Asia/Manila"),a=pn()(p.value).tz("Asia/Manila");e.isAfter(a,"day")&&(p.value=e.toDate(),B(),Re())};xe&&clearInterval(xe),xe=setInterval(e,6e4)},Ne=(0,W.KR)([]),Pe=(0,W.KR)(null),Re=async()=>{try{if(!n.value||!c.value)return void console.log("fetchAttendance: Missing required filters",{section:n.value,subject:c.value});console.log("fetchAttendance: Fetching attendance data with filters",{section:n.value,subject:c.value,date:pn()(p.value).tz("Asia/Manila").format("YYYY-MM-DD")});const a=pn()(p.value).tz("Asia/Manila").format("YYYY-MM-DD"),t=await Gn.get(`/attendance/date/${a}`,{params:{subject:c.value,section:n.value},headers:{Authorization:`Bearer ${e.state.auth.token}`}});Ne.value=t.data}catch(a){console.error("Error fetching attendance:",a)}};(0,l.hi)((()=>{xe&&clearInterval(xe)})),(0,l.sV)((async()=>{if(e.getters.isLoggedIn)try{await s(),await Ie(),Te()}catch(t){Ee(t,"component mount")}else a.push("/login")}));const Me=async()=>{try{if(!o.value||!n.value)return void alert("Please select a year and section first");const a=await Gn.post("/teacher-class-records/sync-records",{year:o.value,section:n.value},{headers:{Authorization:`Bearer ${e.state.auth.token}`,"Content-Type":"application/json"}});a.data.success&&(await B(),await Re(),alert("Student records synchronized successfully!"))}catch(a){console.error("Failed to sync student records:",a),alert("Failed to sync student records. Please try again.")}},_e=()=>{o.value&&n.value&&c.value?a.push({name:"Attendance",query:{year:o.value,section:n.value,subject:c.value}}):alert("Please select a year, section, and subject first")},$e=(0,W.KR)(1),Ke=25,ze=(0,l.EW)((()=>Math.ceil(R.value.length/Ke))),We=(0,l.EW)((()=>{const e=($e.value-1)*Ke,a=e+Ke;return R.value.slice(e,a)})),Xe=(0,l.EW)((()=>{const e=0===R.value.length?0:($e.value-1)*Ke+1,a=Math.min(e+Ke-1,R.value.length);return{start:e,end:a}})),Be=()=>{$e.value<ze.value&&($e.value++,Qe())},Ue=()=>{$e.value>1&&($e.value--,Qe())};(0,l.wB)([i,o,n,c],(()=>{$e.value=1}));const He=()=>{if(!b.value)return void console.error("No student selected, cannot create performance chart");console.log("Creating performance charts for student:",b.value.studentNumber),console.log("Selected assessment type:",C.value),console.log("Date range:",E.value);const e={Quiz:[],Activity:[],"Performance Task":[]};b.value.assessments&&b.value.assessments.length>0&&(console.log(`Processing ${b.value.assessments.length} assessments for charts`),b.value.assessments.forEach((a=>{if(a&&a.type in e){const t=b.value.studentNumber;let s=null;if(a.scores&&(a.scores instanceof Map?s=a.scores.get(t):"object"===typeof a.scores&&(s=a.scores[t])),null!==s&&void 0!==s||!b.value.scores||!(a._id in b.value.scores)&&!(a.id in b.value.scores)||(s=b.value.scores[a._id]||b.value.scores[a.id]),null!==s&&void 0!==s){const t=a.maxScore||100,l=s/t*100,o=new Date(a.date),n=E.value.start?new Date(E.value.start):null,r=E.value.end?new Date(E.value.end):null;if(n&&o<n||r&&o>r)return void console.log(`Skipping assessment ${a.type} #${a.number} due to date filter`);console.log(`Including assessment ${a.type} #${a.number}: Score=${s}/${t} (${l.toFixed(1)}%)`),e[a.type].push({date:a.date,score:l,rawScore:s,maxScore:t,number:a.number,title:`${a.type} #${a.number}`})}}}))),Object.keys(e).forEach((a=>{console.log(`${a} assessments: ${e[a].length}`)}));const a=`performanceChart-${b.value.studentNumber}`,t=[`all-${a}`,`quiz-${a}`,`activity-${a}`,`performance-${a}`];if(t.forEach((e=>{const a=document.getElementById(e);if(a){const t=oa.Ay.getChart(a);t&&(console.log(`Destroying existing chart: ${e}`),t.destroy())}})),Je(e),"All"===C.value){const t=document.getElementById(`all-${a}`);if(t){const a=t.getContext("2d");if(a){const s=[...e["Quiz"].map((e=>({...e,type:"Quiz"}))),...e["Activity"].map((e=>({...e,type:"Activity"}))),...e["Performance Task"].map((e=>({...e,type:"Performance Task"})))].sort(((e,a)=>new Date(e.date)-new Date(a.date)));if(0===s.length){const e=t.parentElement;if(e){e.innerHTML="";const a=document.createElement("div");a.className="text-center py-5 text-muted",a.innerHTML='<i class="fas fa-info-circle me-2"></i>No assessment data available for this student in the selected date range.',e.appendChild(a)}}else{const e=[{label:"Quiz",data:s.filter((e=>"Quiz"===e.type)).map((e=>({x:new Date(e.date),y:e.score}))),borderColor:"#4285F4",backgroundColor:"rgba(66, 133, 244, 0.1)",borderWidth:2,tension:.4,pointBackgroundColor:"#4285F4",pointBorderColor:"#fff",pointRadius:5},{label:"Activity",data:s.filter((e=>"Activity"===e.type)).map((e=>({x:new Date(e.date),y:e.score}))),borderColor:"#34A853",backgroundColor:"rgba(52, 168, 83, 0.1)",borderWidth:2,tension:.4,pointBackgroundColor:"#34A853",pointBorderColor:"#fff",pointRadius:5},{label:"Performance Task",data:s.filter((e=>"Performance Task"===e.type)).map((e=>({x:new Date(e.date),y:e.score}))),borderColor:"#FBBC05",backgroundColor:"rgba(251, 188, 5, 0.1)",borderWidth:2,tension:.4,pointBackgroundColor:"#FBBC05",pointBorderColor:"#fff",pointRadius:5}].filter((e=>e.data.length>0));new oa.Ay(a,{type:"line",data:{datasets:e},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"MMM D, YYYY"},tooltipFormat:"MMM D, YYYY"},adapters:{date:{locale:"en"}},title:{display:!0,text:"Date"},grid:{display:!1},ticks:{font:{size:12,weight:"bold"},padding:10}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Score (%)"},ticks:{callback:e=>e+"%"}}},plugins:{tooltip:{callbacks:{title:e=>pn()(e[0].parsed.x).format("MMMM D, YYYY"),label:e=>{const a=e.dataset.label,t=e.parsed.y;return`${a}: ${t.toFixed(1)}%`}}},legend:{position:"top"}}}})}}}}if("Quiz"===C.value){const t=document.getElementById(`quiz-${a}`);if(t){const a=t.getContext("2d");if(a){const s=e["Quiz"].sort(((e,a)=>new Date(e.date)-new Date(a.date)));if(0===s.length){const e=t.parentElement;if(e){e.innerHTML="";const a=document.createElement("div");a.className="text-center py-5 text-muted",a.innerHTML='<i class="fas fa-info-circle me-2"></i>No quiz data available for this student in the selected date range.',e.appendChild(a)}}else{const e=s.map((e=>({x:new Date(e.date),y:e.score,rawScore:e.rawScore,maxScore:e.maxScore,number:e.number})));new oa.Ay(a,{type:"line",data:{datasets:[{label:"Quiz Scores",data:e,borderColor:"#4285F4",backgroundColor:"rgba(66, 133, 244, 0.1)",borderWidth:2,tension:.4,fill:!0,pointBackgroundColor:"#4285F4",pointBorderColor:"#fff",pointRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"MMM D, YYYY"},tooltipFormat:"MMM D, YYYY"},adapters:{date:{locale:"en"}},title:{display:!0,text:"Date"},grid:{display:!1}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Score (%)"},ticks:{callback:e=>e+"%"}}},plugins:{tooltip:{callbacks:{title:e=>pn()(e[0].parsed.x).format("MMMM D, YYYY"),label:e=>{const a=e.raw;return[`Quiz #${a.number}`,`Score: ${a.rawScore}/${a.maxScore} (${a.y.toFixed(1)}%)`]}}}}}})}}}}if("Activity"===C.value){const t=document.getElementById(`activity-${a}`);if(t){const a=t.getContext("2d");if(a){const s=e["Activity"].sort(((e,a)=>new Date(e.date)-new Date(a.date)));if(0===s.length){const e=t.parentElement;if(e){e.innerHTML="";const a=document.createElement("div");a.className="text-center py-5 text-muted",a.innerHTML='<i class="fas fa-info-circle me-2"></i>No activity data available for this student in the selected date range.',e.appendChild(a)}}else{const e=s.map((e=>({x:new Date(e.date),y:e.score,rawScore:e.rawScore,maxScore:e.maxScore,number:e.number})));new oa.Ay(a,{type:"line",data:{datasets:[{label:"Activity Scores",data:e,borderColor:"#34A853",backgroundColor:"rgba(52, 168, 83, 0.1)",borderWidth:2,tension:.4,fill:!0,pointBackgroundColor:"#34A853",pointBorderColor:"#fff",pointRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"MMM D, YYYY"},tooltipFormat:"MMM D, YYYY"},adapters:{date:{locale:"en"}},title:{display:!0,text:"Date"},grid:{display:!1}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Score (%)"},ticks:{callback:e=>e+"%"}}},plugins:{tooltip:{callbacks:{title:e=>pn()(e[0].parsed.x).format("MMMM D, YYYY"),label:e=>{const a=e.raw;return[`Activity #${a.number}`,`Score: ${a.rawScore}/${a.maxScore} (${a.y.toFixed(1)}%)`]}}}}}})}}}}if("Performance Task"===C.value){const t=document.getElementById(`performance-${a}`);if(t){const a=t.getContext("2d");if(a){const s=e["Performance Task"].sort(((e,a)=>new Date(e.date)-new Date(a.date)));if(0===s.length){const e=t.parentElement;if(e){e.innerHTML="";const a=document.createElement("div");a.className="text-center py-5 text-muted",a.innerHTML='<i class="fas fa-info-circle me-2"></i>No performance task data available for this student in the selected date range.',e.appendChild(a)}}else{const e=s.map((e=>({x:new Date(e.date),y:e.score,rawScore:e.rawScore,maxScore:e.maxScore,number:e.number})));new oa.Ay(a,{type:"line",data:{datasets:[{label:"Performance Task Scores",data:e,borderColor:"#FBBC05",backgroundColor:"rgba(251, 188, 5, 0.1)",borderWidth:2,tension:.4,fill:!0,pointBackgroundColor:"#FBBC05",pointBorderColor:"#fff",pointRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"MMM D, YYYY"},tooltipFormat:"MMM D, YYYY"},adapters:{date:{locale:"en"}},title:{display:!0,text:"Date"},grid:{display:!1}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Score (%)"},ticks:{callback:e=>e+"%"}}},plugins:{tooltip:{callbacks:{title:e=>pn()(e[0].parsed.x).format("MMMM D, YYYY"),label:e=>{const a=e.raw;return[`Performance Task #${a.number}`,`Score: ${a.rawScore}/${a.maxScore} (${a.y.toFixed(1)}%)`]}}}}}})}}}}};(0,l.hi)((()=>{const e=b.value?`performanceChart-${b.value.studentNumber}`:"";if(e){const a=[`all-${e}`,`quiz-${e}`,`activity-${e}`,`performance-${e}`];a.forEach((e=>{const a=document.getElementById(e);if(a){const e=oa.Ay.getChart(a);e&&e.destroy()}}))}})),(0,l.wB)(b,(()=>{if(b.value)(0,l.dY)((()=>{He()}));else{const e=`performanceChart-${b.value?.studentNumber}`;if(e){const a=[`all-${e}`,`quiz-${e}`,`activity-${e}`,`performance-${e}`];a.forEach((e=>{const a=document.getElementById(e);if(a){const e=oa.Ay.getChart(a);e&&e.destroy()}}))}}})),(0,l.wB)([E,j],(()=>{b.value&&(0,l.dY)((()=>{He()}))})),(0,l.wB)(p,(async()=>{await H(),b.value&&await J(b.value)}));const Oe=async()=>{try{console.log("Fetching user preferences...");const t=localStorage.getItem("classRecordPreferences");let s=null;if(t)try{s=JSON.parse(t),console.log("Found preferences in localStorage:",s),s.selectedYear&&(o.value=s.selectedYear),s.selectedSection&&(n.value=s.selectedSection),s.selectedSubject&&(c.value=s.selectedSubject),s.currentPage&&($e.value=parseInt(s.currentPage)||1)}catch(a){console.error("Error parsing localStorage preferences:",a),localStorage.removeItem("classRecordPreferences")}else console.log("No preferences found in localStorage");const l=e.state.auth.token,r=e.state.auth.user?._id;if(!r)return void console.error("User ID not available for fetching preferences");console.log("Fetching preferences from backend for user:",r);const i=await Gn.get("/users/preferences",{params:{userId:r},headers:{Authorization:`Bearer ${l}`}});if(console.log("Backend preferences response:",i.data),i.data&&i.data.preferences){const e=i.data.preferences;e.selectedYear&&(o.value=e.selectedYear),e.selectedSection&&(n.value=e.selectedSection),e.selectedSubject&&(c.value=e.selectedSubject),e.currentPage&&($e.value=parseInt(e.currentPage)||1),localStorage.setItem("classRecordPreferences",JSON.stringify(e)),console.log("Updated preferences from backend:",e)}else console.log("No preferences found in backend, using localStorage values"),s&&await Qe();console.log("Final preferences after fetching:",{year:o.value,section:n.value,subject:c.value,page:$e.value}),o.value&&(console.log("Fetching sections for year:",o.value),await ve(),n.value&&(console.log("Updating teacher subjects for section:",n.value),await Z(),c.value&&(console.log("Fetching class data for subject:",c.value),await B(),console.log("Applying saved page number:",$e.value))))}catch(t){console.error("Error fetching user preferences:",t),console.error("Error details:",{message:t.message,response:t.response?.data,status:t.response?.status});const e=localStorage.getItem("classRecordPreferences");if(e)try{const a=JSON.parse(e);console.log("Falling back to localStorage preferences:",a),o.value=a.selectedYear||"",n.value=a.selectedSection||"",c.value=a.selectedSubject||"",a.currentPage&&($e.value=parseInt(a.currentPage)||1),o.value&&(await ve(),n.value&&(await Z(),c.value&&await B()))}catch(a){console.error("Error parsing localStorage preferences during fallback:",a)}}},Qe=async()=>{try{const a=e.state.auth.token,t=e.state.auth.user?._id;if(!t)return void console.error("User ID not available for saving preferences");const s={selectedYear:o.value,selectedSection:n.value,selectedSubject:c.value,currentPage:$e.value};console.log("Saving preferences:",s),localStorage.setItem("classRecordPreferences",JSON.stringify(s));const l=await Gn.post("/users/preferences",{userId:t,preferences:s},{headers:{Authorization:`Bearer ${a}`}});console.log("User preferences saved successfully:",l.data)}catch(a){console.error("Error saving user preferences:",a),console.error("Error details:",{message:a.message,response:a.response?.data,status:a.response?.status});try{const e={selectedYear:o.value,selectedSection:n.value,selectedSubject:c.value,currentPage:$e.value};localStorage.setItem("classRecordPreferences",JSON.stringify(e)),console.log("Preferences saved to localStorage as fallback")}catch(t){console.error("Failed to save preferences to localStorage:",t)}}};(0,l.wB)([o,n,c],(async([e,a,t],[s,l,o])=>{await Qe(),e!==s&&(n.value="",c.value="",e&&await ve()),a!==l&&(c.value="",a&&await Z()),t!==o&&t&&await B()})),(0,l.wB)($e,(()=>{console.log("Current page changed to:",$e.value),Qe()})),(0,l.hi)((()=>{Qe(),xe&&clearInterval(xe)}));const Ve=async()=>{try{console.log("Attempting to load last used filters");const s=e.state.auth.token,l=e.state.auth.user?._id;if(!l)return console.error("User ID not available for loading last used filters"),!1;const r=localStorage.getItem("recentFilters");if(r)try{const e=JSON.parse(r);if(console.log("Found recent filters in localStorage:",e),e.length>0){const a=e[0];a.year&&(o.value=a.year),a.section&&(n.value=a.section),a.subject&&(c.value=a.subject);const t={selectedYear:o.value,selectedSection:n.value,selectedSubject:c.value,currentPage:$e.value};return localStorage.setItem("classRecordPreferences",JSON.stringify(t)),console.log("Recent filters applied from localStorage:",t),!0}}catch(a){console.error("Error parsing recent filters from localStorage:",a)}try{const e=await Gn.get("/users/teaching-assignments",{params:{userId:l},headers:{Authorization:`Bearer ${s}`}});if(e.data&&e.data.assignments&&e.data.assignments.length>0){const a=[...e.data.assignments].sort(((e,a)=>e.lastAccessed&&a.lastAccessed?new Date(a.lastAccessed)-new Date(e.lastAccessed):0)),t=a[0];console.log("Most recently used assignment from API:",t),t.year&&(o.value=t.year),t.section&&(n.value=t.section),t.subject&&(c.value=t.subject);const s={selectedYear:o.value,selectedSection:n.value,selectedSubject:c.value,currentPage:$e.value};return localStorage.setItem("classRecordPreferences",JSON.stringify(s)),console.log("Last used filters applied from API:",s),qe({year:o.value,section:n.value,subject:c.value,timestamp:(new Date).toISOString()}),!0}return console.log("No teaching assignments found in API"),!1}catch(t){return console.error("Error fetching teaching assignments from API:",t),!1}}catch(s){return console.error("Error loading last used filters:",s),!1}},qe=e=>{try{const t=localStorage.getItem("recentFilters");let s=[];if(t)try{s=JSON.parse(t)}catch(a){console.error("Error parsing recent filters, resetting:",a)}const l=s.findIndex((a=>a.year===e.year&&a.section===e.section&&a.subject===e.subject));-1!==l&&s.splice(l,1),s.unshift(e),s.length>5&&(s=s.slice(0,5)),localStorage.setItem("recentFilters",JSON.stringify(s)),console.log("Updated recent filters:",s)}catch(t){console.error("Error saving to recent filters:",t)}},Je=e=>{if(!b.value)return;console.log("Updating assessment history table with date range:",j.value),e||(e={Quiz:[],Activity:[],"Performance Task":[]},b.value.assessments&&b.value.assessments.length>0&&b.value.assessments.forEach((a=>{const t=b.value.studentNumber;let s=null;if(a.scores&&(a.scores instanceof Map?s=a.scores.get(t):"object"===typeof a.scores&&(s=a.scores[t])),null!==s&&void 0!==s||!b.value.scores||!(a._id in b.value.scores)&&!(a.id in b.value.scores)||(s=b.value.scores[a._id]||b.value.scores[a.id]),null!==s&&void 0!==s){const t=a.maxScore||100,l=s/t*100,o=new Date(a.date),n=j.value.start?new Date(j.value.start):null,r=j.value.end?new Date(j.value.end):null;if(n&&o<n||r&&o>r)return;const c=a.type||"Quiz";e[c].push({...a,date:a.date,rawScore:s,score:l,maxScore:t,number:a.number,title:`${a.type} #${a.number}`})}})));const a=[...e["Quiz"]||[],...e["Activity"]||[],...e["Performance Task"]||[]],t=a.filter((e=>{const a=new Date(e.date),t=j.value.start?new Date(j.value.start):null,s=j.value.end?new Date(j.value.end):null;return(!t||a>=t)&&(!s||a<=s)}));t.sort(((e,a)=>new Date(a.date)-new Date(e.date))),b.value.assessmentHistory=t.map((e=>({date:e.date,type:e.title||`${e.type} #${e.number}`,score:e.rawScore,maxScore:e.maxScore,percentage:e.score}))),console.log(`Updated assessment history with ${b.value.assessmentHistory.length} records`)},Ge=(e,a)=>{const t=a._id||a.id;if(e.scores&&t in e.scores)return e.scores[t];if(a.scores){let s;if(a.scores instanceof Map?s=a.scores.get(e.studentNumber):"object"===typeof a.scores&&(s=a.scores[e.studentNumber]),void 0!==s)return e.scores||(e.scores={}),e.scores[t]=s,s}return""};return{selectedYear:o,selectedSection:n,selectedSubject:c,searchQuery:i,students:d,assessments:u,filteredAssessmentsByDate:O,currentDate:p,showAddAssessmentModal:m,newAssessment:I,selectedStudent:b,quizChart:f,activityChart:h,performanceChart:g,handleAddAssessment:U,updateScore:Q,viewStudentDetails:J,formatDate:G,formatDateForDisplay:Se,navigateDate:Le,user:t,showAddStudentRecordModal:k,newStudentRecord:w,canAddStudentRecord:X,handleAddStudentRecord:ee,clearFilters:ae,sortField:L,sortOrder:S,sortBy:M,getSortIcon:_,sortedStudents:R,showSearch:y,toggleSearch:$,handleSearch:K,applyFilters:z,getAssessmentBadgeClass:te,getScoreClass:se,updateCharts:oe,showEditAssessmentModal:ne,editingAssessment:re,editAssessment:ce,handleEditAssessment:ie,handleDeleteAssessment:de,selectedAssessmentType:C,showChartDateFilter:A,showHistoryDateFilter:D,chartDateRange:E,historyDateRange:j,filteredAssessments:be,applyChartDateFilter:fe,clearChartDateFilter:he,applyHistoryDateFilter:ge,clearHistoryDateFilter:ke,handleLogout:ye,availableYears:Y,availableSections:F,teacherSubjects:T,openChartDateFilter:we,openHistoryDateFilter:Ce,slideDirection:Ae,isNextDayDisabled:De,openAddStudentRecordModal:Ye,filteredSections:Fe,canSelectSection:pe,canSelectSubject:me,attendanceRecords:Ne,attendanceStatistics:Pe,fetchAttendance:Re,syncStudentRecords:Me,redirectToAttendance:_e,currentPage:$e,totalPages:ze,paginatedStudents:We,paginationInfo:Xe,nextPage:Be,previousPage:Ue,createPerformanceChart:He,loadLastUsedFilters:Ve,saveToRecentFilters:qe,getStudentScore:Ge}}};const er=(0,i.A)(Zn,[["render",un],["__scopeId","data-v-6492c41c"]]);var ar=er;const tr={class:"attendance-view"},sr={class:"d-flex justify-content-between align-items-center mb-4"},lr={class:"d-flex gap-2"},or={class:"d-flex align-items-center gap-3"},nr=["disabled"],rr={class:"card"},cr={class:"card-body"},ir={class:"table-controls mb-4",style:{"z-index":"10000 !important",position:"relative"}},dr={class:"d-flex gap-3 align-items-center"},ur={class:"d-flex gap-3",style:{"z-index":"10000 !important",position:"relative"}},vr={class:"dropdown",style:{"z-index":"10000 !important",position:"relative"}},pr={class:"dropdown-menu control-menu",style:{"z-index":"10000 !important",position:"absolute !important"}},mr={class:"dropdown",style:{"z-index":"10000 !important",position:"relative"}},br={class:"btn btn-control",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},fr={key:0,class:"filter-badge"},hr={class:"dropdown-menu control-menu p-3",style:{width:"280px","z-index":"10000 !important",position:"absolute !important"}},gr={class:"mb-3"},kr=["value"],yr={class:"mb-3"},Lr=["disabled"],Sr=["value"],wr={class:"mb-3"},Cr=["disabled"],Ar=["value"],Dr={class:"d-flex justify-content-end gap-2 mt-3"},Er={class:"search-control",style:{flex:"1","max-width":"400px","z-index":"10000 !important",position:"relative"}},jr={class:"input-group"},Ir={class:"table-responsive"},Yr={class:"table table-hover"},Fr=["onClick"],xr={class:"attendance-status-container"},Tr=["onUpdate:modelValue","onChange"],Nr={key:0},Pr={colspan:"4",class:"text-center py-4"},Rr={class:"empty-state-message"},Mr={key:0,class:"text-muted small"},_r={class:"pagination-controls mt-3 d-flex justify-content-between align-items-center"},$r={class:"pagination-info"},Kr={class:"pagination-buttons"},zr=["disabled"],Wr=["disabled"],Xr={class:"calendar-container"},Br={class:"calendar-header"},Ur={class:"calendar-body"},Hr={class:"input-group"},Or=["value","max"],Qr={class:"quick-date-buttons mt-3"},Vr={class:"table"},qr={key:0};function Jr(e,a,t,o,n,r){const c=(0,l.g2)("StudentDetailsModal");return(0,l.uX)(),(0,l.CE)("div",tr,[(0,l.Lk)("div",sr,[(0,l.Lk)("div",lr,[(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:a[0]||(a[0]=(...e)=>o.refreshAttendance&&o.refreshAttendance(...e)),title:"Refresh attendance data from database"},a[28]||(a[28]=[(0,l.Lk)("i",{class:"fas fa-sync-alt me-2"},null,-1),(0,l.eW)(" Refresh Attendance ")]))]),(0,l.Lk)("div",or,[(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[1]||(a[1]=e=>o.navigateDate(-1))},a[29]||(a[29]=[(0,l.Lk)("i",{class:"fas fa-chevron-left"},null,-1)])),(0,l.Lk)("div",{class:"date-display",onClick:a[2]||(a[2]=(...e)=>o.openCalendarPopup&&o.openCalendarPopup(...e)),role:"button"},(0,y.v_)(o.formatDate(o.currentDate)),1),(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[3]||(a[3]=e=>o.navigateDate(1)),disabled:o.isNextDayDisabled},a[30]||(a[30]=[(0,l.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,nr)])]),(0,l.Lk)("div",rr,[(0,l.Lk)("div",cr,[(0,l.Lk)("div",ir,[(0,l.Lk)("div",dr,[(0,l.Lk)("div",ur,[(0,l.Lk)("div",vr,[a[35]||(a[35]=(0,l.Lk)("button",{class:"btn btn-control",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,l.Lk)("i",{class:"fas fa-sort me-2"}),(0,l.eW)(" Sort by ")],-1)),(0,l.Lk)("ul",pr,[(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center",href:"#",onClick:a[4]||(a[4]=e=>o.sortBy("studentNumber"))},[a[31]||(a[31]=(0,l.Lk)("i",{class:"fas fa-sort-numeric-down me-2"},null,-1)),a[32]||(a[32]=(0,l.eW)(" Student Number ")),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("studentNumber"),"ms-auto"])},null,2)])]),(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center",href:"#",onClick:a[5]||(a[5]=e=>o.sortBy("lastName"))},[a[33]||(a[33]=(0,l.Lk)("i",{class:"fas fa-sort-alpha-down me-2"},null,-1)),a[34]||(a[34]=(0,l.eW)(" Name ")),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("lastName"),"ms-auto"])},null,2)])])])]),(0,l.Lk)("div",mr,[(0,l.Lk)("button",br,[a[36]||(a[36]=(0,l.Lk)("i",{class:"fas fa-filter me-2"},null,-1)),a[37]||(a[37]=(0,l.eW)(" Filter ")),o.selectedYear||o.selectedSection||o.selectedSubject?((0,l.uX)(),(0,l.CE)("span",fr,"!")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",hr,[a[44]||(a[44]=(0,l.Lk)("h6",{class:"dropdown-header mb-2"},"Filter Options",-1)),(0,l.Lk)("div",gr,[a[39]||(a[39]=(0,l.Lk)("label",{class:"form-label"},"Year Level",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[6]||(a[6]=e=>o.selectedYear=e),onChange:a[7]||(a[7]=(...e)=>o.applyFilters&&o.applyFilters(...e))},[a[38]||(a[38]=(0,l.Lk)("option",{value:""},"Select Year",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,kr)))),128))],544),[[s.u1,o.selectedYear]])]),(0,l.Lk)("div",yr,[a[41]||(a[41]=(0,l.Lk)("label",{class:"form-label"},"Section",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[8]||(a[8]=e=>o.selectedSection=e),disabled:!o.selectedYear,onChange:a[9]||(a[9]=(...e)=>o.applyFilters&&o.applyFilters(...e))},[a[40]||(a[40]=(0,l.Lk)("option",{value:""},"Select Section",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.filteredSections,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Sr)))),128))],40,Lr),[[s.u1,o.selectedSection]])]),(0,l.Lk)("div",wr,[a[43]||(a[43]=(0,l.Lk)("label",{class:"form-label"},"Subject",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[10]||(a[10]=e=>o.selectedSubject=e),disabled:!o.selectedSection,onChange:a[11]||(a[11]=(...e)=>o.applyFilters&&o.applyFilters(...e))},[a[42]||(a[42]=(0,l.Lk)("option",{value:""},"Select Subject",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.teacherSubjects,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,y.v_)(e),9,Ar)))),128))],40,Cr),[[s.u1,o.selectedSubject]])]),(0,l.Lk)("div",Dr,[(0,l.Lk)("button",{class:"btn btn-sm btn-light",onClick:a[12]||(a[12]=(...e)=>o.clearFilters&&o.clearFilters(...e))}," Clear All "),(0,l.Lk)("button",{class:"btn btn-sm btn-primary",onClick:a[13]||(a[13]=(...e)=>o.applyFilters&&o.applyFilters(...e))}," Apply Filters ")])])])]),(0,l.Lk)("div",Er,[(0,l.Lk)("div",jr,[a[46]||(a[46]=(0,l.Lk)("span",{class:"input-group-text border-end-0"},[(0,l.Lk)("i",{class:"fas fa-search"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control border-start-0","onUpdate:modelValue":a[14]||(a[14]=e=>o.searchQuery=e),placeholder:"Search students...",onInput:a[15]||(a[15]=(...e)=>o.handleSearch&&o.handleSearch(...e))},null,544),[[s.Jo,o.searchQuery]]),o.searchQuery?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-outline-secondary border-start-0",type:"button",onClick:a[16]||(a[16]=(...e)=>o.clearSearch&&o.clearSearch(...e))},a[45]||(a[45]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))):(0,l.Q3)("",!0)])])])]),(0,l.Lk)("div",Ir,[(0,l.Lk)("table",Yr,[a[50]||(a[50]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Student Number"),(0,l.Lk)("th",null,"Last Name"),(0,l.Lk)("th",null,"First Name"),(0,l.Lk)("th",null,"Status")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.paginatedStudents,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.studentNumber,class:(0,y.C4)(["clickable-row",{"status-row-present":"present"===e.currentStatus,"status-row-absent":"absent"===e.currentStatus,"status-row-late":"late"===e.currentStatus}]),onClick:a=>o.viewStudentDetails(e)},[(0,l.Lk)("td",null,(0,y.v_)(e.studentNumber),1),(0,l.Lk)("td",null,(0,y.v_)(e.lastName),1),(0,l.Lk)("td",null,(0,y.v_)(e.firstName),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",xr,[(0,l.bo)((0,l.Lk)("select",{class:(0,y.C4)(["form-select form-select-sm attendance-select",{"select-present":"present"===e.currentStatus,"select-absent":"absent"===e.currentStatus,"select-late":"late"===e.currentStatus,"select-none":"none"===e.currentStatus}]),"onUpdate:modelValue":a=>e.currentStatus=a,onChange:a=>o.markAttendance(e,a.target.value),onClick:a[17]||(a[17]=(0,s.D$)((()=>{}),["stop"]))},a[47]||(a[47]=[(0,l.Lk)("option",{value:"none"},"Not marked",-1),(0,l.Lk)("option",{value:"present"},"Present",-1),(0,l.Lk)("option",{value:"absent"},"Absent",-1),(0,l.Lk)("option",{value:"late"},"Late",-1)]),42,Tr),[[s.u1,e.currentStatus]]),(0,l.Lk)("div",{class:(0,y.C4)(["status-indicator",{"indicator-present":"present"===e.currentStatus,"indicator-absent":"absent"===e.currentStatus,"indicator-late":"late"===e.currentStatus,"indicator-none":"none"===e.currentStatus}])},[(0,l.Lk)("i",{class:(0,y.C4)(["fas",{"fa-check-circle":"present"===e.currentStatus,"fa-times-circle":"absent"===e.currentStatus,"fa-exclamation-circle":"late"===e.currentStatus,"fa-question-circle":"none"===e.currentStatus}])},null,2)],2)])])],10,Fr)))),128)),0===o.paginatedStudents.length?((0,l.uX)(),(0,l.CE)("tr",Nr,[(0,l.Lk)("td",Pr,[(0,l.Lk)("div",Rr,[a[48]||(a[48]=(0,l.Lk)("i",{class:"fas fa-users text-muted mb-2"},null,-1)),a[49]||(a[49]=(0,l.Lk)("p",{class:"mb-0"},"No students found",-1)),o.selectedYear||o.selectedSection||o.selectedSubject?((0,l.uX)(),(0,l.CE)("p",Mr," Try adjusting your filters ")):(0,l.Q3)("",!0)])])])):(0,l.Q3)("",!0)])])]),(0,l.Lk)("div",_r,[(0,l.Lk)("div",$r," Showing "+(0,y.v_)(o.paginationInfo.start)+" to "+(0,y.v_)(o.paginationInfo.end)+" of "+(0,y.v_)(o.sortedStudents.length)+" entries ",1),(0,l.Lk)("div",Kr,[(0,l.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:a[18]||(a[18]=(...e)=>o.previousPage&&o.previousPage(...e)),disabled:1===o.currentPage},a[51]||(a[51]=[(0,l.Lk)("i",{class:"fas fa-chevron-left me-1"},null,-1),(0,l.eW)(" Previous ")]),8,zr),(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[19]||(a[19]=(...e)=>o.nextPage&&o.nextPage(...e)),disabled:o.currentPage>=o.totalPages},a[52]||(a[52]=[(0,l.eW)(" Next "),(0,l.Lk)("i",{class:"fas fa-chevron-right ms-1"},null,-1)]),8,Wr)])])])]),o.showCalendarPopup?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"calendar-popup",onClick:a[25]||(a[25]=(0,s.D$)((e=>o.showCalendarPopup=!1),["self"]))},[(0,l.Lk)("div",Xr,[(0,l.Lk)("div",Br,[a[53]||(a[53]=(0,l.Lk)("h6",{class:"mb-0"},"Select Date",-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:a[20]||(a[20]=e=>o.showCalendarPopup=!1)})]),(0,l.Lk)("div",Ur,[(0,l.Lk)("div",Hr,[a[54]||(a[54]=(0,l.Lk)("span",{class:"input-group-text"},[(0,l.Lk)("i",{class:"fas fa-calendar-day"})],-1)),(0,l.Lk)("input",{type:"date",class:"form-control",value:o.formatDateForInput(o.currentDate),max:o.formatDateForInput(new Date),onChange:a[21]||(a[21]=e=>{o.setCurrentDate(e.target.value),o.showCalendarPopup=!1})},null,40,Or)]),(0,l.Lk)("div",Qr,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:a[22]||(a[22]=e=>{o.navigateDate(-7),o.showCalendarPopup=!1})},a[55]||(a[55]=[(0,l.Lk)("i",{class:"fas fa-angle-double-left me-1"},null,-1),(0,l.eW)(" Last Week ")])),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:a[23]||(a[23]=e=>{o.navigateDate(-1),o.showCalendarPopup=!1})},a[56]||(a[56]=[(0,l.Lk)("i",{class:"fas fa-angle-left me-1"},null,-1),(0,l.eW)(" Yesterday ")])),(0,l.Lk)("button",{class:"btn btn-sm btn-primary",onClick:a[24]||(a[24]=e=>{o.setCurrentDate(o.formatDateForInput(new Date)),o.showCalendarPopup=!1})}," Today ")])])])])):(0,l.Q3)("",!0),(0,l.bF)(c,{show:!!o.selectedStudent,student:o.selectedStudent||{},"year-level":o.selectedYear,section:o.selectedSection,subject:o.selectedSubject,title:"Student Attendance Details","chart-title":"Attendance Overview","history-title":"Attendance History","chart-id":`attendanceChart-${o.selectedStudent?.studentId}`,"is-class-record":!1,"onUpdate:show":a[26]||(a[26]=e=>!e&&(o.selectedStudent=null)),onClose:a[27]||(a[27]=e=>o.selectedStudent=null)},{"history-table":(0,l.k6)((()=>[(0,l.Lk)("table",Vr,[a[58]||(a[58]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Date"),(0,l.Lk)("th",null,"Status")])],-1)),(0,l.Lk)("tbody",null,[o.selectedStudent?.attendanceHistory&&0!==o.selectedStudent.attendanceHistory.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",qr,a[57]||(a[57]=[(0,l.Lk)("td",{colspan:"2",class:"text-center py-3 text-muted"},[(0,l.Lk)("i",{class:"fas fa-info-circle me-2"}),(0,l.eW)("No attendance records found. ")],-1)]))),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.selectedStudent?.attendanceHistory,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.date},[(0,l.Lk)("td",null,(0,y.v_)(o.formatDate(e.date)),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,y.C4)(["badge",{"bg-success":"present"===e.status,"bg-danger":"absent"===e.status,"bg-warning":"late"===e.status}])},(0,y.v_)(e.status.charAt(0).toUpperCase()+e.status.slice(1)),3)])])))),128))])])])),_:1},8,["show","student","year-level","section","subject","chart-id"])])}const Gr=p.A.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"}});var Zr={name:"Attendance",components:{StudentDetailsModal:Jn},setup(){const e=(0,v.Pj)(),a=(0,r.lq)(),t=(0,r.rd)(),s=(0,W.KR)([]),o=(0,W.KR)(""),n=(0,W.KR)("lastName"),c=(0,W.KR)("asc"),i=(0,W.KR)(null),d=(0,W.KR)(pn()().tz("Asia/Manila").startOf("day").toDate()),u=(0,W.KR)("");let p=null,m=null;const b=(0,W.KR)(pn()().tz("Asia/Manila").subtract(30,"days").format("YYYY-MM-DD")),f=(0,W.KR)(pn()().tz("Asia/Manila").format("YYYY-MM-DD")),h=(0,W.KR)(!1),g=(0,W.KR)(!1),k=(0,W.KR)(a.query.year||localStorage.getItem("selectedYear")||""),y=(0,W.KR)(a.query.section||localStorage.getItem("selectedSection")||""),L=(0,W.KR)(a.query.subject||localStorage.getItem("selectedSubject")||""),S=(0,W.KR)([]),w=(0,W.KR)([]),C=(0,W.KR)({}),A=(0,W.KR)([]),D=(0,l.EW)((()=>k.value&&C.value[k.value]||[])),E=async()=>{try{const a=e.state.auth.token,t=e.state.auth.user?._id;if(!t)return void console.error("Teacher ID not available");console.log("Fetching available years and sections for teacher:",t);const s=await Gr.get("/teacher-class-records/available-years-sections",{params:{teacherId:t},headers:{Authorization:`Bearer ${a}`}}).catch((e=>(console.error("Error fetching teacher-specific years and sections:",e),Gr.get("/students/available-years-sections",{headers:{Authorization:`Bearer ${a}`}}))));console.log("API Response for years and sections:",s.data),s.data&&(S.value=s.data.years||[],w.value=s.data.sections||[],s.data.sectionsByYear?C.value=s.data.sectionsByYear:(C.value={},S.value.length>0&&w.value.length>0&&S.value.forEach((e=>{C.value[e]=[...w.value]}))),console.log("Available years:",S.value),console.log("Available sections:",w.value),console.log("Sections by year mapping:",C.value),0===S.value.length&&console.log("No years found for this teacher"),0===w.value.length&&console.log("No sections found for this teacher"))}catch(a){console.error("Failed to fetch available years and sections:",a),S.value=[],w.value=[],C.value={}}},j=async()=>{try{const s=e.state.auth.token,l=e.state.auth.user?._id;if(!l)return void console.error("Teacher ID not available");try{const e=await Gr.get("/teacher-class-records/available-years-sections",{params:{teacherId:l},headers:{Authorization:`Bearer ${s}`}});if(e.data&&e.data.subjects&&e.data.subjects.length>0)A.value=e.data.subjects,console.log("Subjects loaded from teacher class records:",A.value);else{const e=await Gr.get(`/users/${l}/subjects`,{headers:{Authorization:`Bearer ${s}`}});e.data&&e.data.subjects&&e.data.subjects.length>0?(A.value=e.data.subjects,console.log("Subjects loaded from user profile:",A.value)):console.log("No subjects found, using default subjects")}}catch(a){console.error("Failed to fetch teacher subjects from class records:",a);try{const e=await Gr.get(`/users/${l}/subjects`,{headers:{Authorization:`Bearer ${s}`}});e.data&&e.data.subjects&&e.data.subjects.length>0?(A.value=e.data.subjects,console.log("Subjects loaded from user profile (fallback):",A.value)):(A.value=["Math","Science","English","History"],console.log("No subjects found in user profile, using default subjects"))}catch(t){console.error("Failed to fetch teacher subjects from user profile:",t),A.value=["Math","Science","English","History"],console.log("Using default subjects due to API errors")}}}catch(a){console.error("Error in fetchTeacherSubjects:",a),A.value=["Math","Science","English","History"]}},I=async()=>{console.log("Applying filters:",{year:k.value,section:y.value,subject:L.value}),k.value&&localStorage.setItem("selectedYear",k.value),y.value&&localStorage.setItem("selectedSection",y.value),L.value&&localStorage.setItem("selectedSubject",L.value),t.replace({query:{...a.query,year:k.value||void 0,section:y.value||void 0,subject:L.value||void 0}}),await F()},Y=()=>{k.value="",y.value="",L.value="",localStorage.removeItem("selectedYear"),localStorage.removeItem("selectedSection"),localStorage.removeItem("selectedSubject"),t.replace({query:{}})},F=async()=>{try{const t=e.state.auth.token,l=e.state.auth.user?._id;if(!l)return void console.error("Teacher ID not available");const o={teacherId:l};k.value&&(o.year=k.value),y.value&&(o.section=y.value),L.value&&(o.subject=L.value),console.log("Fetching student records with filters:",o);try{const e=await Gr.get("/teacher-class-records/students-for-attendance",{params:o,headers:{Authorization:`Bearer ${t}`}});if(console.log("Students API response:",e.data),e.data){let a=[];Array.isArray(e.data)?a=e.data:e.data.students&&Array.isArray(e.data.students)&&(a=e.data.students),a.forEach((e=>{console.log("Student data:",{studentId:e._id||e.studentId,studentNumber:e.studentNumber,name:`${e.firstName} ${e.lastName}`})})),s.value=a.map((e=>({...e,studentId:e._id||e.studentId,currentStatus:"none"}))),console.log(`Loaded ${s.value.length} students with IDs`),s.value.length>0&&await x()}}catch(a){console.error("Failed to fetch student records:",a),s.value=[]}}catch(a){console.error("Error in fetchStudentRecords:",a),s.value=[]}},x=async()=>{try{if(!s.value.length)return void console.log("fetchAttendance: No students to fetch attendance for");const a=pn()(d.value).tz("Asia/Manila").startOf("day").format("YYYY-MM-DD");console.log("fetchAttendance: Fetching attendance data for date:",a);const t={teacherId:e.state.auth.user?._id,date:a};k.value&&(t.year=k.value),y.value&&(t.section=y.value),L.value&&(t.subject=L.value),console.log("Fetching attendance with params:",t);const o=await Gr.get(`/attendance/date/${a}`,{params:t,headers:{Authorization:`Bearer ${e.state.auth.token}`}});console.log("Attendance data received:",o.data);const n=new Map;if(o.data&&Array.isArray(o.data)){console.log(`Processing ${o.data.length} attendance records`);const e={};o.data.forEach((a=>{a.studentId?(!e[a.studentId]||a.createdAt&&(!e[a.studentId].createdAt||new Date(a.createdAt)>new Date(e[a.studentId].createdAt)))&&(e[a.studentId]=a,console.log(`Found newer record for student ${a.studentId}: ${a.status} (created at ${a.createdAt})`)):console.log("Record missing studentId:",a)})),Object.values(e).forEach((e=>{n.set(String(e.studentId),e.status||"none"),console.log(`Using most recent attendance for student ID ${e.studentId}: ${e.status||"none"} (created at ${e.createdAt})`)}))}s.value&&s.value.length>0&&(s.value=s.value.map((e=>{const t=String(e.studentId),s=n.get(t);e.attendanceByDate||(e.attendanceByDate={}),s&&(e.attendanceByDate[a]=s);const l=e.attendanceByDate[a]||s||e.currentStatus||"none";return console.log(`Setting status for student ${t}: ${l}`),{...e,currentStatus:l}})),await(0,l.dY)(),s.value=[...s.value],console.log("Updated attendance status for all students"))}catch(a){console.error("Error in fetchAttendance:",a)}},T=()=>{if(!i.value)return;const e=`attendanceChart-${i.value.studentId}`,a=document.getElementById("attendanceChart");a&&(a.id=e);const t=document.getElementById(e)?.getContext("2d");if(!t)return;p&&(p.destroy(),p=null);const s=document.querySelector(".chart-container");if(!s)return;const l=i.value.attendanceStats,o=i.value.attendanceHistory&&i.value.attendanceHistory.length>0;if(!o||!l||0===l.presentPercentage&&0===l.absentPercentage&&0===l.latePercentage){s.innerHTML="";const e=document.createElement("div");return e.className="text-center py-5 text-muted",e.innerHTML='<i class="fas fa-info-circle me-2"></i>No attendance data available for this student in the selected date range.',void s.appendChild(e)}s.innerHTML="";const n=document.createElement("canvas");n.id=e,s.appendChild(n);const r=document.getElementById(e)?.getContext("2d");if(!r)return;const c={present:{backgroundColor:"#4CAF50",hoverBackgroundColor:"#388E3C",borderColor:"#fff",borderWidth:2},absent:{backgroundColor:"#F44336",hoverBackgroundColor:"#D32F2F",borderColor:"#fff",borderWidth:2},late:{backgroundColor:"#FFC107",hoverBackgroundColor:"#FFA000",borderColor:"#fff",borderWidth:2}};p=new oa.Ay(r,{type:"doughnut",data:{labels:["Present","Absent","Late"],datasets:[{data:[l.presentPercentage,l.absentPercentage,l.latePercentage],backgroundColor:[c.present.backgroundColor,c.absent.backgroundColor,c.late.backgroundColor],hoverBackgroundColor:[c.present.hoverBackgroundColor,c.absent.hoverBackgroundColor,c.late.hoverBackgroundColor],borderColor:[c.present.borderColor,c.absent.borderColor,c.late.borderColor],borderWidth:2,borderRadius:5,spacing:5,hoverOffset:10}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"70%",animation:{animateScale:!0,animateRotate:!0,duration:1e3,easing:"easeOutQuart"},plugins:{legend:{position:"bottom",labels:{padding:20,boxWidth:15,boxHeight:15,font:{size:14,weight:"bold"},generateLabels:e=>{const a=e.data;return a.labels.length&&a.datasets.length?a.labels.map(((t,s)=>{const l=e.getDatasetMeta(0),o=l.controller.getStyle(s);return{text:`${t}: ${a.datasets[0].data[s].toFixed(1)}%`,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,lineWidth:o.borderWidth,hidden:isNaN(a.datasets[0].data[s])||l.data[s].hidden,index:s}})):[]}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:16,weight:"bold"},bodyFont:{size:14},padding:15,cornerRadius:8,displayColors:!0,callbacks:{label:function(e){const a=e.label||"",t=e.raw||0;return`${a}: ${t.toFixed(1)}%`}}}}}})},N=async e=>{try{p&&(p.destroy(),p=null),i.value={...e,attendanceHistory:[],attendanceStats:{presentPercentage:0,absentPercentage:0,latePercentage:0}},await P(i.value)}catch(a){console.error("Error fetching student details:",a),alert("Failed to load student details. Please try again.")}},P=async a=>{if(a)try{console.log(`Fetching attendance history for student ${a.studentNumber} with date range:`,{startDate:b.value,endDate:f.value});const t=await Gr.get(`/attendance/${a.studentId}/history`,{params:{subject:L.value,startDate:b.value,endDate:f.value},headers:{Authorization:`Bearer ${e.state.auth.token}`}});if(t.data)if(i.value&&i.value.studentId===a.studentId){const e=Array.isArray(t.data.records)?t.data.records.filter((e=>e&&e.status&&""!==e.status)):[];if(i.value.attendanceHistory=e,e.length>0){const a={present:0,absent:0,late:0};e.forEach((e=>{e.status in a&&a[e.status]++}));const t=e.length,s=t>0?a.present/t*100:0,l=t>0?a.absent/t*100:0,o=t>0?a.late/t*100:0;i.value.attendanceStats={presentPercentage:s,absentPercentage:l,latePercentage:o}}else i.value.attendanceStats={presentPercentage:0,absentPercentage:0,latePercentage:0};console.log(`Loaded ${i.value.attendanceHistory.length} attendance records for student ${a.studentNumber}`),(0,l.dY)((()=>{p&&(p.destroy(),p=null),T()}))}else console.log("Selected student changed, not updating attendance history")}catch(t){console.error("Error fetching student attendance history:",t),i.value.attendanceHistory=[],i.value.attendanceStats={presentPercentage:0,absentPercentage:0,latePercentage:0},(0,l.dY)((()=>{p&&(p.destroy(),p=null),T()}))}},R=e=>{n.value===e?c.value="asc"===c.value?"desc":"asc":(n.value=e,c.value="asc")},M=e=>n.value!==e?"fas fa-sort":"asc"===c.value?"fas fa-sort-up":"fas fa-sort-down",_=(0,l.EW)((()=>{if(!Array.isArray(s.value))return[];let e=[...s.value];if(n.value&&e.sort(((e,a)=>{let t=e[n.value],s=a[n.value];return"string"===typeof t&&(t=t.toLowerCase()),"string"===typeof s&&(s=s.toLowerCase()),t<s?"asc"===c.value?-1:1:t>s?"asc"===c.value?1:-1:0})),!o.value)return e;const a=o.value.toLowerCase();return e.filter((e=>e.studentNumber.toLowerCase().includes(a)||e.firstName.toLowerCase().includes(a)||e.lastName.toLowerCase().includes(a)))})),$=async(a,t)=>{try{if(!t||!a)return void console.log("Invalid status or student:",{status:t,student:a});const s=pn()(d.value).tz("Asia/Manila").startOf("day").format("YYYY-MM-DD");console.log("Marking attendance:",{studentId:a.studentId,studentNumber:a.studentNumber,status:t,date:s});const l={studentId:a.studentId,studentNumber:a.studentNumber,teacherId:e.state.auth.user._id,date:s,subject:L.value,section:y.value,year:k.value,status:t,createdAt:(new Date).toISOString()};a.currentStatus=t;const o=await Gr.post("/attendance",l,{headers:{Authorization:`Bearer ${e.state.auth.token}`}});o.data&&(console.log("Attendance marked successfully:",o.data),a.attendanceByDate||(a.attendanceByDate={}),a.attendanceByDate[s]=t,i.value&&i.value.studentId===a.studentId&&await P(i.value))}catch(s){console.error("Error marking attendance:",s),a.currentStatus="none",alert("Failed to save attendance. Please try again.")}},K=()=>{};(0,l.wB)([k,y,L],(async()=>{if(k.value&&localStorage.setItem("selectedYear",k.value),y.value&&localStorage.setItem("selectedSection",y.value),L.value&&localStorage.setItem("selectedSubject",L.value),k.value&&y.value&&L.value&&await F(),k.value&&y.value&&L.value)try{t.currentRoute.value.matched[0].components.default.props&&(t.currentRoute.value.matched[0].components.default.props.selectedInfo=`${k.value} - ${y.value} | ${L.value}`)}catch(e){console.error("Error updating navigation title:",e)}})),(0,l.wB)(d,(async(e,a)=>{console.log("Current date changed from",pn()(a).format("YYYY-MM-DD"),"to",pn()(e).format("YYYY-MM-DD")),k.value&&y.value&&L.value&&s.value.length>0?(console.log("Fetching attendance data for new date"),await x()):console.log("Skipping attendance fetch due to missing data:",{year:k.value,section:y.value,subject:L.value,studentsCount:s.value?.length||0})})),(0,l.hi)((()=>{p&&(p.destroy(),p=null),m&&clearInterval(m)})),(0,l.wB)((()=>i.value),((e,a)=>{if(!e&&p&&(p.destroy(),p=null,a)){const e=document.getElementById(`attendanceChart-${a.studentId}`);e&&(e.id="attendanceChart")}}));const z=e=>e?pn()(e).tz("Asia/Manila").format("MMMM D, YYYY"):"N/A",X=e=>e?pn()(e).tz("Asia/Manila").format("YYYY-MM-DD"):"",B=(0,l.EW)((()=>{const e=pn()().tz("Asia/Manila").startOf("day"),a=pn()(d.value).tz("Asia/Manila").startOf("day");return a.isSameOrAfter(e,"day")})),U=e=>{const a=pn()().tz("Asia/Manila").startOf("day"),t=pn()(d.value).tz("Asia/Manila").startOf("day").add(e,"days");(e<0||e>0&&!t.isAfter(a,"day"))&&(u.value=e>0?"slide-left":"slide-right",d.value=t.toDate(),x(),setTimeout((()=>{u.value=""}),300))},H=()=>{const e=()=>{const e=pn()().tz("Asia/Manila").startOf("day"),a=pn()(d.value).tz("Asia/Manila").startOf("day");e.isAfter(a,"day")&&(d.value=e.toDate(),x())};m&&clearInterval(m),m=setInterval(e,6e4)};(0,l.wB)(k,(e=>{e&&(y.value="",L.value="")})),(0,l.wB)(y,(e=>{e&&(L.value="")}));const O=e=>e.currentStatus&&"none"!==e.currentStatus?e.currentStatus:"none",Q=e=>{if(!e)return;const a=pn()(e).tz("Asia/Manila").startOf("day"),t=pn()().tz("Asia/Manila").startOf("day");if(a.isAfter(t,"day"))return;const s=pn()(d.value).tz("Asia/Manila").startOf("day");u.value=a.isAfter(s)?"slide-left":"slide-right",d.value=a.toDate(),x(),setTimeout((()=>{u.value=""}),300)},V=()=>{b.value=pn()().tz("Asia/Manila").subtract(30,"days").format("YYYY-MM-DD"),f.value=pn()().tz("Asia/Manila").format("YYYY-MM-DD"),i.value&&P(i.value)},q=e=>{const a=pn()().tz("Asia/Manila");switch(e){case"week":b.value=a.clone().subtract(7,"days").format("YYYY-MM-DD");break;case"month":b.value=a.clone().subtract(30,"days").format("YYYY-MM-DD");break;case"quarter":b.value=a.clone().subtract(90,"days").format("YYYY-MM-DD");break;case"semester":b.value=a.clone().subtract(180,"days").format("YYYY-MM-DD");break;default:b.value=a.clone().subtract(30,"days").format("YYYY-MM-DD")}f.value=a.format("YYYY-MM-DD"),i.value&&P(i.value)};(0,l.sV)((async()=>{if(e.getters.isLoggedIn)try{console.log("Component mounted, initializing..."),await Promise.all([E(),j()]),console.log("Initialization complete, checking for saved filters:",{year:k.value,section:y.value,subject:L.value}),k.value&&y.value&&L.value?(console.log("Saved filters found, fetching student records..."),await F(),console.log("Student records loaded")):console.log("No saved filters found, skipping data fetch"),H()}catch(a){console.error("Error during component initialization:",a)}else t.push("/login")}));const J=async()=>{console.log("Manually refreshing attendance data");const e=document.querySelector(".btn-outline-secondary i.fa-sync-alt");e&&e.classList.add("fa-spin");try{await x(),(0,l.dY)((()=>{s.value=[...s.value],console.log("Attendance data refreshed successfully")}))}catch(a){console.error("Error refreshing attendance data:",a)}finally{setTimeout((()=>{e&&e.classList.remove("fa-spin")}),500)}},G=()=>{const e=document.querySelector(".date-picker-hidden");e&&e.click()},Z=()=>{h.value=!0},ee=()=>{i.value&&P(i.value),h.value=!1},ae=()=>{g.value=!0},te=(0,W.KR)(1),se=25,le=(0,l.EW)((()=>Math.ceil(_.value.length/se))),oe=(0,l.EW)((()=>{const e=(te.value-1)*se,a=e+se;return _.value.slice(e,a)})),ne=(0,l.EW)((()=>{const e=0===_.value.length?0:(te.value-1)*se+1,a=Math.min(e+se-1,_.value.length);return{start:e,end:a}})),re=()=>{te.value<le.value&&te.value++},ce=()=>{te.value>1&&te.value--};(0,l.wB)([o,k,y,L],(()=>{te.value=1}));const ie=()=>{o.value="",K()};return{students:s,searchQuery:o,sortedStudents:_,selectedStudent:i,currentDate:d,formatDate:z,formatDateForInput:X,navigateDate:U,isNextDayDisabled:B,markAttendance:$,slideDirection:u,selectedYear:k,selectedSection:y,selectedSubject:L,sortBy:R,getSortIcon:M,handleSearch:K,viewStudentDetails:N,fetchStudentAttendanceHistory:P,historyStartDate:b,historyEndDate:f,availableYears:S,availableSections:w,sectionsByYear:C,teacherSubjects:A,filteredSections:D,fetchAvailableYearsAndSections:E,fetchTeacherSubjects:j,applyFilters:I,clearFilters:Y,getAttendanceStatus:O,setCurrentDate:Q,resetHistoryDateFilter:V,setHistoryDateRange:q,openDatePicker:G,showHistoryDatePicker:h,openHistoryDatePicker:Z,applyHistoryDateFilter:ee,showCalendarPopup:g,openCalendarPopup:ae,refreshAttendance:J,currentPage:te,totalPages:le,paginatedStudents:oe,paginationInfo:ne,nextPage:re,previousPage:ce,clearSearch:ie}}};const ec=(0,i.A)(Zr,[["render",Jr],["__scopeId","data-v-79157682"]]);var ac=ec;const tc={class:"view-profile"},sc={class:"profile-header"},lc={class:"text-muted"},oc={class:"profile-content"},nc={class:"info-card"},rc={class:"info-grid"},cc={class:"info-item"},ic={class:"info-item"},dc={class:"info-item"},uc={key:0,class:"info-item"},vc={class:"info-item"},pc={key:1,class:"info-item"},mc={class:"action-buttons"};function bc(e,a,t,s,o,n){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",tc,[(0,l.Lk)("div",sc,[a[0]||(a[0]=(0,l.Lk)("div",{class:"profile-avatar"},[(0,l.Lk)("i",{class:"fas fa-user-circle"})],-1)),(0,l.Lk)("h2",null,(0,y.v_)(s.user.firstName)+" "+(0,y.v_)(s.user.lastName),1),(0,l.Lk)("p",lc,(0,y.v_)("citHead"===s.user.role?"CIT Head":"teacher"===s.user.role?"Teacher":"SSP Adviser"),1)]),(0,l.Lk)("div",oc,[(0,l.Lk)("div",nc,[a[7]||(a[7]=(0,l.Lk)("h3",null,"Personal Information",-1)),(0,l.Lk)("div",rc,[(0,l.Lk)("div",cc,[a[1]||(a[1]=(0,l.Lk)("label",null,"First Name",-1)),(0,l.Lk)("span",null,(0,y.v_)(s.user.firstName),1)]),(0,l.Lk)("div",ic,[a[2]||(a[2]=(0,l.Lk)("label",null,"Last Name",-1)),(0,l.Lk)("span",null,(0,y.v_)(s.user.lastName),1)]),(0,l.Lk)("div",dc,[a[3]||(a[3]=(0,l.Lk)("label",null,"Email",-1)),(0,l.Lk)("span",null,(0,y.v_)(s.user.email),1)]),"citHead"!==s.user.role?((0,l.uX)(),(0,l.CE)("div",uc,[a[4]||(a[4]=(0,l.Lk)("label",null,"Teaching Year",-1)),(0,l.Lk)("span",null,(0,y.v_)(s.user.teachingYear),1)])):(0,l.Q3)("",!0),(0,l.Lk)("div",vc,[a[5]||(a[5]=(0,l.Lk)("label",null,"Role",-1)),(0,l.Lk)("span",null,(0,y.v_)("citHead"===s.user.role?"CIT Head":"teacher"===s.user.role?"Teacher":"SSP Adviser"),1)]),"teacher"===s.user.role?((0,l.uX)(),(0,l.CE)("div",pc,[a[6]||(a[6]=(0,l.Lk)("label",null,"Subjects",-1)),(0,l.Lk)("span",null,(0,y.v_)(s.user.subjects.join(", ")||"No subjects assigned"),1)])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",mc,[(0,l.bF)(r,{to:"/profile/edit",class:"btn btn-primary"},{default:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.Lk)("i",{class:"fas fa-user-edit"},null,-1),(0,l.eW)(" Edit Information ")]))),_:1}),(0,l.bF)(r,{to:"/profile/password",class:"btn btn-secondary"},{default:(0,l.k6)((()=>a[9]||(a[9]=[(0,l.Lk)("i",{class:"fas fa-key"},null,-1),(0,l.eW)(" Change Password ")]))),_:1})])])])}var fc={name:"ViewProfile",setup(){const e=(0,v.Pj)(),a=(0,r.rd)(),t=(0,l.EW)((()=>e.state.auth.user||{})),s=(0,l.EW)((()=>e.getters.isLoggedIn));return s.value||a.push("/login"),{user:t}}};const hc=(0,i.A)(fc,[["render",bc],["__scopeId","data-v-05cbccde"]]);var gc=hc;const kc={class:"edit-profile"},yc={class:"card"},Lc={class:"card-body"},Sc={class:"mb-3"},wc={class:"mb-3"},Cc={class:"mb-3"},Ac={key:0,class:"mb-3"},Dc={class:"d-flex justify-content-end gap-2"};function Ec(e,a,t,o,n,r){const c=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",kc,[(0,l.Lk)("div",yc,[a[12]||(a[12]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h4",null,"Edit Profile")],-1)),(0,l.Lk)("div",Lc,[(0,l.Lk)("form",{onSubmit:a[4]||(a[4]=(0,s.D$)(((...e)=>o.updateProfile&&o.updateProfile(...e)),["prevent"]))},[(0,l.Lk)("div",Sc,[a[5]||(a[5]=(0,l.Lk)("label",{class:"form-label"},"First Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>o.form.firstName=e),required:""},null,512),[[s.Jo,o.form.firstName]])]),(0,l.Lk)("div",wc,[a[6]||(a[6]=(0,l.Lk)("label",{class:"form-label"},"Last Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>o.form.lastName=e),required:""},null,512),[[s.Jo,o.form.lastName]])]),(0,l.Lk)("div",Cc,[a[7]||(a[7]=(0,l.Lk)("label",{class:"form-label"},"Email",-1)),(0,l.bo)((0,l.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>o.form.email=e),required:""},null,512),[[s.Jo,o.form.email]])]),o.isTeacher?((0,l.uX)(),(0,l.CE)("div",Ac,[a[9]||(a[9]=(0,l.Lk)("label",{class:"form-label"},"Teaching Year",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":a[3]||(a[3]=e=>o.form.teachingYear=e),required:""},a[8]||(a[8]=[(0,l.Fv)('<option value="" data-v-18753eaa>Select Year</option><option value="1st" data-v-18753eaa>1st Year</option><option value="2nd" data-v-18753eaa>2nd Year</option><option value="3rd" data-v-18753eaa>3rd Year</option><option value="4th" data-v-18753eaa>4th Year</option>',5)]),512),[[s.u1,o.form.teachingYear]])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Dc,[(0,l.bF)(c,{to:"/dashboard",class:"btn btn-secondary"},{default:(0,l.k6)((()=>a[10]||(a[10]=[(0,l.eW)("Cancel")]))),_:1}),a[11]||(a[11]=(0,l.Lk)("button",{type:"submit",class:"btn btn-primary"},"Save Changes",-1))])],32)])])])}var jc={name:"EditProfile",setup(){const e=(0,v.Pj)(),a=(0,r.rd)(),t=(0,W.KR)({firstName:"",lastName:"",email:"",teachingYear:""}),s=(0,l.EW)((()=>e.getters.isTeacher)),o=(0,l.EW)((()=>e.state.auth.user));(0,l.sV)((()=>{o.value&&(t.value={firstName:o.value.firstName||"",lastName:o.value.lastName||"",email:o.value.email||"",teachingYear:o.value.teachingYear||""})}));const n=async()=>{try{const s=await p.A.put("/api/users/profile",t.value,{headers:{Authorization:`Bearer ${e.state.auth.token}`}});s.data&&(e.commit("SET_USER",s.data),localStorage.setItem("user",JSON.stringify(s.data)),a.push("/profile"))}catch(s){console.error("Failed to update profile:",s),alert(s.response?.data?.message||"Failed to update profile")}};return{form:t,isTeacher:s,updateProfile:n}}};const Ic=(0,i.A)(jc,[["render",Ec],["__scopeId","data-v-18753eaa"]]);var Yc=Ic;const Fc={class:"change-password"},xc={class:"card"},Tc={class:"card-body"},Nc={key:0,class:"alert alert-success mb-3"},Pc={class:"mb-3"},Rc={class:"password-input"},Mc=["type"],_c={class:"mb-3"},$c={class:"password-input"},Kc=["type"],zc={class:"mb-3"},Wc={class:"password-input"},Xc=["type"],Bc={class:"password-requirements"},Uc={class:"d-flex justify-content-end gap-2"},Hc=["disabled"];function Oc(e,a,t,o,n,r){const c=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",Fc,[(0,l.Lk)("div",xc,[a[18]||(a[18]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h4",null,"Change Password")],-1)),(0,l.Lk)("div",Tc,[o.successMessage?((0,l.uX)(),(0,l.CE)("div",Nc,(0,y.v_)(o.successMessage),1)):(0,l.Q3)("",!0),(0,l.Lk)("form",{onSubmit:a[6]||(a[6]=(0,s.D$)(((...e)=>o.updatePassword&&o.updatePassword(...e)),["prevent"]))},[(0,l.Lk)("div",Pc,[a[7]||(a[7]=(0,l.Lk)("label",{class:"form-label"},"Current Password",-1)),(0,l.Lk)("div",Rc,[(0,l.bo)((0,l.Lk)("input",{type:o.showCurrentPassword?"text":"password",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>o.form.currentPassword=e),required:""},null,8,Mc),[[s.hp,o.form.currentPassword]]),(0,l.Lk)("button",{type:"button",class:"toggle-password",onClick:a[1]||(a[1]=e=>o.showCurrentPassword=!o.showCurrentPassword)},[(0,l.Lk)("i",{class:(0,y.C4)(o.showCurrentPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),(0,l.Lk)("div",_c,[a[8]||(a[8]=(0,l.Lk)("label",{class:"form-label"},"New Password",-1)),(0,l.Lk)("div",$c,[(0,l.bo)((0,l.Lk)("input",{type:o.showNewPassword?"text":"password",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>o.form.newPassword=e),required:""},null,8,Kc),[[s.hp,o.form.newPassword]]),(0,l.Lk)("button",{type:"button",class:"toggle-password",onClick:a[3]||(a[3]=e=>o.showNewPassword=!o.showNewPassword)},[(0,l.Lk)("i",{class:(0,y.C4)(o.showNewPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),(0,l.Lk)("div",zc,[a[9]||(a[9]=(0,l.Lk)("label",{class:"form-label"},"Confirm New Password",-1)),(0,l.Lk)("div",Wc,[(0,l.bo)((0,l.Lk)("input",{type:o.showConfirmPassword?"text":"password",class:"form-control","onUpdate:modelValue":a[4]||(a[4]=e=>o.form.confirmPassword=e),required:""},null,8,Xc),[[s.hp,o.form.confirmPassword]]),(0,l.Lk)("button",{type:"button",class:"toggle-password",onClick:a[5]||(a[5]=e=>o.showConfirmPassword=!o.showConfirmPassword)},[(0,l.Lk)("i",{class:(0,y.C4)(o.showConfirmPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),(0,l.Lk)("div",Bc,[a[15]||(a[15]=(0,l.Lk)("h5",null,"Password Requirements:",-1)),(0,l.Lk)("ul",null,[(0,l.Lk)("li",{class:(0,y.C4)({met:o.passwordLength})},[(0,l.Lk)("i",{class:(0,y.C4)(o.passwordLength?"fas fa-check":"fas fa-times")},null,2),a[10]||(a[10]=(0,l.eW)(" At least 8 characters long "))],2),(0,l.Lk)("li",{class:(0,y.C4)({met:o.hasUpperCase})},[(0,l.Lk)("i",{class:(0,y.C4)(o.hasUpperCase?"fas fa-check":"fas fa-times")},null,2),a[11]||(a[11]=(0,l.eW)(" Contains uppercase letter "))],2),(0,l.Lk)("li",{class:(0,y.C4)({met:o.hasLowerCase})},[(0,l.Lk)("i",{class:(0,y.C4)(o.hasLowerCase?"fas fa-check":"fas fa-times")},null,2),a[12]||(a[12]=(0,l.eW)(" Contains lowercase letter "))],2),(0,l.Lk)("li",{class:(0,y.C4)({met:o.hasNumber})},[(0,l.Lk)("i",{class:(0,y.C4)(o.hasNumber?"fas fa-check":"fas fa-times")},null,2),a[13]||(a[13]=(0,l.eW)(" Contains number "))],2),(0,l.Lk)("li",{class:(0,y.C4)({met:o.passwordsMatch})},[(0,l.Lk)("i",{class:(0,y.C4)(o.passwordsMatch?"fas fa-check":"fas fa-times")},null,2),a[14]||(a[14]=(0,l.eW)(" Passwords match "))],2)])]),(0,l.Lk)("div",Uc,[(0,l.bF)(c,{to:"/profile/view",class:"btn btn-secondary"},{default:(0,l.k6)((()=>a[16]||(a[16]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1),(0,l.eW)(" Cancel ")]))),_:1}),(0,l.Lk)("button",{type:"submit",class:(0,y.C4)(["btn btn-primary",{"btn-loading":o.isLoading}]),disabled:!o.isFormValid||o.isLoading},a[17]||(a[17]=[(0,l.Lk)("i",{class:"fas fa-key"},null,-1),(0,l.eW)(" Update Password ")]),10,Hc)])],32)])])])}var Qc={name:"ChangePassword",setup(){const e=(0,v.Pj)(),a=(0,r.rd)(),t=(0,W.KR)(!1),s=(0,W.KR)({currentPassword:"",newPassword:"",confirmPassword:""}),o=(0,W.KR)(!1),n=(0,W.KR)(!1),c=(0,W.KR)(!1),i=(0,l.EW)((()=>s.value.newPassword.length>=8)),d=(0,l.EW)((()=>/[A-Z]/.test(s.value.newPassword))),u=(0,l.EW)((()=>/[a-z]/.test(s.value.newPassword))),m=(0,l.EW)((()=>/[0-9]/.test(s.value.newPassword))),b=(0,l.EW)((()=>s.value.newPassword&&s.value.newPassword===s.value.confirmPassword)),f=(0,l.EW)((()=>i.value&&d.value&&u.value&&m.value&&b.value&&s.value.currentPassword)),h=(0,W.KR)(""),g=async()=>{if(f.value){t.value=!0;try{await p.A.put("/api/users/password",{currentPassword:s.value.currentPassword,newPassword:s.value.newPassword},{headers:{Authorization:`Bearer ${e.state.auth.token}`}}),h.value="Password changed successfully!",s.value={currentPassword:"",newPassword:"",confirmPassword:""},setTimeout((()=>{a.push("/profile/view")}),2e3)}catch(l){console.error("Failed to update password:",l),alert(l.response?.data?.message||"Failed to update password")}finally{t.value=!1}}};return{form:s,showCurrentPassword:o,showNewPassword:n,showConfirmPassword:c,passwordLength:i,hasUpperCase:d,hasLowerCase:u,hasNumber:m,passwordsMatch:b,isFormValid:f,isLoading:t,updatePassword:g,successMessage:h}}};const Vc=(0,i.A)(Qc,[["render",Oc],["__scopeId","data-v-f946937a"]]);var qc=Vc;function Jc(e,a,t,s,o,n){const r=(0,l.g2)("router-view"),c=(0,l.g2)("Navigation");return(0,l.uX)(),(0,l.Wv)(c,{"selected-info":s.selectedInfo},{default:(0,l.k6)((()=>[(0,l.bF)(r)])),_:1},8,["selected-info"])}const Gc={class:"sidebar-header"},Zc={class:"title-container"},ei={class:"sidebar-title"},ai={class:"sidebar-subtitle"},ti={class:"sidebar-nav"},si={class:"sidebar-bottom"},li={class:"content-wrapper"},oi={class:"page-header"},ni={class:"d-flex align-items-center"},ri={class:"page-title"},ci={key:0,class:"ms-3 page-subtitle"},ii={key:0},di={class:"dropdown"},ui={class:"profile-button",type:"button",id:"profileDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},vi={class:"avatar"},pi={class:"dropdown-menu dropdown-menu-end profile-menu","aria-labelledby":"profileDropdown"},mi={class:"profile-header"},bi={class:"user-name"},fi={class:"user-role"},hi={class:"main-content"};function gi(e,a,t,o,n,r){const c=(0,l.g2)("router-link"),i=(0,l.gN)("tooltip");return(0,l.uX)(),(0,l.CE)("div",{class:(0,y.C4)(["navigation-wrapper",{"sidebar-collapsed":o.isSidebarCollapsed}])},[(0,l.Lk)("aside",{class:(0,y.C4)(["sidebar",{collapsed:o.isSidebarCollapsed}])},[(0,l.Lk)("div",Gc,[a[3]||(a[3]=(0,l.Lk)("img",{src:S,alt:"SPMS Logo",class:"sidebar-logo"},null,-1)),(0,l.Lk)("div",Zc,[(0,l.bo)((0,l.Lk)("h3",ei,"SPMS",512),[[s.aG,!o.isSidebarCollapsed]]),(0,l.bo)((0,l.Lk)("h4",ai,"Student Performance Monitoring System",512),[[s.aG,!o.isSidebarCollapsed]])]),(0,l.Lk)("button",{class:"collapse-btn",onClick:a[0]||(a[0]=(...e)=>o.toggleSidebar&&o.toggleSidebar(...e))},[(0,l.Lk)("i",{class:(0,y.C4)(o.isSidebarCollapsed?"fas fa-angle-right":"fas fa-angle-left")},null,2)])]),(0,l.Lk)("nav",ti,[o.isCITHead?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[a[8]||(a[8]=(0,l.Lk)("div",{class:"nav-category"},"Analytics",-1)),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/dashboard",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[4]||(a[4]=(0,l.Lk)("i",{class:"fas fa-chart-line"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Dashboard",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Dashboard":""]]),a[9]||(a[9]=(0,l.Lk)("div",{class:"nav-category"},"Management",-1)),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/student-management",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[5]||(a[5]=(0,l.Lk)("i",{class:"fas fa-users"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Student Management",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Student Management":""]]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/teacher-management",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[6]||(a[6]=(0,l.Lk)("i",{class:"fas fa-chalkboard-teacher"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Teacher Management",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Teacher Management":""]]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/register",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[7]||(a[7]=(0,l.Lk)("i",{class:"fas fa-user-plus"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Add Teacher/SSP",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Add Teacher/SSP":""]])],64)):(0,l.Q3)("",!0),o.isTeacher?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[a[13]||(a[13]=(0,l.Lk)("div",{class:"nav-category"},"Analytics",-1)),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/teacher-dashboard",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[10]||(a[10]=(0,l.Lk)("i",{class:"fas fa-chart-line"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Dashboard",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Dashboard":""]]),a[14]||(a[14]=(0,l.Lk)("div",{class:"nav-category"},"Records",-1)),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/class-records",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[11]||(a[11]=(0,l.Lk)("i",{class:"fas fa-book"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Class Records",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Class Records":""]]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/attendance",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[12]||(a[12]=(0,l.Lk)("i",{class:"fas fa-clipboard-list"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Attendance",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Attendance":""]])],64)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",si,[a[19]||(a[19]=(0,l.Lk)("div",{class:"nav-category"},"Account",-1)),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/profile/view",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[15]||(a[15]=(0,l.Lk)("i",{class:"fas fa-user-circle"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"View Profile",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Profile":""]]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/profile/edit",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[16]||(a[16]=(0,l.Lk)("i",{class:"fas fa-user-edit"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Edit Profile",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Edit Profile":""]]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(c,{to:"/profile/password",class:"nav-item","active-class":"active"},{default:(0,l.k6)((()=>[a[17]||(a[17]=(0,l.Lk)("i",{class:"fas fa-lock"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Change Password",512),[[s.aG,!o.isSidebarCollapsed]])])),_:1})),[[i,o.isSidebarCollapsed?"Change Password":""]]),(0,l.bo)(((0,l.uX)(),(0,l.CE)("a",{onClick:a[1]||(a[1]=(0,s.D$)(((...e)=>o.handleLogout&&o.handleLogout(...e)),["prevent"])),class:"nav-item"},[a[18]||(a[18]=(0,l.Lk)("i",{class:"fas fa-sign-out-alt"},null,-1)),(0,l.bo)((0,l.Lk)("span",null,"Logout",512),[[s.aG,!o.isSidebarCollapsed]])])),[[i,o.isSidebarCollapsed?"Logout":""]])])],2),(0,l.Lk)("div",li,[(0,l.Lk)("div",oi,[(0,l.Lk)("div",ni,[(0,l.Lk)("h2",ri,(0,y.v_)(o.pageTitle),1),"ClassRecords"===o.route.name||"Attendance"===o.route.name?((0,l.uX)(),(0,l.CE)("div",ci,[t.selectedInfo?((0,l.uX)(),(0,l.CE)("span",ii,"of "+(0,y.v_)(t.selectedInfo),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",di,[(0,l.Lk)("button",ui,[(0,l.Lk)("div",vi,(0,y.v_)(o.userInitials),1)]),(0,l.Lk)("ul",pi,[(0,l.Lk)("li",mi,[(0,l.Lk)("div",bi,(0,y.v_)(o.user?.firstName)+" "+(0,y.v_)(o.user?.lastName),1),(0,l.Lk)("div",fi,(0,y.v_)("citHead"===o.user?.role?"CIT Head":"Teacher"),1)]),a[24]||(a[24]=(0,l.Lk)("li",null,[(0,l.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,l.Lk)("li",null,[(0,l.bF)(c,{class:"dropdown-item",to:"/profile/view"},{default:(0,l.k6)((()=>a[20]||(a[20]=[(0,l.Lk)("i",{class:"fas fa-user-circle"},null,-1),(0,l.eW)(" View Profile ")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(c,{class:"dropdown-item",to:"/profile/edit"},{default:(0,l.k6)((()=>a[21]||(a[21]=[(0,l.Lk)("i",{class:"fas fa-user-edit"},null,-1),(0,l.eW)(" Edit Profile ")]))),_:1})]),(0,l.Lk)("li",null,[(0,l.bF)(c,{class:"dropdown-item",to:"/profile/password"},{default:(0,l.k6)((()=>a[22]||(a[22]=[(0,l.Lk)("i",{class:"fas fa-lock"},null,-1),(0,l.eW)(" Change Password ")]))),_:1})]),a[25]||(a[25]=(0,l.Lk)("li",null,[(0,l.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item text-danger",href:"#",onClick:a[2]||(a[2]=(0,s.D$)(((...e)=>o.handleLogout&&o.handleLogout(...e)),["prevent"]))},a[23]||(a[23]=[(0,l.Lk)("i",{class:"fas fa-sign-out-alt"},null,-1),(0,l.eW)(" Logout ")]))])])])]),(0,l.Lk)("main",hi,[(0,l.RG)(e.$slots,"default",{},void 0,!0)])])],2)}var ki={name:"Navigation",props:{selectedInfo:{type:String,default:""}},setup(e){const a=(0,v.Pj)(),t=(0,r.rd)(),s=(0,r.lq)(),o=(0,W.KR)("true"===localStorage.getItem("sidebarCollapsed")),n=(0,l.EW)((()=>a.state.auth.user)),c=(0,l.EW)((()=>a.getters.isCITHead)),i=(0,l.EW)((()=>a.getters.isTeacher)),d=(0,l.EW)((()=>n.value?`${n.value.firstName?.charAt(0)||""}${n.value.lastName?.charAt(0)||""}`:"")),u=(0,l.EW)((()=>{const e=s.name;switch(e){case"ClassRecords":return"Class Records";case"Attendance":return"Attendance";case"Dashboard":return"Dashboard";case"TeacherDashboard":return"Dashboard";case"StudentManagement":return"Student Management";case"TeacherManagement":return"Teacher Management";case"ViewProfile":return"Profile";case"EditProfile":return"Edit Profile";case"ChangePassword":return"Change Password";case"Register":return"Add Teacher/SSP";default:return e||"Dashboard"}})),p=()=>{o.value=!o.value,localStorage.setItem("sidebarCollapsed",o.value)},m=async()=>{try{await a.dispatch("logout"),t.push("/login")}catch(e){console.error("Logout failed:",e)}};return{user:n,pageTitle:u,handleLogout:m,isCITHead:c,isTeacher:i,userInitials:d,isSidebarCollapsed:o,toggleSidebar:p,route:s}}};const yi=(0,i.A)(ki,[["render",gi],["__scopeId","data-v-1a34250d"]]);var Li=yi,Si={name:"DashboardLayout",components:{Navigation:Li},setup(){(0,v.Pj)();const e=(0,l.EW)((()=>{const e=localStorage.getItem("selectedYear"),a=localStorage.getItem("selectedSection"),t=localStorage.getItem("selectedSubject");return e&&a&&t?`${e} - ${a} - ${t}`:""}));return{selectedInfo:e}}};const wi=(0,i.A)(Si,[["render",Jc],["__scopeId","data-v-80c00b1e"]]);var Ci=wi;const Ai={class:"teacher-management"},Di={class:"table-container"},Ei={class:"table-controls mb-3"},ji={class:"d-flex justify-content-between align-items-center"},Ii={class:"d-flex align-items-center gap-3"},Yi={class:"dropdown"},Fi={class:"dropdown-menu shadow-lg","aria-labelledby":"sortDropdown"},xi={class:"dropdown"},Ti={class:"btn btn-control",type:"button",id:"filterDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},Ni={key:0,class:"filter-badge"},Pi={class:"dropdown-menu shadow-lg p-3","aria-labelledby":"filterDropdown"},Ri={class:"mb-3"},Mi={class:"d-flex justify-content-end gap-2 mt-3"},_i={class:"search-control"},$i={class:"input-group"},Ki={class:"table-responsive"},zi={class:"table table-hover"},Wi=["onClick"],Xi={class:"teacher-info"},Bi={class:"avatar"},Ui={class:"name"},Hi={class:"subjects"},Oi={key:1},Qi={colspan:"4",class:"text-center py-4"},Vi={class:"empty-state-message"},qi={key:0,class:"text-muted small"},Ji={class:"modal-content"},Gi={class:"modal-header"},Zi={class:"modal-body"},ed={key:0},ad={class:"info-grid"},td={class:"info-item"},sd={class:"info-item"},ld={class:"info-item"},od={class:"info-item"},nd={class:"info-item",style:{"grid-column":"span 2"}},rd={class:"subjects-list"},cd={class:"modal-footer"},id={class:"info-grid"},dd={class:"info-item"},ud={class:"info-item"},vd={class:"info-item"},pd={class:"info-item"},md={class:"info-item",style:{"grid-column":"span 2"}},bd={class:"subjects-list"},fd=["id","value"],hd=["for"],gd={class:"mt-3"},kd={class:"input-group"},yd=["disabled"],Ld={class:"modal-footer"},Sd=["disabled"],wd={class:"modal-content modal-sm"},Cd={class:"modal-header"},Ad={class:"modal-body"},Dd={class:"teacher-preview"},Ed={class:"preview-avatar"},jd={class:"preview-info"},Id={class:"modal-footer"},Yd=["disabled"];function Fd(e,a,t,o,n,r){return(0,l.uX)(),(0,l.CE)("div",Ai,[(0,l.Lk)("div",Di,[(0,l.Lk)("div",Ei,[(0,l.Lk)("div",ji,[(0,l.Lk)("div",Ii,[(0,l.Lk)("div",Yi,[a[30]||(a[30]=(0,l.Lk)("button",{class:"btn btn-control",type:"button",id:"sortDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,l.Lk)("i",{class:"fas fa-sort me-2"}),(0,l.eW)(" Sort by ")],-1)),(0,l.Lk)("ul",Fi,[(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center gap-2",href:"#",onClick:a[0]||(a[0]=(0,s.D$)((e=>o.sortBy("lastName")),["prevent"]))},[a[26]||(a[26]=(0,l.Lk)("i",{class:"fas fa-sort-alpha-down"},null,-1)),a[27]||(a[27]=(0,l.Lk)("span",null,"Name",-1)),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("lastName"),"ms-auto"])},null,2)])]),(0,l.Lk)("li",null,[(0,l.Lk)("a",{class:"dropdown-item d-flex align-items-center gap-2",href:"#",onClick:a[1]||(a[1]=(0,s.D$)((e=>o.sortBy("email")),["prevent"]))},[a[28]||(a[28]=(0,l.Lk)("i",{class:"fas fa-sort-alpha-down"},null,-1)),a[29]||(a[29]=(0,l.Lk)("span",null,"Email",-1)),(0,l.Lk)("i",{class:(0,y.C4)([o.getSortIcon("email"),"ms-auto"])},null,2)])])])]),(0,l.Lk)("div",xi,[(0,l.Lk)("button",Ti,[a[31]||(a[31]=(0,l.Lk)("i",{class:"fas fa-filter me-2"},null,-1)),a[32]||(a[32]=(0,l.eW)(" Filter ")),o.hasActiveFilters?((0,l.uX)(),(0,l.CE)("span",Ni,"!")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Pi,[a[35]||(a[35]=(0,l.Lk)("h6",{class:"dropdown-header px-0 mb-2"},"Filter Options",-1)),(0,l.Lk)("div",Ri,[a[34]||(a[34]=(0,l.Lk)("label",{class:"form-label"},"Teaching Year",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[2]||(a[2]=e=>o.yearFilter=e),onChange:a[3]||(a[3]=(...e)=>o.applyFilters&&o.applyFilters(...e))},a[33]||(a[33]=[(0,l.Fv)('<option value="" data-v-468a0eb8>All Years</option><option value="1st" data-v-468a0eb8>1st Year</option><option value="2nd" data-v-468a0eb8>2nd Year</option><option value="3rd" data-v-468a0eb8>3rd Year</option><option value="4th" data-v-468a0eb8>4th Year</option>',5)]),544),[[s.u1,o.yearFilter]])]),(0,l.Lk)("div",Mi,[(0,l.Lk)("button",{class:"btn btn-sm btn-light",onClick:a[4]||(a[4]=(...e)=>o.clearFilters&&o.clearFilters(...e))},"Clear All"),(0,l.Lk)("button",{class:"btn btn-sm btn-primary",onClick:a[5]||(a[5]=(...e)=>o.applyFilters&&o.applyFilters(...e))},"Apply Filters")])])])]),(0,l.Lk)("div",_i,[(0,l.Lk)("div",$i,[a[37]||(a[37]=(0,l.Lk)("span",{class:"input-group-text border-end-0"},[(0,l.Lk)("i",{class:"fas fa-search"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control border-start-0","onUpdate:modelValue":a[6]||(a[6]=e=>o.searchQuery=e),placeholder:"Search teachers...",onInput:a[7]||(a[7]=(...e)=>o.handleSearch&&o.handleSearch(...e))},null,544),[[s.Jo,o.searchQuery]]),o.searchQuery?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-outline-secondary border-start-0",type:"button",onClick:a[8]||(a[8]=(...e)=>o.clearSearch&&o.clearSearch(...e))},a[36]||(a[36]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))):(0,l.Q3)("",!0)])])])]),(0,l.Lk)("div",Ki,[(0,l.Lk)("table",zi,[a[40]||(a[40]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Name"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Teaching Year"),(0,l.Lk)("th",null,"Subjects")])],-1)),(0,l.Lk)("tbody",null,[o.sortedTeachers.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(o.sortedTeachers,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e._id,onClick:a=>o.editTeacher(e),class:"clickable-row"},[(0,l.Lk)("td",null,[(0,l.Lk)("div",Xi,[(0,l.Lk)("div",Bi,(0,y.v_)(o.getInitials(e.firstName,e.lastName)),1),(0,l.Lk)("div",Ui,(0,y.v_)(e.firstName)+" "+(0,y.v_)(e.lastName),1)])]),(0,l.Lk)("td",null,(0,y.v_)(e.email),1),(0,l.Lk)("td",null,(0,y.v_)(e.teachingYear),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",Hi,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.subjects,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"subject-badge"},(0,y.v_)(e),1)))),128))])])],8,Wi)))),128)):((0,l.uX)(),(0,l.CE)("tr",Oi,[(0,l.Lk)("td",Qi,[(0,l.Lk)("div",Vi,[a[38]||(a[38]=(0,l.Lk)("i",{class:"fas fa-users text-muted mb-2"},null,-1)),a[39]||(a[39]=(0,l.Lk)("p",{class:"mb-0"},"No teachers found",-1)),o.hasActiveFilters?((0,l.uX)(),(0,l.CE)("p",qi," Try adjusting your filters ")):(0,l.Q3)("",!0)])])]))])])])]),o.showEditModal?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal",onClick:a[21]||(a[21]=(0,s.D$)(((...e)=>o.closeEditModal&&o.closeEditModal(...e)),["self"]))},[(0,l.Lk)("div",Ji,[(0,l.Lk)("div",Gi,[a[42]||(a[42]=(0,l.Lk)("h5",null,"Teacher Information",-1)),(0,l.Lk)("button",{onClick:a[9]||(a[9]=(...e)=>o.closeEditModal&&o.closeEditModal(...e)),class:"btn-close"},a[41]||(a[41]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,l.Lk)("div",Zi,[o.isEditing?((0,l.uX)(),(0,l.CE)("form",{key:1,onSubmit:a[20]||(a[20]=(0,s.D$)(((...e)=>o.updateTeacher&&o.updateTeacher(...e)),["prevent"]))},[(0,l.Lk)("div",id,[(0,l.Lk)("div",dd,[a[50]||(a[50]=(0,l.Lk)("label",null,"First Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":a[12]||(a[12]=e=>o.editForm.firstName=e),required:""},null,512),[[s.Jo,o.editForm.firstName]])]),(0,l.Lk)("div",ud,[a[51]||(a[51]=(0,l.Lk)("label",null,"Last Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":a[13]||(a[13]=e=>o.editForm.lastName=e),required:""},null,512),[[s.Jo,o.editForm.lastName]])]),(0,l.Lk)("div",vd,[a[52]||(a[52]=(0,l.Lk)("label",null,"Email",-1)),(0,l.bo)((0,l.Lk)("input",{type:"email","onUpdate:modelValue":a[14]||(a[14]=e=>o.editForm.email=e),required:""},null,512),[[s.Jo,o.editForm.email]])]),(0,l.Lk)("div",pd,[a[54]||(a[54]=(0,l.Lk)("label",null,"Teaching Year",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>o.editForm.teachingYear=e),required:""},a[53]||(a[53]=[(0,l.Lk)("option",{value:"1st"},"1st Year",-1),(0,l.Lk)("option",{value:"2nd"},"2nd Year",-1),(0,l.Lk)("option",{value:"3rd"},"3rd Year",-1),(0,l.Lk)("option",{value:"4th"},"4th Year",-1)]),512),[[s.u1,o.editForm.teachingYear]])]),(0,l.Lk)("div",md,[a[55]||(a[55]=(0,l.Lk)("label",null,"Subjects",-1)),(0,l.Lk)("div",bd,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.availableSubjects,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e,class:"form-check"},[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",id:e,value:e,"onUpdate:modelValue":a[16]||(a[16]=e=>o.editForm.subjects=e)},null,8,fd),[[s.lH,o.editForm.subjects]]),(0,l.Lk)("label",{for:e},(0,y.v_)(e),9,hd)])))),128))]),(0,l.Lk)("div",gd,[(0,l.Lk)("div",kd,[(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":a[17]||(a[17]=e=>o.newSubject=e),placeholder:"Add custom subject",class:"form-control",style:{width:"70%"}},null,512),[[s.Jo,o.newSubject]]),(0,l.Lk)("button",{type:"button",onClick:a[18]||(a[18]=(...e)=>o.addCustomSubject&&o.addCustomSubject(...e)),class:"btn btn-primary",disabled:!o.newSubject}," Add ",8,yd)])])])]),(0,l.Lk)("div",Ld,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[19]||(a[19]=(...e)=>o.toggleEdit&&o.toggleEdit(...e))}," Cancel "),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:o.isLoading},(0,y.v_)(o.isLoading?"Saving...":"Save Changes"),9,Sd)])],32)):((0,l.uX)(),(0,l.CE)("div",ed,[(0,l.Lk)("div",ad,[(0,l.Lk)("div",td,[a[43]||(a[43]=(0,l.Lk)("label",null,"First Name",-1)),(0,l.Lk)("span",null,(0,y.v_)(o.editForm.firstName),1)]),(0,l.Lk)("div",sd,[a[44]||(a[44]=(0,l.Lk)("label",null,"Last Name",-1)),(0,l.Lk)("span",null,(0,y.v_)(o.editForm.lastName),1)]),(0,l.Lk)("div",ld,[a[45]||(a[45]=(0,l.Lk)("label",null,"Email",-1)),(0,l.Lk)("span",null,(0,y.v_)(o.editForm.email),1)]),(0,l.Lk)("div",od,[a[46]||(a[46]=(0,l.Lk)("label",null,"Teaching Year",-1)),(0,l.Lk)("span",null,(0,y.v_)(o.editForm.teachingYear),1)]),(0,l.Lk)("div",nd,[a[47]||(a[47]=(0,l.Lk)("label",null,"Subjects",-1)),(0,l.Lk)("div",rd,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.editForm.subjects,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"subject-badge"},(0,y.v_)(e),1)))),128))])])]),(0,l.Lk)("div",cd,[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[10]||(a[10]=(...e)=>o.toggleEdit&&o.toggleEdit(...e))},a[48]||(a[48]=[(0,l.Lk)("i",{class:"fas fa-edit"},null,-1),(0,l.eW)(" Edit Information ")])),(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:a[11]||(a[11]=e=>o.confirmDelete(o.selectedTeacher))},a[49]||(a[49]=[(0,l.Lk)("i",{class:"fas fa-trash"},null,-1),(0,l.eW)(" Delete Teacher ")]))])]))])])])):(0,l.Q3)("",!0),o.showDeleteModal?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"modal",onClick:a[25]||(a[25]=(0,s.D$)(((...e)=>o.closeDeleteModal&&o.closeDeleteModal(...e)),["self"]))},[(0,l.Lk)("div",wd,[(0,l.Lk)("div",Cd,[a[57]||(a[57]=(0,l.Lk)("h5",null,[(0,l.Lk)("i",{class:"fas fa-exclamation-triangle text-danger"}),(0,l.eW)(" Confirm Delete")],-1)),(0,l.Lk)("button",{onClick:a[22]||(a[22]=(...e)=>o.closeDeleteModal&&o.closeDeleteModal(...e)),class:"btn-close"},a[56]||(a[56]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,l.Lk)("div",Ad,[a[58]||(a[58]=(0,l.Lk)("p",null,"Are you sure you want to delete this teacher's record? This action cannot be undone.",-1)),(0,l.Lk)("div",Dd,[(0,l.Lk)("div",Ed,(0,y.v_)(o.getInitials(o.selectedTeacher?.firstName,o.selectedTeacher?.lastName)),1),(0,l.Lk)("div",jd,[(0,l.Lk)("strong",null,(0,y.v_)(o.selectedTeacher?.firstName)+" "+(0,y.v_)(o.selectedTeacher?.lastName),1),(0,l.Lk)("span",null,(0,y.v_)(o.selectedTeacher?.email),1)])])]),(0,l.Lk)("div",Id,[(0,l.Lk)("button",{onClick:a[23]||(a[23]=(...e)=>o.closeDeleteModal&&o.closeDeleteModal(...e)),class:"btn btn-secondary"}," Cancel "),(0,l.Lk)("button",{onClick:a[24]||(a[24]=(...e)=>o.deleteTeacher&&o.deleteTeacher(...e)),class:"btn btn-danger",disabled:o.isLoading},(0,y.v_)(o.isLoading?"Deleting...":"Delete"),9,Yd)])])])):(0,l.Q3)("",!0)])}var xd={name:"TeacherManagement",setup(){const e=(0,v.Pj)(),a=(0,W.KR)([]),t=(0,W.KR)(""),s=(0,W.KR)(""),o=(0,W.KR)(!1),n=(0,W.KR)(!1),r=(0,W.KR)(!1),c=(0,W.KR)(null),i=(0,W.KR)(""),d=(0,W.KR)("lastName"),u=(0,W.KR)("asc"),m=(0,W.KR)(!1),b=(0,W.KR)({firstName:"",lastName:"",email:"",teachingYear:"",subjects:[]}),f={"1st":["ITE 101","ITE 102","ITE 103","ITE 104"],"2nd":["ITE 201","ITE 202","ITE 203","ITE 204"],"3rd":["ITE 301","ITE 302","ITE 303","ITE 304"],"4th":["ITE 401","ITE 402","ITE 403","ITE 404"]},h=(0,l.EW)((()=>b.value.teachingYear?f[b.value.teachingYear]:[])),g=(0,l.EW)((()=>a.value.filter((e=>{const a=""===t.value||e.firstName.toLowerCase().includes(t.value.toLowerCase())||e.lastName.toLowerCase().includes(t.value.toLowerCase())||e.email.toLowerCase().includes(t.value.toLowerCase()),l=""===s.value||e.teachingYear===s.value;return a&&l})))),k=(0,l.EW)((()=>""!==s.value||""!==t.value)),y=(0,l.EW)((()=>{let e=[...g.value];return d.value&&e.sort(((e,a)=>{let t=e[d.value],s=a[d.value];return"lastName"===d.value&&(t=`${e.lastName} ${e.firstName}`,s=`${a.lastName} ${a.firstName}`),"asc"===u.value?t.localeCompare(s):s.localeCompare(t)})),e})),L=e=>d.value!==e?"":(u.value,"fas fa-check"),S=e=>{d.value===e?u.value="asc"===u.value?"desc":"asc":(d.value=e,u.value="asc")},w=()=>{s.value="",D()},C=()=>{t.value="",A()},A=()=>{E()},D=()=>{E()},E=async()=>{try{const t=await p.A.get("http://localhost:8000/api/teachers",{headers:{Authorization:`Bearer ${e.state.auth.token}`,"Content-Type":"application/json"}});a.value=t.data}catch(t){console.error("Failed to fetch teachers:",t),t.response&&console.error("Error response:",t.response.data)}},j=e=>{c.value=e,b.value={firstName:e.firstName,lastName:e.lastName,email:e.email,teachingYear:e.teachingYear,subjects:[...e.subjects]},n.value=!0,m.value=!1},I=async()=>{o.value=!0;try{await p.A.put(`/api/teachers/${c.value._id}`,b.value,{headers:{Authorization:`Bearer ${e.state.auth.token}`}}),await E(),N()}catch(a){console.error("Failed to update teacher:",a),alert(a.response?.data?.message||"Failed to update teacher")}finally{o.value=!1}},Y=e=>{c.value=e,r.value=!0},F=async()=>{o.value=!0;try{await p.A.delete(`/api/teachers/${c.value._id}`,{headers:{Authorization:`Bearer ${e.state.auth.token}`}}),await E(),P()}catch(a){console.error("Failed to delete teacher:",a),alert(a.response?.data?.message||"Failed to delete teacher")}finally{o.value=!1}},x=()=>{if(i.value){const e=i.value.trim().toUpperCase();b.value.subjects.includes(e)||b.value.subjects.push(e),i.value=""}},T=(e,a)=>`${e.charAt(0)}${a.charAt(0)}`.toUpperCase(),N=()=>{n.value=!1,c.value=null,m.value=!1,b.value={firstName:"",lastName:"",email:"",teachingYear:"",subjects:[]}},P=()=>{r.value=!1,c.value=null},R=()=>{m.value&&(b.value={firstName:c.value.firstName,lastName:c.value.lastName,email:c.value.email,teachingYear:c.value.teachingYear,subjects:[...c.value.subjects]}),m.value=!m.value};return(0,l.sV)((()=>{E()})),{teachers:a,searchQuery:t,yearFilter:s,filteredTeachers:g,showEditModal:n,showDeleteModal:r,selectedTeacher:c,editForm:b,isLoading:o,newSubject:i,availableSubjects:h,editTeacher:j,updateTeacher:I,confirmDelete:Y,deleteTeacher:F,addCustomSubject:x,getInitials:T,closeEditModal:N,closeDeleteModal:P,sortedTeachers:y,hasActiveFilters:k,getSortIcon:L,sortBy:S,clearFilters:w,clearSearch:C,handleSearch:A,applyFilters:D,isEditing:m,toggleEdit:R}}};const Td=(0,i.A)(xd,[["render",Fd],["__scopeId","data-v-468a0eb8"]]);var Nd=Td;const Pd=[{path:"/",redirect:"/dashboard"},{path:"/login",name:"Login",component:U,meta:{guest:!0}},{path:"/",component:Ci,children:[{path:"dashboard",name:"Dashboard",component:ia,meta:{requiresAuth:!0,citHeadOnly:!0}},{path:"register",name:"Register",component:me,meta:{requiresAuth:!0,citHeadOnly:!0}},{path:"teacher-dashboard",name:"TeacherDashboard",component:_t,meta:{requiresAuth:!0,teacherOnly:!0}},{path:"student-management",name:"StudentManagement",component:Dl,meta:{requiresAuth:!0,citHeadOnly:!0}},{path:"class-records",name:"ClassRecords",component:ar,meta:{requiresAuth:!0,teacherOnly:!0}},{path:"attendance",name:"Attendance",component:ac,meta:{requiresAuth:!0,teacherOnly:!0}},{path:"profile/view",name:"ViewProfile",component:gc,meta:{requiresAuth:!0}},{path:"profile/edit",name:"EditProfile",component:Yc,meta:{requiresAuth:!0}},{path:"profile/password",name:"ChangePassword",component:qc,meta:{requiresAuth:!0}},{path:"teacher-management",name:"TeacherManagement",component:Nd,meta:{requiresAuth:!0,roles:["citHead"]}}]}],Rd=(0,r.aE)({history:(0,r.LA)(),routes:Pd});Rd.beforeEach(((e,a,t)=>{const s=k.getters.isLoggedIn,l=k.getters.isCITHead,o=k.getters.isTeacher;if(e.matched.some((e=>e.meta.requiresAuth))){if(!s)return void t("/login");if(e.matched.some((e=>e.meta.citHeadOnly))&&!l)return void t("/teacher-dashboard");if(e.matched.some((e=>e.meta.teacherOnly))&&!o)return void t("/dashboard")}e.matched.some((e=>e.meta.guest))&&s?l?t("/dashboard"):o&&t("/teacher-dashboard"):"/dashboard"===e.path&&o?t("/teacher-dashboard"):t()}));var Md=Rd,_d=t(6912);_d.t1.register(..._d.$L);const $d=(0,s.Ef)(u);$d.use(Md),$d.use(k),$d.mount("#app")},5358:function(e,a,t){var s={"./af":2190,"./af.js":2190,"./ar":7218,"./ar-dz":5785,"./ar-dz.js":5785,"./ar-kw":9417,"./ar-kw.js":9417,"./ar-ly":6904,"./ar-ly.js":6904,"./ar-ma":8617,"./ar-ma.js":8617,"./ar-ps":1318,"./ar-ps.js":1318,"./ar-sa":2699,"./ar-sa.js":2699,"./ar-tn":6789,"./ar-tn.js":6789,"./ar.js":7218,"./az":3050,"./az.js":3050,"./be":8316,"./be.js":8316,"./bg":310,"./bg.js":310,"./bm":8884,"./bm.js":8884,"./bn":3469,"./bn-bd":6672,"./bn-bd.js":6672,"./bn.js":3469,"./bo":9118,"./bo.js":9118,"./br":3113,"./br.js":3113,"./bs":3626,"./bs.js":3626,"./ca":921,"./ca.js":921,"./cs":7799,"./cs.js":7799,"./cv":2828,"./cv.js":2828,"./cy":3521,"./cy.js":3521,"./da":6962,"./da.js":6962,"./de":3294,"./de-at":6158,"./de-at.js":6158,"./de-ch":5960,"./de-ch.js":5960,"./de.js":3294,"./dv":7963,"./dv.js":7963,"./el":3432,"./el.js":3432,"./en-au":998,"./en-au.js":998,"./en-ca":5931,"./en-ca.js":5931,"./en-gb":5930,"./en-gb.js":5930,"./en-ie":8081,"./en-ie.js":8081,"./en-il":1594,"./en-il.js":1594,"./en-in":3904,"./en-in.js":3904,"./en-nz":1507,"./en-nz.js":1507,"./en-sg":9409,"./en-sg.js":9409,"./eo":2177,"./eo.js":2177,"./es":4805,"./es-do":9155,"./es-do.js":9155,"./es-mx":9791,"./es-mx.js":9791,"./es-us":6098,"./es-us.js":6098,"./es.js":4805,"./et":6240,"./et.js":6240,"./eu":391,"./eu.js":391,"./fa":612,"./fa.js":612,"./fi":4220,"./fi.js":4220,"./fil":5570,"./fil.js":5570,"./fo":5466,"./fo.js":5466,"./fr":4461,"./fr-ca":6306,"./fr-ca.js":6306,"./fr-ch":7081,"./fr-ch.js":7081,"./fr.js":4461,"./fy":3484,"./fy.js":3484,"./ga":6957,"./ga.js":6957,"./gd":2978,"./gd.js":2978,"./gl":9866,"./gl.js":9866,"./gom-deva":5011,"./gom-deva.js":5011,"./gom-latn":4724,"./gom-latn.js":4724,"./gu":1601,"./gu.js":1601,"./he":9802,"./he.js":9802,"./hi":9358,"./hi.js":9358,"./hr":3907,"./hr.js":3907,"./hu":218,"./hu.js":218,"./hy-am":533,"./hy-am.js":533,"./id":2844,"./id.js":2844,"./is":7353,"./is.js":7353,"./it":6364,"./it-ch":774,"./it-ch.js":774,"./it.js":6364,"./ja":6008,"./ja.js":6008,"./jv":8221,"./jv.js":8221,"./ka":2417,"./ka.js":2417,"./kk":2071,"./kk.js":2071,"./km":6149,"./km.js":6149,"./kn":4572,"./kn.js":4572,"./ko":659,"./ko.js":659,"./ku":6285,"./ku-kmr":9398,"./ku-kmr.js":9398,"./ku.js":6285,"./ky":1609,"./ky.js":1609,"./lb":119,"./lb.js":119,"./lo":1748,"./lo.js":1748,"./lt":1973,"./lt.js":1973,"./lv":1347,"./lv.js":1347,"./me":3023,"./me.js":3023,"./mi":5747,"./mi.js":5747,"./mk":4341,"./mk.js":4341,"./ml":3840,"./ml.js":3840,"./mn":2058,"./mn.js":2058,"./mr":9182,"./mr.js":9182,"./ms":5197,"./ms-my":9136,"./ms-my.js":9136,"./ms.js":5197,"./mt":6408,"./mt.js":6408,"./my":1683,"./my.js":1683,"./nb":3141,"./nb.js":3141,"./ne":9344,"./ne.js":9344,"./nl":4703,"./nl-be":4641,"./nl-be.js":4641,"./nl.js":4703,"./nn":9873,"./nn.js":9873,"./oc-lnc":1217,"./oc-lnc.js":1217,"./pa-in":4612,"./pa-in.js":4612,"./pl":4457,"./pl.js":4457,"./pt":1089,"./pt-br":9146,"./pt-br.js":9146,"./pt.js":1089,"./ro":5950,"./ro.js":5950,"./ru":7292,"./ru.js":7292,"./sd":6774,"./sd.js":6774,"./se":7493,"./se.js":7493,"./si":3761,"./si.js":3761,"./sk":9711,"./sk.js":9711,"./sl":8558,"./sl.js":8558,"./sq":8633,"./sq.js":8633,"./sr":688,"./sr-cyrl":7903,"./sr-cyrl.js":7903,"./sr.js":688,"./ss":1991,"./ss.js":1991,"./sv":7020,"./sv.js":7020,"./sw":5891,"./sw.js":5891,"./ta":5714,"./ta.js":5714,"./te":206,"./te.js":206,"./tet":4768,"./tet.js":4768,"./tg":8276,"./tg.js":8276,"./th":7977,"./th.js":7977,"./tk":6928,"./tk.js":6928,"./tl-ph":8046,"./tl-ph.js":8046,"./tlh":1361,"./tlh.js":1361,"./tr":4367,"./tr.js":4367,"./tzl":627,"./tzl.js":627,"./tzm":2636,"./tzm-latn":8148,"./tzm-latn.js":8148,"./tzm.js":2636,"./ug-cn":8823,"./ug-cn.js":8823,"./uk":461,"./uk.js":461,"./ur":1366,"./ur.js":1366,"./uz":3454,"./uz-latn":8374,"./uz-latn.js":8374,"./uz.js":3454,"./vi":8572,"./vi.js":8572,"./x-pseudo":464,"./x-pseudo.js":464,"./yo":3709,"./yo.js":3709,"./zh-cn":5873,"./zh-cn.js":5873,"./zh-hk":7549,"./zh-hk.js":7549,"./zh-mo":2240,"./zh-mo.js":2240,"./zh-tw":405,"./zh-tw.js":405};function l(e){var a=o(e);return t(a)}function o(e){if(!t.o(s,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return s[e]}l.keys=function(){return Object.keys(s)},l.resolve=o,e.exports=l,l.id=5358}},a={};function t(s){var l=a[s];if(void 0!==l)return l.exports;var o=a[s]={id:s,loaded:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}t.m=e,function(){var e=[];t.O=function(a,s,l,o){if(!s){var n=1/0;for(d=0;d<e.length;d++){s=e[d][0],l=e[d][1],o=e[d][2];for(var r=!0,c=0;c<s.length;c++)(!1&o||n>=o)&&Object.keys(t.O).every((function(e){return t.O[e](s[c])}))?s.splice(c--,1):(r=!1,o<n&&(n=o));if(r){e.splice(d--,1);var i=l();void 0!==i&&(a=i)}}return a}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,l,o]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){t.p="/"}(),function(){var e={524:0};t.O.j=function(a){return 0===e[a]};var a=function(a,s){var l,o,n=s[0],r=s[1],c=s[2],i=0;if(n.some((function(a){return 0!==e[a]}))){for(l in r)t.o(r,l)&&(t.m[l]=r[l]);if(c)var d=c(t)}for(a&&a(s);i<n.length;i++)o=n[i],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(d)},s=self["webpackChunkstudent_monitoring_client"]=self["webpackChunkstudent_monitoring_client"]||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))}();var s=t.O(void 0,[504],(function(){return t(4043)}));s=t.O(s)})();
//# sourceMappingURL=app.cec1c49a.js.map